(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{109:function(e,t,s){e.exports=s(620)},134:function(e,t,s){e.exports=s(641)},139:function(e,t,s){e.exports=s(644)},1773:function(e,t){function s(e,t){e.onload=function(){this.onerror=this.onload=null,t(null,e)},e.onerror=function(){this.onerror=this.onload=null,t(new Error("Failed to load "+this.src),e)}}function i(e,t){e.onreadystatechange=function(){"complete"!=this.readyState&&"loaded"!=this.readyState||(this.onreadystatechange=null,t(null,e))}}e.exports=function(e,t,a){var o=document.head||document.getElementsByTagName("head")[0],n=document.createElement("script");"function"==typeof t&&(a=t,t={}),t=t||{},a=a||function(){},n.type=t.type||"text/javascript",n.charset=t.charset||"utf8",n.async=!("async"in t)||!!t.async,n.src=e,t.attrs&&function(e,t){for(var s in t)e.setAttribute(s,t[s])}(n,t.attrs),t.text&&(n.text=""+t.text),("onload"in n?s:i)(n,a),n.onload||s(n,a),o.appendChild(n)}},1886:function(e,t,s){e.exports=s(1947)},1887:function(e,t,s){e.exports=s(1950)},1947:function(e,t,s){s(1948),e.exports=s(90).Number.isInteger},1948:function(e,t,s){var i=s(128);i(i.S,"Number",{isInteger:s(1949)})},1949:function(e,t,s){var i=s(235),a=Math.floor;e.exports=function(e){return!i(e)&&isFinite(e)&&a(e)===e}},1950:function(e,t,s){s(1951),e.exports=s(90).Number.parseInt},1951:function(e,t,s){var i=s(128),a=s(769);i(i.S+i.F*(Number.parseInt!=a),"Number",{parseInt:a})},489:function(e,t,s){e.exports=s(749)},492:function(e,t,s){"use strict";var i={props:{type:null}},a=s(32),o=Object(a.a)(i,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return"random"===e.type?s("div",{staticClass:"paper-type paper-type-random"},[e._v(e._s(e._f("trans")("question.bank.paper.random")))]):"regular"===e.type?s("div",{staticClass:"paper-type paper-type-regular"},[e._v("\n  "+e._s(e._f("trans")("question.bank.paper.regular"))+"\n")]):"aiPersonality"===e.type?s("div",{staticClass:"paper-type paper-type-ai"},[e._v("\n  "+e._s(e._f("trans")("question.bank.paper.aiPersonality"))+"\n")]):e._e()}),[],!1,null,null,null);t.a=o.exports},5:function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},534:function(e,t){e.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},6:function(e,t,s){var i=s(109);function a(e,t){for(var s=0;s<t.length;s++){var a=t[s];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),i(e,a.key,a)}}e.exports=function(e,t,s){return t&&a(e.prototype,t),s&&a(e,s),e}},626:function(e,t,s){var i=s(128),a=s(491),o=s(353),n=s(534),r="["+n+"]",c=RegExp("^"+r+r+"*"),u=RegExp(r+r+"*$"),l=function(e,t,s){var a={},r=o((function(){return!!n[e]()||"​"!="​"[e]()})),c=a[e]=r?t(p):n[e];s&&(a[s]=c),i(i.P+i.F*r,"String",a)},p=l.trim=function(e,t){return e=String(a(e)),1&t&&(e=e.replace(c,"")),2&t&&(e=e.replace(u,"")),e};e.exports=l},749:function(e,t,s){s(750),e.exports=s(90).Reflect.deleteProperty},750:function(e,t,s){var i=s(128),a=s(399).f,o=s(177);i(i.S,"Reflect",{deleteProperty:function(e,t){var s=a(o(e),t);return!(s&&!s.configurable)&&delete e[t]}})},769:function(e,t,s){var i=s(160).parseInt,a=s(626).trim,o=s(534),n=/^[-+]?0[xX]/;e.exports=8!==i(o+"08")||22!==i(o+"0x16")?function(e,t){var s=a(String(e),3);return i(s,t>>>0||(n.test(s)?16:10))}:i},802:function(e,t,s){"use strict";s.r(t);var i=s(1886),a=s.n(i),o=s(1887),n=s.n(o),r=s(51),c=s.n(r),u=s(12),l=s.n(u),p=s(17),d=s.n(p),y=s(23),h=s(1773),g=s.n(h),m={components:{TestPaperTypeTag:s(492).a},props:{type:null,paperQuestionCount:void 0,paperScore:void 0},methods:{backConfirm:function(){this.$emit("back-confirm")}}},f=s(32),v=Object(f.a)(m,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-affix",{attrs:{"offset-top":0}},[s("div",{staticClass:"test-paper-save-header"},[s("div",{staticClass:"test-paper-save-header-left"},[s("div",{staticClass:"test-paper-save-header-left-back",on:{click:e.backConfirm}},[s("span",{staticClass:"test-paper-save-header-left-back-img"},[s("img",{attrs:{src:"/static-dist/app/img/question-bank/back-image.png",alt:""}})]),e._v(" "),s("span",{staticClass:"test-paper-save-header-left-back-text"},[e._v("返回")])]),e._v(" "),s("i"),e._v(" "),s("test-paper-type-tag",{attrs:{type:e.type}})],1),e._v(" "),s("div",{staticClass:"test-paper-save-header-right"},[s("span",{staticClass:"test-paper-save-header-right-item"},[s("span",{staticClass:"test-paper-save-header-right-text"},[e._v("试题")]),e._v(" "),s("span",{staticClass:"test-paper-save-header-right-number"},[e._v(e._s(e.paperQuestionCount))])]),e._v(" "),s("i"),e._v(" "),s("span",{staticClass:"test-paper-save-header-right-item"},[s("span",{staticClass:"test-paper-save-header-right-text"},[e._v("总分")]),e._v(" "),s("span",{staticClass:"test-paper-save-header-right-number"},[e._v(e._s(e.paperScore))])])])])])}),[],!1,null,null,null).exports,C=s(1741),q=s.n(C),b=s(75),_=s.n(b),k={name:"QuestionTypeDisplaySetMenu",props:{questionTypeDisplaySettings:void 0,settingKey:void 0},components:{Draggable:q.a},data:function(){return{questionTypeDisplaySetting:[]}},methods:{onMenuVisibleChange:function(e){e?this.questionTypeDisplaySetting=_.a.cloneDeep(this.questionTypeDisplaySettings[this.settingKey]):this.$emit("updateQuestionTypeDisplaySetting",this.settingKey,_.a.cloneDeep(this.questionTypeDisplaySetting))},onSwitchClick:function(e){e.checked?(this.questionTypeDisplaySetting.forEach((function(t){t.checked&&t.type!==e.type&&(e.checked=!1)})),e.checked&&this.$message.error("至少保留一个题型")):e.checked=!0}}},S=Object(f.a)(k,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-dropdown",{attrs:{trigger:["click"],placement:"bottomRight"},on:{visibleChange:e.onMenuVisibleChange}},[s("div",{staticClass:"question-type-display-setting"},[s("img",{attrs:{src:"/static-dist/app/img/question-bank/question-type-show-image.png",alt:""}}),e._v(" "),s("span",[e._v("题型展示设置")])]),e._v(" "),s("a-menu",{staticClass:"question-type-setting-menu",attrs:{slot:"overlay"},slot:"overlay"},[s("draggable",{attrs:{handle:".question-type-setting-menu-item-label-icon","drag-class":"question-type-setting-menu-item-drag"},model:{value:e.questionTypeDisplaySetting,callback:function(t){e.questionTypeDisplaySetting=t},expression:"questionTypeDisplaySetting"}},[s("transition-group",e._l(e.questionTypeDisplaySetting,(function(t){return s("a-menu-item",{key:t.type,staticClass:"question-type-setting-menu-item"},[s("span",{staticClass:"question-type-setting-menu-item-label"},[s("img",{staticClass:"question-type-setting-menu-item-label-icon",attrs:{src:"/static-dist/app/img/question-bank/question-type-drag.png",alt:""}}),e._v(" "),s("span",{staticClass:"question-type-setting-menu-item-label-text"},[e._v(e._s(t.name))])]),e._v(" "),s("a-switch",{staticClass:"question-type-setting-menu-item-switch",attrs:{checked:t.checked},on:{click:function(s){return e.onSwitchClick(t)}}})],1)})),1)],1)],1)],1)}),[],!1,null,null,null).exports,w=s(139),T=s.n(w),x=s(78),D=s.n(x),P=s(134),E=s.n(P),F=s(133),I=s.n(F),Q=s(117),V=s.n(Q),$={props:{visible:void 0,bankId:void 0},data:function(){return{form:this.$form.createForm(this,{name:"create-question-category"}),names:"",validateNames:function(e,t,s){var i;void 0!==t&&""!==t&&t.split("\n").map((function(e){e.length>30&&(i=new Error(Translator.trans("question_bank.question_category.name_max_message"))),0===e.trim().length&&(i=new Error(Translator.trans("validate.visible_character.message")))})),s(i)}}},methods:{onCancel:function(){this.$emit("cancel")},onOk:function(){var e=this;this.form.validateFields((function(t){t||y.a.post("/api/item_bank/".concat(e.bankId,"/item_category"),{names:e.names}).then((function(t){t.ok&&(e.$emit("ok"),e.$message.success("添加成功"))}))}))},onNamesChange:function(e){this.names=e.target.value}}};function N(e,t){var s;if(void 0===I.a||null==e[E.a]){if(D()(e)||(s=function(e,t){if(!e)return;if("string"==typeof e)return R(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);"Object"===s&&e.constructor&&(s=e.constructor.name);if("Map"===s||"Set"===s)return V()(e);if("Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return R(e,t)}(e))||t&&e&&"number"==typeof e.length){s&&(e=s);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,n=!0,r=!1;return{s:function(){s=T()(e)},n:function(){var e=s.next();return n=e.done,e},e:function(e){r=!0,o=e},f:function(){try{n||null==s.return||s.return()}finally{if(r)throw o}}}}function R(e,t){(null==t||t>e.length)&&(t=e.length);for(var s=0,i=new Array(t);s<t;s++)i[s]=e[s];return i}var B={props:{bankId:void 0,selectedCategories:void 0},components:{QuestionCategoryCreateModal:Object(f.a)($,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-modal",{staticClass:"question-category-add-modal",attrs:{visible:e.visible,width:420,centered:!0,maskClosable:!1,title:"添加题目分类",cancelText:"取消",okText:"保存"},on:{cancel:e.onCancel,ok:e.onOk}},[s("div",{staticClass:"question-category-add-modal-body"},[s("span",{staticClass:"question-category-add-modal-body-description"},[e._v("可批量添加分类，一行一个，每个分类最多输入30个字符")]),e._v(" "),s("div",{staticClass:"question-category-add-modal-body-content"},[s("div",{staticClass:"question-category-add-modal-body-content-label"},[s("span",[e._v("分类名称")])]),e._v(" "),s("a-form",{attrs:{form:e.form}},[s("a-form-item",[s("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["names",{initialValue:e.names,rules:[{required:!0,message:"请输入分类名称"},{validator:e.validateNames}]}],expression:"[\n              'names',\n              {\n                initialValue: names,\n                rules: [\n                  { required: true, message: '请输入分类名称' },\n                  { validator: validateNames },\n                ]\n              },\n            ]"}],attrs:{placeholder:"请输入"},on:{change:e.onNamesChange}})],1)],1)],1)])])}),[],!1,null,null,null).exports},data:function(){return{drawerVisible:!1,modalVisible:!1,checkChildrenOperationVisibleId:void 0,categories:[],categoriesTree:{},checkedCategories:{},disabledCategories:{}}},computed:{checkChildrenVisible:function(){var e=this;return function(t){return t===e.checkChildrenOperationVisibleId&&0!==e.categoriesTree[t].children.length&&!e.disabledCategories[t]&&e.hasChildUnchecked(t)}},unCheckChildrenVisible:function(){var e=this;return function(t){return t===e.checkChildrenOperationVisibleId&&0!==e.categoriesTree[t].children.length&&!e.disabledCategories[t]&&!e.hasChildUnchecked(t)}},checkAllBoxIndeterminate:function(){var e,t=0,s=N(this.categories);try{for(s.s();!(e=s.n()).done;){var i=e.value;this.checkedCategories[i.id]&&t++}}catch(e){s.e(e)}finally{s.f()}return t>0&&t<this.categories.length},allCategoriesChecked:function(){var e,t=N(this.categories);try{for(t.s();!(e=t.n()).done;){var s=e.value;if(!this.disabledCategories[s.id]&&!this.checkedCategories[s.id])return!1}}catch(e){t.e(e)}finally{t.f()}return this.categories.length>0}},methods:{onDrawerDisplay:function(){this.fetchQuestionCategories(),this.drawerVisible=!0},fetchQuestionCategories:function(){var e=arguments,t=this;return d()(l.a.mark((function s(){var i,a,o;return l.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i=e.length>0&&void 0!==e[0]?e[0]:"",s.next=3,y.a.get("/api/item/categoryId/count",{params:{bank_id:t.bankId}});case 3:return a=s.sent,t.disabledCategories={},a.forEach((function(e){t.disabledCategories[e.category_id]=!1})),s.next=8,y.a.get("/api/item_bank/".concat(t.bankId,"/item_category_transform/treeList"));case 8:o=s.sent,t.categories=[],t.categoriesTree={},o.forEach((function(e){e.name.includes(i)&&(t.categories.push({id:e.id,name:e.name,depth:e.depth,level:t.getCategoryLevelText(e.depth)}),t.categoriesTree[e.id]={children:[]},t.categoriesTree[e.parent_id]&&t.categoriesTree[e.parent_id].children.push(e.id),void 0===t.disabledCategories[e.id]&&(t.disabledCategories[e.id]=!0))})),t.checkedCategories={},t.selectedCategories.forEach((function(e){t.disabledCategories[e.id]||t.checkedCategory(e.id)}));case 14:case"end":return s.stop()}}),s)})))()},getCategoryLevelText:function(e){return{1:"一级分类",2:"二级分类",3:"三级分类"}[e]},onCheckAllChange:function(e){var t=this;this.categories.forEach((function(s){t.disabledCategories[s.id]||t.$set(t.checkedCategories,s.id,e.target.checked)}))},onCheckBoxChange:function(e){this.$set(this.checkedCategories,e.target.value,e.target.checked)},hasChildUnchecked:function(e){if(!this.disabledCategories[e]&&!this.checkedCategories[e])return!0;if(this.categoriesTree[e].children){var t,s=N(this.categoriesTree[e].children);try{for(s.s();!(t=s.n()).done;){var i=t.value;if(this.hasChildUnchecked(i))return!0}}catch(e){s.e(e)}finally{s.f()}}return!1},checkedSelfAndChildren:function(e){var t=this;this.disabledCategories[e]||this.checkedCategory(e),this.categoriesTree[e].children&&this.categoriesTree[e].children.forEach((function(e){t.checkedSelfAndChildren(e)}))},unCheckedSelfAndChildren:function(e){var t=this;this.unCheckedCategory(e),this.categoriesTree[e].children&&this.categoriesTree[e].children.forEach((function(e){t.unCheckedSelfAndChildren(e)}))},unCheckedAllCategories:function(){var e=this;this.categories.forEach((function(t){e.unCheckedCategory(t.id)}))},checkedCategory:function(e){this.$set(this.checkedCategories,e,!0)},unCheckedCategory:function(e){this.$set(this.checkedCategories,e,!1)},saveCheckedCategories:function(){var e=this;if(0!==this.categories.length){var t=[];this.categories.forEach((function(s){e.checkedCategories[s.id]&&t.push(s)})),0!==t.length?(this.$emit("save-selected-categories",t),this.drawerVisible=!1,this.$message.success("保存成功")):this.$message.error("请选择分类")}else this.$message.error("该题库下暂无分类，请添加题目分类")},onSearchCategories:function(e){this.fetchQuestionCategories(e.target.value)},onDrawerClose:function(){var e=this;this.$confirm({title:"确定放弃此次操作吗？",content:"当前操作尚未保存",icon:"exclamation-circle",okText:"确定",cancelText:"取消",centered:!0,onOk:function(){e.drawerVisible=!1}})},onCategoriesCreated:function(){this.fetchQuestionCategories(),this.modalVisible=!1}}},O=Object(f.a)(B,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("div",{staticClass:"question-category-choose-btn",on:{click:e.onDrawerDisplay}},[s("span",{staticClass:"question-category-choose-btn-text"},[e._v("+ 选择分类")])]),e._v(" "),s("a-drawer",{staticClass:"question-category-choose-drawer",attrs:{title:"选择分类",width:"960",visible:e.drawerVisible,maskClosable:!1},on:{close:e.onDrawerClose}},[s("div",{staticClass:"question-category-choose-container-body"},[s("div",{staticClass:"question-category-choose-all"},[s("div",{staticClass:"question-category-choose-all-header"},[s("a-input",{attrs:{placeholder:"搜索分类"},on:{pressEnter:e.onSearchCategories}},[s("img",{staticClass:"question-category-choose-all-header-search-icon",attrs:{slot:"prefix",src:"/static-dist/app/img/question-bank/question-category-search-icon.png",alt:""},slot:"prefix"})]),e._v(" "),s("a-checkbox",{attrs:{indeterminate:e.checkAllBoxIndeterminate,checked:e.allCategoriesChecked},on:{change:e.onCheckAllChange}},[s("span",{staticClass:"question-category-choose-all-header-check-all-text"},[e._v("选择全部分类")])])],1),e._v(" "),s("div",{staticClass:"question-category-choose-all-body"},[e._l(e.categories,(function(t){return s("div",{staticClass:"question-category-choose-all-body-category",on:{mouseover:function(s){e.checkChildrenOperationVisibleId=t.id},mouseleave:function(t){e.checkChildrenOperationVisibleId=void 0}}},[s("div",{class:"question-category-choose-all-body-category-depth-"+t.depth},[e.disabledCategories[t.id]?s("a-tooltip",{attrs:{placement:"topLeft",title:"该分类下暂无题目"}},[s("a-checkbox",{attrs:{disabled:!0}},[s("span",{staticClass:"question-category-choose-all-body-category-name"},[e._v(e._s(t.name))])])],1):e._e(),e._v(" "),!1===e.disabledCategories[t.id]?s("a-checkbox",{attrs:{value:t.id,checked:e.checkedCategories[t.id]},on:{change:e.onCheckBoxChange}},[s("span",{staticClass:"question-category-choose-all-body-category-name"},[e._v(e._s(t.name))])]):e._e()],1),e._v(" "),s("div",[s("span",{directives:[{name:"show",rawName:"v-show",value:e.checkChildrenVisible(t.id),expression:"checkChildrenVisible(category.id)"}],staticClass:"question-category-choose-all-body-category-operation",on:{click:function(s){return e.checkedSelfAndChildren(t.id)}}},[e._v("全选")]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:e.unCheckChildrenVisible(t.id),expression:"unCheckChildrenVisible(category.id)"}],staticClass:"question-category-choose-all-body-category-operation",on:{click:function(s){return e.unCheckedSelfAndChildren(t.id)}}},[e._v("取消全选")])])])})),e._v(" "),0===e.categories.length?s("div",{staticClass:"question-category-choose-all-body-empty"},[s("div",{staticClass:"question-category-choose-all-body-empty-content"},[s("div",{staticClass:"question-category-choose-all-body-empty-content-img"},[s("img",{attrs:{src:"/static-dist/app/img/question-bank/empty.png",alt:""}})]),e._v(" "),s("span",{staticClass:"question-category-choose-all-body-empty-content-text"},[e._v("暂无分类")])]),e._v(" "),s("button",{staticClass:"question-category-choose-all-body-add-category-btn",on:{click:function(t){e.modalVisible=!0}}},[e._v("添加题目分类")])]):e._e()],2)]),e._v(" "),s("div",{staticClass:"question-category-choose-selected"},[s("div",{staticClass:"question-category-choose-selected-header"},[s("span",{staticClass:"question-category-choose-selected-header-selected"},[e._v("已选")]),e._v(" "),s("a-popconfirm",{attrs:{title:"确定要清空全部吗？",placement:"bottomRight","ok-text":"确定","cancel-text":"取消"},on:{confirm:e.unCheckedAllCategories}},[s("span",{staticClass:"question-category-choose-selected-header-clear"},[e._v("清空")])])],1),e._v(" "),s("div",{staticClass:"question-category-choose-selected-body"},e._l(e.categories,(function(t){return s("div",{directives:[{name:"show",rawName:"v-show",value:e.checkedCategories[t.id],expression:"checkedCategories[category.id]"}],staticClass:"question-category-choose-selected-body-item"},[s("div",{staticClass:"question-category-choose-selected-body-item-text"},[s("div",{staticClass:"question-category-choose-selected-body-item-text-name"},[e._v(e._s(t.name))]),e._v(" "),s("span",{staticClass:"question-category-choose-selected-body-item-text-level"},[e._v(e._s(t.level))])]),e._v(" "),s("img",{staticClass:"question-category-choose-selected-body-item-remove",attrs:{src:"/static-dist/app/img/question-bank/remove-selected-question-category-icon.png",alt:""},on:{click:function(s){return e.unCheckedCategory(t.id)}}})])})),0)])]),e._v(" "),s("div",{staticClass:"question-category-choose-container-footer"},[s("div",{staticClass:"question-category-choose-container-footer-btn-group"},[s("button",{staticClass:"question-category-choose-container-footer-btn-cancel",on:{click:e.onDrawerClose}},[s("span",{staticClass:"question-category-choose-container-footer-btn-text"},[e._v("取消")])]),e._v(" "),s("button",{staticClass:"question-category-choose-container-footer-btn-save",on:{click:e.saveCheckedCategories}},[s("span",{staticClass:"question-category-choose-container-footer-btn-text"},[e._v("保存")])])])])]),e._v(" "),s("question-category-create-modal",{attrs:{visible:e.modalVisible,bankId:e.bankId},on:{ok:e.onCategoriesCreated,cancel:function(t){e.modalVisible=!1}}})],1)}),[],!1,null,null,null).exports,A={name:"QuestionTypeCategoryEditDrawer",props:{drawerVisible:!1,defaultQuestionTypeDisplaySettings:void 0,questionTypeDisplaySettingKey:void 0,defaultCategories:void 0,defaultScores:void 0,defaultQuestionCounts:void 0,bankId:void 0},components:{QuestionTypeDisplaySetMenu:S},data:function(){return{editingRow:null,questionTypeDisplaySettings:{},questionTypeDisplaySetting:[],categories:[],questionConfigs:{single_choice:{count:{choose:{},total:{}},score:2},choice:{count:{choose:{},total:{}},score:2},essay:{count:{choose:{},total:{}},score:2},uncertain_choice:{count:{choose:{},total:{}},score:2},determine:{count:{choose:{},total:{}},score:2},fill:{count:{choose:{},total:{}},score:2},material:{count:{choose:{},total:{}},score:2}}}},computed:{totalCount:function(){var e=this;return function(t,s){return e.questionConfigs[s].count.total[t]?e.questionConfigs[s].count.total[t]:0}}},methods:{fetchQuestionCounts:function(){var e=this;this.questionTypeDisplaySetting.forEach((function(t){e.defaultCategories.forEach((function(s){e.questionConfigs[t.type].count.choose[s.id]=0,e.defaultQuestionCounts[t.type].categoryCounts&&e.defaultQuestionCounts[t.type].categoryCounts[s.id]&&(e.questionConfigs[t.type].count.choose[s.id]=e.defaultQuestionCounts[t.type].categoryCounts[s.id])})),e.questionConfigs[t.type].score=e.defaultScores[t.type];var s=e.questionConfigs[t.type];e.questionConfigs[t.type]={},e.$set(e.questionConfigs,t.type,s)}));var t=[];this.defaultCategories.forEach((function(e){t.push(e.id)})),y.a.get("/api/item/categoryIdAndType/count",{params:{bank_id:this.bankId,category_ids:t}}).then((function(t){t.forEach((function(t){e.questionConfigs[t.type].count.total[t.category_id]=t.itemNum;var s=e.questionConfigs[t.type];e.questionConfigs[t.type]={},e.$set(e.questionConfigs,t.type,s)}))}))},close:function(){this.$emit("close")},save:function(){var e=this,t=0;this.questionTypeDisplaySetting.forEach((function(s){e.categories.forEach((function(i){t+=e.questionConfigs[s.type].count.choose[i.id]}))})),0!==t?(this.$emit("save",this.categories,_.a.cloneDeep(this.questionTypeDisplaySetting),_.a.cloneDeep(this.questionConfigs)),this.$message.success(Translator.trans("site.save_success_hint")),this.close()):this.$message.error("请至少选择 1 道题目")},closeConfirm:function(){this.$confirm({title:"确定放弃此次操作吗？",content:"当前操作尚未保存",centered:!0,okText:"确定",cancelText:"取消",onOk:this.close})},removeCategory:function(e){this.categories=this.categories.filter((function(t){return t.id!==e}))},sumNum:function(e){var t=this,s=0;return this.categories.forEach((function(i){s+=t.questionConfigs[e].count.choose[i.id]?Number(t.questionConfigs[e].count.choose[i.id]):0})),s},sumScore:function(e){return(this.sumNum(e)*this.questionConfigs[e].score).toFixed(1)},onQuestionTypeDisplaySettingUpdate:function(e,t){this.questionTypeDisplaySettings[e]=t,this.questionTypeDisplaySetting=t},onInputCountBlur:function(e,t){this.editingRow=null,""===this.questionConfigs[e].count.choose[t]&&(this.questionConfigs[e].count.choose[t]=0),this.questionConfigs[e].count.choose[t]=n()(this.questionConfigs[e].count.choose[t]),this.questionConfigs[e].count.choose[t]>this.questionConfigs[e].count.total[t]&&(this.questionConfigs[e].count.choose[t]=this.questionConfigs[e].count.total[t])},onInputScoreBlur:function(e){if(this.editingRow=null,""===this.questionConfigs[e].score)this.questionConfigs[e].score=2;else{var t=Number(this.questionConfigs[e].score);t=t<=0?2:t,a()(t)||(t=t.toFixed(1)),this.questionConfigs[e].score=t}}},watch:{drawerVisible:function(e){e?(document.body.style.overflowY="hidden",this.questionTypeDisplaySettings=_.a.cloneDeep(this.defaultQuestionTypeDisplaySettings),this.questionTypeDisplaySetting=this.defaultQuestionTypeDisplaySettings[this.questionTypeDisplaySettingKey],this.categories=_.a.cloneDeep(this.defaultCategories),this.fetchQuestionCounts()):document.body.style.overflowY="auto"}}},U={name:"QuestionTypeCategoryDisplay",components:{QuestionTypeCategoryEditDrawer:Object(f.a)(A,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("a-drawer",{attrs:{"get-container":".test-create",width:"100vw","wrap-class-name":"drawer-container",visible:e.drawerVisible,closable:!1},scopedSlots:e._u([{key:"title",fn:function(){return[s("div",{staticClass:"drawer-header"},[s("div",{staticClass:"drawer-header-return",on:{click:e.closeConfirm}},[e._v("< "+e._s(e._f("trans")("importer.import_back_btn")))]),e._v(" "),s("div",{staticClass:"separator"}),e._v(" "),s("span",[e._v("按题型+分类抽题")])])]},proxy:!0}])},[e._v(" "),s("div",{staticClass:"drawer-body"},[s("question-type-display-set-menu",{attrs:{"question-type-display-settings":e.questionTypeDisplaySettings,"setting-key":e.questionTypeDisplaySettingKey},on:{updateQuestionTypeDisplaySetting:e.onQuestionTypeDisplaySettingUpdate}}),e._v(" "),s("div",{staticClass:"question-type-category-display"},[s("div",{staticClass:"question-type-category-display-header"},[s("div",{staticClass:"question-type-category-display-header-top"},[e._v("分类")]),e._v(" "),e._l(e.categories,(function(t,i){return s("div",{staticClass:"question-type-category-display-header-normal",class:{"row-editing":e.editingRow===i}},[s("div",{staticClass:"question-type-category-display-header-normal-level"},[e._v(e._s(t.level))]),e._v(" "),s("span",{staticClass:"category-name"},[e._v(e._s(t.name))])])})),e._v(" "),s("div",{staticClass:"question-type-category-display-header-score",class:{"row-editing":e.editingRow===e.categories.length}},[s("span",{staticClass:"question-type-category-display-header-top-content"},[e._v("按题型设置分值")])]),e._v(" "),s("div",{staticClass:"question-type-category-display-header-bottom"},[s("span",{staticClass:"question-type-category-display-header-bottom-title"},[e._v("合计")]),e._v(" "),s("span",{staticClass:"question-type-category-display-header-bottom-description"},[e._v("（题数/总分）")])])],2),e._v(" "),e._l(e.questionTypeDisplaySetting,(function(t){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.checked,expression:"type.checked"}],staticClass:"question-type-category-display-header-type"},[s("div",{staticClass:"question-type-category-display-header-top"},[s("div",{staticClass:"question-type-category-display-header-top-content"},[e._v(e._s(t.name))])]),e._v(" "),e._l(e.categories,(function(i,a){return s("div",{staticClass:"question-type-category-display-cell",class:{"row-editing":e.editingRow===a,"question-type-category-display-cell-active":e.totalCount(i.id,t.type)>0,"question-type-category-display-cell-inactive":0===e.totalCount(i.id,t.type)}},[e.totalCount(i.id,t.type)>0?s("input",{directives:[{name:"model",rawName:"v-model",value:e.questionConfigs[t.type].count.choose[i.id],expression:"questionConfigs[type.type].count.choose[category.id]"}],staticClass:"question-type-category-display-cell-number",attrs:{type:"number",min:"0",max:e.totalCount(i.id,t.type)},domProps:{value:e.questionConfigs[t.type].count.choose[i.id]},on:{focus:function(t){e.editingRow=a},blur:function(s){return e.onInputCountBlur(t.type,i.id)},input:function(s){s.target.composing||e.$set(e.questionConfigs[t.type].count.choose,i.id,s.target.value)}}}):e._e(),e._v(" "),0===e.totalCount(i.id,t.type)?s("span",{staticClass:"question-type-category-display-cell-number-total"},[e._v("0")]):e._e(),e._v(" "),s("span",{staticClass:"question-type-category-display-cell-number-total"},[e._v("/"+e._s(e.totalCount(i.id,t.type)))])])})),e._v(" "),s("div",{staticClass:"question-type-category-display-cell question-type-category-display-cell-active",class:{"row-editing":e.editingRow===e.categories.length}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.questionConfigs[t.type].score,expression:"questionConfigs[type.type].score"}],staticClass:"question-type-category-display-cell-number",attrs:{type:"number",min:"0"},domProps:{value:e.questionConfigs[t.type].score},on:{focus:function(t){e.editingRow=e.categories.length},blur:function(s){return e.onInputScoreBlur(t.type)},input:function(s){s.target.composing||e.$set(e.questionConfigs[t.type],"score",s.target.value)}}})]),e._v(" "),s("div",{staticClass:"question-type-category-display-cell-sum"},[e._v(e._s(e.sumNum(t.type)+" / "+e.sumScore(t.type)))])],2)})),e._v(" "),s("div",{staticClass:"question-type-category-display-header-action"},[s("div",{staticClass:"question-type-category-display-header-top"},[e._v("操作")]),e._v(" "),e._l(e.categories,(function(t,i){return s("div",{staticClass:"question-type-category-display-cell",class:{"row-editing":e.editingRow===i}},[s("a-popconfirm",{attrs:{title:"确定要删除当前分类吗？","ok-text":"移除","cancel-text":"取消"},on:{confirm:function(s){return e.removeCategory(t.id)}}},[s("a",[e._v("移除")])])],1)})),e._v(" "),s("div",{staticClass:"question-type-category-display-cell",class:{"row-editing":e.editingRow===e.categories.length}},[s("div",{staticClass:"question-type-category-display-cell-number"})]),e._v(" "),s("div",{staticClass:"question-type-category-display-cell-sum"})],2)],2)],1),e._v(" "),s("div",{staticClass:"drawer-bottom"},[s("a-button",{on:{click:e.closeConfirm}},[e._v(e._s(e._f("trans")("site.cancel")))]),e._v(" "),s("a-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v(e._s(e._f("trans")("site.btn.save")))])],1)])}),[],!1,null,null,null).exports},props:{questionTypeDisplaySettings:void 0,questionTypeDisplaySettingKey:void 0,categories:void 0,scores:void 0,questionCounts:void 0,bankId:void 0},data:function(){return{editMaskVisible:!1,drawerVisible:!1,countVisible:!1,questionTotalCounts:{single_choice:{},choice:{},essay:{},uncertain_choice:{},determine:{},fill:{},material:{}}}},computed:{totalCount:function(){var e=this;return function(t,s){return e.questionTotalCounts[s][t]?e.questionTotalCounts[s][t]:0}},chooseCount:function(){var e=this;return function(t,s){var i;return e.countVisible?(null===(i=e.questionCounts[s])||void 0===i?void 0:i.categoryCounts[t])?e.questionCounts[s].categoryCounts[t]:0:""}},sumCount:function(){var e=this;return function(t){if(!e.countVisible)return 0;var s=0;return e.categories.forEach((function(i){e.questionCounts[t].categoryCounts[i.id]&&(s+=Number(e.questionCounts[t].categoryCounts[i.id]))})),s}},sumScore:function(){var e=this;return function(t){if(!e.countVisible)return(0).toFixed(1);var s=0;return e.categories.forEach((function(i){e.questionCounts[t].categoryCounts[i.id]&&(s+=Number(e.questionCounts[t].categoryCounts[i.id]))})),(s*e.scores[t]).toFixed(1)}}},methods:{onEditDrawerSave:function(e,t,s){var i=this;this.$emit("updateCategories",e),this.$emit("updateQuestionTypeDisplaySetting",this.questionTypeDisplaySettingKey,t),this.$emit("updateQuestionConfigs",s),c()(s).forEach((function(e){i.questionTotalCounts[e]=s[e].count.total})),this.countVisible=!0}}},K=Object(f.a)(U,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"question-type-category-display",on:{mouseover:function(t){e.editMaskVisible=!0},mouseleave:function(t){e.editMaskVisible=!1}}},[s("div",{staticClass:"question-type-category-display-header"},[s("div",{staticClass:"question-type-category-display-header-top"},[e._v("分类")]),e._v(" "),e._l(e.categories,(function(t){return s("div",{staticClass:"question-type-category-display-header-normal"},[s("div",{staticClass:"question-type-category-display-header-normal-level"},[e._v(e._s(t.level))]),e._v(" "),s("span",{staticClass:"category-name"},[e._v(e._s(t.name))])])})),e._v(" "),e._m(0)],2),e._v(" "),e._l(e.questionTypeDisplaySettings[e.questionTypeDisplaySettingKey],(function(t){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.checked,expression:"type.checked"}],staticClass:"question-type-category-display-header-type"},[s("div",{staticClass:"question-type-category-display-header-top"},[s("div",{staticClass:"question-type-category-display-header-top-content"},[e._v(e._s(t.name))])]),e._v(" "),e._l(e.categories,(function(i){return s("div",{staticClass:"question-type-category-display-cell",class:{"question-type-category-display-cell-inactive":e.countVisible&&0===e.totalCount(i.id,t.type)}},[s("span",{staticClass:"question-type-category-display-cell-number"},[e._v(e._s(e.chooseCount(i.id,t.type)))])])})),e._v(" "),s("div",{staticClass:"question-type-category-display-cell-sum"},[e._v(e._s(e.sumCount(t.type))+"/"+e._s(e.sumScore(t.type)))])],2)})),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.editMaskVisible,expression:"editMaskVisible"}],staticClass:"edit-mask-container"},[s("a-button",{on:{click:function(t){e.drawerVisible=!0}}},[e._v("编辑")])],1),e._v(" "),s("question-type-category-edit-drawer",{attrs:{"drawer-visible":e.drawerVisible,"bank-id":e.bankId,"default-categories":e.categories,"default-question-type-display-settings":e.questionTypeDisplaySettings,"question-type-display-setting-key":e.questionTypeDisplaySettingKey,"default-scores":e.scores,"default-question-counts":e.questionCounts},on:{close:function(t){e.drawerVisible=!1},save:e.onEditDrawerSave}})],2)}),[function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"question-type-category-display-header-bottom"},[s("span",{staticClass:"question-type-category-display-header-bottom-title"},[e._v("合计")]),e._v(" "),s("span",{staticClass:"question-type-category-display-header-bottom-description"},[e._v("（题数/总分）")])])}],!1,null,null,null).exports,j=s(80),M={components:{TestPaperSaveHeader:v,QuestionTypeDisplaySetMenu:S,QuestionCategorySelectDrawer:O,QuestionTypeCategoryDisplay:K},props:{itemBankId:null,id:null},data:function(){return{bankId:document.getElementById("itemBankId").value,descriptionEditorVisible:!1,descriptionEditor:void 0,CKEditorConfig:{publicPath:document.getElementById("ckeditor_path").value,jqueryPath:document.getElementById("jquery_path").value,filebrowserImageUploadUrl:document.getElementById("ckeditor_image_upload_url").value,filebrowserImageDownloadUrl:document.getElementById("ckeditor_image_download_url").value,language:"zh_CN"===document.documentElement.lang?"zh-cn":document.documentElement.lang},difficultyVisible:!1,questionTypeDisplaySettings:{},questionCounts:{single_choice:{choose:0,total:0},choice:{choose:0,total:0},essay:{choose:0,total:0},uncertain_choice:{choose:0,total:0},determine:{choose:0,total:0},fill:{choose:0,total:0},material:{choose:0,total:0}},scores:{questionType:{single_choice:2,choice:2,essay:2,uncertain_choice:2,determine:2,fill:2,material:2},questionTypeCategory:{single_choice:2,choice:2,essay:2,uncertain_choice:2,determine:2,fill:2,material:2}},selectedQuestionCategories:[],difficultyScales:{simple:{text:"简单",scale:30,totalCount:0,chooseCount:0},normal:{text:"一般",scale:40,totalCount:0,chooseCount:0},difficulty:{text:"困难",scale:30,totalCount:0,chooseCount:0}},form:this.$form.createForm(this,{name:"save-test-paper"}),testPaperFormState:{name:"",description:"",type:"random",itemBankId:null,num:20,generateType:"questionType",questionCategoryCounts:[],scores:{},percentages:{simple:"",normal:"",difficulty:""},wrongQuestionRate:"0"},fetching:!1,editingRow:null}},computed:{sumScore:function(){var e=this;return function(t){return(e.questionCounts[t].choose*e.scores.questionType[t]).toFixed(1)}},paperQuestionCount:function(){return this.sumChooseQuestionCount()},paperScore:function(){return this.sumChooseQuestionScore()},isPersonalTestPaper:function(){return"aiPersonality"===this.testPaperFormState.type}},mounted:function(){var e=this;if(this.fetchLastQuestionTypeDisplaySettings(),this.fetchQuestionCounts(),this.$nextTick((function(){g()(e.CKEditorConfig.jqueryPath,(function(t){t&&console.log(t),g()(e.CKEditorConfig.publicPath,(function(e){e&&console.log(e)}))}))})),"create"===this.$route.name){var t=this.$route.query.type;this.testPaperFormState.type=t||"random";var s=this.$route.query.name;this.testPaperFormState.name=s||""}document.addEventListener("click",this.handleRouterSkip)},beforeDestroy:function(){document.removeEventListener("click",this.handleRouterSkip)},methods:{confirmLeave:function(e){this.$confirm({title:"确定要离开当前页面？",content:"离开后所有已编辑更改的数据将消失！",icon:"exclamation-circle",okText:"离开",cancelText:"取消",centered:!0,onOk:function(){window.location.href=e}})},handleRouterSkip:function(e){var t=e.target;if("A"===t.tagName&&t.getAttribute("href")&&t.getAttribute("data-is-link")){var s=t.getAttribute("href");e.preventDefault(),this.confirmLeave(s)}},initDescriptionEditor:function(){var e=this;this.descriptionEditor&&this.descriptionEditor.destroy(),this.descriptionEditor=CKEDITOR.replace("test-paper-description",{toolbar:"Minimal",fileSingleSizeLimit:app.fileSingleSizeLimit,filebrowserImageUploadUrl:this.CKEditorConfig.filebrowserImageUploadUrl,filebrowserImageDownloadUrl:this.CKEditorConfig.filebrowserImageDownloadUrl,language:this.CKEditorConfig.language,startupFocus:!0}),this.descriptionEditor.setData(this.testPaperFormState.description),this.descriptionEditor.on("blur",(function(){var t=e.descriptionEditor.getData();e.testPaperFormState.description=t,e.form.setFieldsValue({description:e.testPaperFormState.description}),""!==t?e.form.validateFields(["description"],d()(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))):e.descriptionEditorVisible=!1}))},fetchLastQuestionTypeDisplaySettings:function(){this.questionTypeDisplaySettings={questionType:this.getDefaultQuestionTypeDisplaySetting(),questionTypeCategory:this.getDefaultQuestionTypeDisplaySetting()}},fetchQuestionCounts:function(){var e=this;y.a.get("/api/item/questionType/count",{params:{bank_id:this.bankId}}).then((function(t){t.forEach((function(t){e.questionCounts[t.type].total=t.itemNum}))})),y.a.get("/api/item/difficulty/count",{params:{bank_id:this.bankId}}).then((function(t){t.forEach((function(t){e.difficultyScales[t.difficulty].totalCount=t.itemNum}))}))},getDefaultQuestionTypeDisplaySetting:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return[{type:"single_choice",name:"单选题",checked:e},{type:"choice",name:"多选题",checked:e},{type:"essay",name:"问答题",checked:e},{type:"uncertain_choice",name:"不定项",checked:e},{type:"determine",name:"判断题",checked:e},{type:"fill",name:"填空题",checked:e},{type:"material",name:"材料题",checked:e}]},backConfirm:function(){var e=this;this.$confirm({title:"是否要保存更改？",icon:"exclamation-circle",okText:"保存",cancelText:"不保存",centered:!0,onOk:function(){e.saveTestPaper()},onCancel:function(){e.$router.push({name:"list"})}})},onQuestionTypeDisplaySettingUpdate:function(e,t){this.$set(this.questionTypeDisplaySettings,e,t)},onQuestionConfigsUpdate:function(e){var t=this;c()(e).forEach((function(s){t.scores.questionTypeCategory[s]=e[s].score,t.questionCounts[s].categoryCounts=e[s].count.choose}))},onDescriptionInputFocus:function(){this.initDescriptionEditor(),this.descriptionEditorVisible=!0},onSliderChange:function(e){this.difficultyScales.simple.scale=e[0],this.difficultyScales.normal.scale=e[1]-e[0],this.difficultyScales.difficulty.scale=100-e[1]},onQuestionCategoriesSelected:function(e){this.selectedQuestionCategories=e},saveTestPaper:function(){var e=this;this.fetching||this.form.validateFields(function(){var t=d()(l.a.mark((function t(s){var i,a;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(s){t.next=33;break}if(0!==e.sumChooseQuestionCount()){t.next=4;break}return e.$message.error("请至少选择 1 道题目"),t.abrupt("return");case 4:if(e.fetching=!0,e.testPaperFormState.questionCategoryCounts=[],e.testPaperFormState.itemBankId=e.itemBankId,e.testPaperFormState.num="".concat("aiPersonality"===e.testPaperFormState.type?0:e.testPaperFormState.num),"questionType"===e.testPaperFormState.generateType?(i={},e.questionTypeDisplaySettings.questionType.forEach((function(t){t.checked&&(i[t.type]=e.questionCounts[t.type].choose)})),e.testPaperFormState.questionCategoryCounts.push({categoryId:"",counts:i})):e.selectedQuestionCategories.forEach((function(t){var s={};e.questionTypeDisplaySettings.questionTypeCategory.forEach((function(i){i.checked&&(s[i.type]=e.questionCounts[i.type].categoryCounts[t.id])})),e.testPaperFormState.questionCategoryCounts.push({categoryId:t.id,counts:s})})),e.testPaperFormState.scores=e.scores[e.testPaperFormState.generateType],e.testPaperFormState.percentages={simple:"",normal:"",difficulty:""},e.difficultyVisible&&(e.testPaperFormState.percentages={simple:"".concat(e.difficultyScales.simple.scale),normal:"".concat(e.difficultyScales.normal.scale),difficulty:"".concat(e.difficultyScales.difficulty.scale)}),a="create"===e.$route.name,t.prev=13,!a){t.next=19;break}return t.next=17,j.I.create(e.testPaperFormState);case 17:t.next=22;break;case 19:return e.testPaperFormState.id=e.id,t.next=22,j.I.update(e.testPaperFormState);case 22:return t.next=24,e.$router.push({name:"list",query:{tab:e.isPersonalTestPaper?"ai_personality":"all"}});case 24:a?e.$message.success("创建成功"):e.$message.success("保存成功"),t.next=30;break;case 27:t.prev=27,t.t0=t.catch(13),a?e.$message.error("创建失败"):e.$message.error("保存失败");case 30:return t.prev=30,e.fetching=!1,t.finish(30);case 33:case"end":return t.stop()}}),t,null,[[13,27,30,33]])})));return function(e){return t.apply(this,arguments)}}())},sumChooseQuestionCount:function(){var e=this,t=0;return this.questionTypeDisplaySettings[this.testPaperFormState.generateType]?(this.questionTypeDisplaySettings[this.testPaperFormState.generateType].forEach((function(s){s.checked&&("questionType"===e.testPaperFormState.generateType?t+=Number(e.questionCounts[s.type].choose):e.questionCounts[s.type].categoryCounts&&e.selectedQuestionCategories.forEach((function(i){e.questionCounts[s.type].categoryCounts[i.id]&&(t+=Number(e.questionCounts[s.type].categoryCounts[i.id]))})))})),t):t},sumChooseQuestionScore:function(){var e=this,t=0;return this.questionTypeDisplaySettings[this.testPaperFormState.generateType]?(this.questionTypeDisplaySettings[this.testPaperFormState.generateType].forEach((function(s){s.checked&&("questionType"===e.testPaperFormState.generateType?t+=Number(e.questionCounts[s.type].choose)*e.scores.questionType[s.type]:e.questionCounts[s.type].categoryCounts&&e.selectedQuestionCategories.forEach((function(i){e.questionCounts[s.type].categoryCounts[i.id]&&(t+=Number(e.questionCounts[s.type].categoryCounts[i.id])*e.scores.questionTypeCategory[s.type])})))})),t.toFixed(1)):t.toFixed(1)},handleChangeNum:function(e){var t=this;this.testPaperFormState.num=n()(e)||1,this.$nextTick((function(){t.form.setFieldsValue({num:t.testPaperFormState.num})}))},handleChangeWrongRate:function(e){var t=this;this.testPaperFormState.wrongQuestionRate=n()(e)||0,this.$nextTick((function(){t.form.setFieldsValue({wrongQuestionRate:t.testPaperFormState.wrongQuestionRate})}))},handleChangeName:function(e){this.testPaperFormState.name=e.target.value,this.form.setFieldsValue({name:e})},onInputCountBlur:function(e){this.editingRow=null,""===this.questionCounts[e].choose&&(this.questionCounts[e].choose=0),this.questionCounts[e].choose=n()(this.questionCounts[e].choose),this.questionCounts[e].choose>this.questionCounts[e].total&&(this.questionCounts[e].choose=this.questionCounts[e].total)},onInputScoreBlur:function(e){if(this.editingRow=null,""===this.scores.questionType[e])this.scores.questionType[e]=2;else{var t=Number(this.scores.questionType[e]);t=t<=0?2:t,a()(t)||(t=t.toFixed(1)),this.scores.questionType[e]=t}}},beforeMount:function(){var e=this;return d()(l.a.mark((function t(){var s,i,a,o,r;return l.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("update"!==e.$route.name){t.next=28;break}return t.next=3,j.I.get(e.id);case 3:if(s=t.sent,e.testPaperFormState.name=s.name,e.testPaperFormState.type=s.type,e.testPaperFormState.description=s.description,e.testPaperFormState.num=0,e.testPaperFormState.itemBankId=s.bank_id,i=e.getDefaultQuestionTypeDisplaySetting(!1),!s.assessmentGenerateRule){t.next=27;break}if(e.testPaperFormState.generateType=s.assessmentGenerateRule.type,e.testPaperFormState.wrongQuestionRate=s.assessmentGenerateRule.wrong_question_rate,a=c()(s.assessmentGenerateRule.question_setting.questionCategoryCounts[0].counts),i.forEach((function(e){-1!==a.indexOf(e.type)&&(e.checked=!0)})),e.questionTypeDisplaySettings[e.testPaperFormState.generateType]=i,a.forEach((function(t){e.scores[e.testPaperFormState.generateType][t]=s.assessmentGenerateRule.question_setting.scores[t]})),"questionType"!==e.testPaperFormState.generateType){t.next=21;break}a.forEach((function(t){e.questionCounts[t].choose=s.assessmentGenerateRule.question_setting.questionCategoryCounts[0].counts[t]})),t.next=25;break;case 21:return t.next=23,y.a.get("/api/item_bank/".concat(e.bankId,"/item_category_transform/map"));case 23:o=t.sent,s.assessmentGenerateRule.question_setting.questionCategoryCounts.forEach((function(t){a.forEach((function(s){e.questionCounts[s].categoryCounts=e.questionCounts[s].categoryCounts||{},e.questionCounts[s].categoryCounts[t.categoryId]=t.counts[s]})),e.selectedQuestionCategories.push({id:o[t.categoryId].id,name:o[t.categoryId].name,level:{1:"一级分类",2:"二级分类",3:"三级分类"}[o[t.categoryId].depth]})}));case 25:(r=s.assessmentGenerateRule.difficulty).simple&&r.normal&&r.difficulty&&(e.difficultyVisible=!0,e.difficultyScales.simple.scale=n()("".concat(r.simple)),e.difficultyScales.normal.scale=n()("".concat(r.normal)),e.difficultyScales.difficulty.scale=n()("".concat(r.difficulty)));case 27:e.testPaperFormState.description&&e.onDescriptionInputFocus();case 28:case"end":return t.stop()}}),t)})))()}},L=Object(f.a)(M,(function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"test-create"},[s("test-paper-save-header",{attrs:{type:e.testPaperFormState.type,"paper-question-count":e.paperQuestionCount,"paper-score":e.paperScore},on:{"back-confirm":e.backConfirm}}),e._v(" "),s("div",{staticClass:"test-create-content"},[e.isPersonalTestPaper?s("a-alert",{attrs:{message:"个性卷 —— 个性化纠错练习，提升学员对知识的全面掌握，错题，新题优先作答，错误率较高的知识点反个性习，提升掌握度！",type:"success",closable:"","show-icon":""}},[s("template",{slot:"icon"},[s("img",{attrs:{src:"/static-dist/app/img/question-bank/testpaperAiIcon.png",alt:""}})])],2):e._e(),e._v(" "),s("a-form",{staticClass:"test-paper-save-form",attrs:{id:"test-create-form",form:e.form}},[s("div",{staticClass:"test-paper-save-form-item test-paper-save-form-item-align-flex-start"},[s("div",{staticClass:"test-paper-save-form-item-label"},[s("span",{staticClass:"test-paper-save-form-item-label-required"},[e._v("*")]),e._v(" "),s("span",{staticClass:"test-paper-save-form-item-label-text"},[e._v("试卷名称")])]),e._v(" "),s("a-form-item",[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["name",{initialValue:e.testPaperFormState.name,rules:[{required:!0,message:"请输入试卷名称"}]}],expression:"[\n                'name',\n                { initialValue: testPaperFormState.name, rules: [{ required: true, message: '请输入试卷名称' }] },\n              ]"}],attrs:{placeholder:"请输入试卷名称",maxLength:50},on:{change:e.handleChangeName}}),e._v(" "),s("span",{staticClass:"max-num"},[e._v(e._s(e.testPaperFormState.name?e.testPaperFormState.name.length:0)+"/50")])],1)],1),e._v(" "),s("div",{staticClass:"test-paper-save-form-item test-paper-save-form-item-align-flex-start"},[s("div",{staticClass:"test-paper-save-form-item-label"},[s("span",{staticClass:"test-paper-save-form-item-label-text"},[e._v("试卷说明")])]),e._v(" "),s("a-form-item",[s("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["description",{initialValue:"",rules:[{required:!1,max:500,message:"超出 500  个字符长度限制"}]}],expression:"[\n                'description',\n                { initialValue: '', rules: [{ required: false, max: 500, message: '超出 500  个字符长度限制' }, ] },\n              ]"},{name:"show",rawName:"v-show",value:!e.descriptionEditorVisible,expression:"!descriptionEditorVisible"}],attrs:{placeholder:"请输入试卷说明"},on:{focus:e.onDescriptionInputFocus}}),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.descriptionEditorVisible,expression:"!descriptionEditorVisible"}],staticClass:"max-num"},[e._v("0/500")]),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:e.descriptionEditorVisible,expression:"descriptionEditorVisible"}]},[s("a-textarea",{attrs:{name:"test-paper-description"}})],1)],1)],1),e._v(" "),e.isPersonalTestPaper?e._e():s("div",{staticClass:"test-paper-save-form-item test-paper-save-form-item-align-flex-start"},[s("div",{staticClass:"test-paper-save-form-item-label"},[s("span",{staticClass:"test-paper-save-form-item-label-required"},[e._v("*")]),e._v(" "),s("span",{staticClass:"test-paper-save-form-item-label-text"},[e._v("试卷份数")])]),e._v(" "),s("div",{staticClass:"test-paper-number"},[s("a-form-item",[s("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["num",{initialValue:e.testPaperFormState.num,rules:[{required:!0,message:"请至少设置 1 份试卷"}]}],expression:"[\n                  'num',\n                  { initialValue: testPaperFormState.num, rules: [{ required: true, message: '请至少设置 1 份试卷' }, ] },\n                ]"}],attrs:{id:"inputNumber",min:1,max:200},on:{change:e.handleChangeNum}})],1),e._v(" "),s("span",{staticClass:"test-paper-number-text"},[e._v("≤200")]),e._v(" "),s("a-tooltip",{attrs:{overlayClassName:"test-paper-number-tips"}},[s("template",{slot:"title"},[e._v("\n                为了确保每位学生都能获得丰富多样的学习体验，并考虑到系统处理效率及资源分配的最优状态，我们精心设定了试卷生成的灵活性与合理性平衡点。目前，系统支持您创建最多200张独特的随机试卷\n              ")]),e._v(" "),s("img",{staticClass:"test-paper-number-tips-icon",attrs:{src:"/static-dist/app/img/question-bank/test-num-tips.png",alt:""}})],2)],1)]),e._v(" "),s("div",{staticClass:"extraction-method-content"},[s("div",{staticClass:"extraction-method-content-setting"},[s("div",{staticClass:"test-paper-save-form-item"},[s("div",{staticClass:"test-paper-save-form-item-label"},[s("span",{staticClass:"test-paper-save-form-item-label-text"},[e._v("抽题方式")])]),e._v(" "),s("a-radio-group",{model:{value:e.testPaperFormState.generateType,callback:function(t){e.$set(e.testPaperFormState,"generateType",t)},expression:"testPaperFormState.generateType"}},[s("a-radio",{attrs:{value:"questionType"}},[e._v("按题型抽题")]),e._v(" "),e.isPersonalTestPaper?e._e():s("a-radio",{attrs:{value:"questionTypeCategory"}},[e._v("按题型+分类抽题")])],1)],1),e._v(" "),"questionType"===e.testPaperFormState.generateType?s("question-type-display-set-menu",{attrs:{"question-type-display-settings":e.questionTypeDisplaySettings,"setting-key":e.testPaperFormState.generateType},on:{updateQuestionTypeDisplaySetting:e.onQuestionTypeDisplaySettingUpdate}}):e._e()],1),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"questionType"===e.testPaperFormState.generateType,expression:"testPaperFormState.generateType === 'questionType'"}],staticClass:"question-type-display"},[s("div",{staticClass:"question-type-display-header"},[s("div",{staticClass:"question-type-display-header-top"},[e._v("题型设置")]),e._v(" "),s("div",{staticClass:"question-type-display-header-normal",class:{"row-editing":"number"===e.editingRow}},[e._v("\n                题目数量\n              ")]),e._v(" "),s("div",{staticClass:"question-type-display-header-normal",class:{"row-editing":"score"===e.editingRow}},[e._v("\n                每题分值\n              ")]),e._v(" "),s("div",{staticClass:"question-type-display-header-bottom"},[s("span",{staticClass:"question-type-display-header-bottom-title"},[e._v("合计")]),e._v(" "),s("span",{staticClass:"question-type-display-header-bottom-description"},[e._v("（题数/总分）")])])]),e._v(" "),e._l(e.questionTypeDisplaySettings.questionType,(function(t){return s("div",{directives:[{name:"show",rawName:"v-show",value:t.checked,expression:"type.checked"}],staticClass:"question-type-display-col"},[s("div",{staticClass:"question-type-display-header-top"},[s("span",{staticClass:"question-type-display-header-top-text"},[e._v(e._s(t.name))])]),e._v(" "),s("div",{staticClass:"question-type-display-cell-number",class:{"row-editing":"number"===e.editingRow,"question-type-display-cell-number-disable":0===e.questionCounts[t.type].total}},[s("span",{directives:[{name:"show",rawName:"v-show",value:e.questionCounts[t.type].total>0,expression:"questionCounts[type.type].total > 0"}],staticClass:"question-type-display-cell-number-edit"},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.questionCounts[t.type].choose,expression:"questionCounts[type.type].choose"}],attrs:{type:"number"},domProps:{value:e.questionCounts[t.type].choose},on:{focus:function(t){e.editingRow="number"},blur:function(s){return e.onInputCountBlur(t.type)},input:function(s){s.target.composing||e.$set(e.questionCounts[t.type],"choose",s.target.value)}}})]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:0===e.questionCounts[t.type].total,expression:"questionCounts[type.type].total === 0"}],staticClass:"question-type-display-cell-number-total"},[e._v(e._s(e.questionCounts[t.type].total))]),e._v(" "),s("span",{staticClass:"question-type-display-cell-number-total"},[e._v("/"+e._s(e.questionCounts[t.type].total))])]),e._v(" "),s("div",{staticClass:"question-type-display-cell-score",class:{"row-editing":"score"===e.editingRow}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.scores.questionType[t.type],expression:"scores.questionType[type.type]"}],attrs:{type:"number"},domProps:{value:e.scores.questionType[t.type]},on:{focus:function(t){e.editingRow="score"},blur:function(s){return e.onInputScoreBlur(t.type)},input:function(s){s.target.composing||e.$set(e.scores.questionType,t.type,s.target.value)}}})]),e._v(" "),s("div",{staticClass:"question-type-display-cell-sum"},[e._v(e._s(e.questionCounts[t.type].choose)+" / "+e._s(e.sumScore(t.type)))])])}))],2),e._v(" "),s("div",{directives:[{name:"show",rawName:"v-show",value:"questionTypeCategory"===e.testPaperFormState.generateType,expression:"testPaperFormState.generateType === 'questionTypeCategory'"}],staticClass:"question-category-choose"},[s("question-category-select-drawer",{attrs:{bankId:e.bankId,"selected-categories":e.selectedQuestionCategories},on:{"save-selected-categories":e.onQuestionCategoriesSelected}}),e._v(" "),s("question-type-category-display",{directives:[{name:"show",rawName:"v-show",value:e.selectedQuestionCategories.length>0,expression:"selectedQuestionCategories.length > 0"}],attrs:{"question-type-display-settings":e.questionTypeDisplaySettings,"question-type-display-setting-key":e.testPaperFormState.generateType,categories:e.selectedQuestionCategories,scores:e.scores.questionTypeCategory,"question-counts":e.questionCounts,"bank-id":e.bankId},on:{updateCategories:e.onQuestionCategoriesSelected,updateQuestionTypeDisplaySetting:e.onQuestionTypeDisplaySettingUpdate,updateQuestionConfigs:e.onQuestionConfigsUpdate}})],1)]),e._v(" "),e.isPersonalTestPaper?s("div",{staticClass:"test-paper-save-form-item"},[s("div",{staticClass:"test-paper-save-form-item-label"},[s("span",{staticClass:"test-paper-save-form-item-label-text"},[e._v("错题比例")])]),e._v(" "),s("div",{staticClass:"test-paper-number"},[s("a-form-item",[s("a-input-number",{directives:[{name:"decorator",rawName:"v-decorator",value:["wrongQuestionRate",{initialValue:e.testPaperFormState.wrongQuestionRate,rules:[{required:!0,message:"请填写错题比例"}]}],expression:"[\n                  'wrongQuestionRate',\n                  { initialValue: testPaperFormState.wrongQuestionRate, rules: [{ required: true, message: '请填写错题比例' }, ] },\n                ]"}],attrs:{id:"inputNumber",min:0,max:100},on:{change:e.handleChangeWrongRate}})],1),e._v(" "),s("span",{staticClass:"test-paper-number-text"},[e._v("%")])],1)]):e._e(),e._v(" "),e.isPersonalTestPaper?e._e():s("div",{staticClass:"test-paper-save-form-item"},[s("div",{staticClass:"test-paper-save-form-item-label"},[s("span",{staticClass:"test-paper-save-form-item-label-text"},[e._v("难度调节")])]),e._v(" "),s("a-switch",{attrs:{"checked-children":"开启","un-checked-children":"关闭"},model:{value:e.difficultyVisible,callback:function(t){e.difficultyVisible=t},expression:"difficultyVisible"}})],1),e._v(" "),e.isPersonalTestPaper?e._e():s("div",{directives:[{name:"show",rawName:"v-show",value:e.difficultyVisible,expression:"difficultyVisible"}],staticClass:"test-paper-difficulty"},[s("div",{staticClass:"test-paper-save-form-item"},[s("div",{staticClass:"test-paper-save-form-item-label"},[s("span",{staticClass:"test-paper-save-form-item-label-text"},[e._v("试卷难度")])]),e._v(" "),s("a-slider",{staticClass:"test-paper-difficulty-slider",attrs:{range:"","default-value":[e.difficultyScales.simple.scale,e.difficultyScales.normal.scale+e.difficultyScales.difficulty.scale],tooltipVisible:!1},on:{change:e.onSliderChange}})],1),e._v(" "),s("div",{staticClass:"test-paper-difficulty-content"},[s("div",{staticClass:"test-paper-difficulty-scale"},e._l(e.difficultyScales,(function(t,i){return s("span",{staticClass:"test-paper-difficulty-scale-text"},[e._v(e._s(t.text)+" "+e._s(t.scale)+"%")])})),0),e._v(" "),s("span",{staticClass:"test-paper-difficulty-tips"},[e._v("如果某个难度的题目数不够，将会随机选择题目来补充")])])])])],1),e._v(" "),s("div",{staticClass:"test-paper-save-footer"},[s("button",{staticClass:"test-paper-save",on:{click:e.saveTestPaper}},[e._v(e._s("create"===e.$route.name?"创建":"保存"))]),e._v(" "),s("button",{staticClass:"test-create-cancel",on:{click:e.backConfirm}},[e._v("取消")])])],1)}),[],!1,null,null,null);t.default=L.exports}}]);