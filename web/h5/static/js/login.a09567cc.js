(window.webpackJsonp=window.webpackJsonp||[]).push([["login"],{7067:function(e,t,i){"use strict";i("e17f");var n=i("2241"),s=(i("e7e5"),i("d399")),a=i("a026"),r=i("3ce7"),o=/micromessenger/.test(navigator.userAgent.toLowerCase());t.a=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||i&&!t)s.a.fail("缺少分享参数");else{var c={domainUri:location.origin,itemUri:"",source:"h5"};r.a.marketingActivities({query:{activityId:e},data:c}).then((function(e){var r=-1!==e.url.indexOf("?")?"&":"?",c=i?"".concat(t).concat(r,"ticket=").concat(e.ticket):e.url;o?window.location.href=c:n.a.confirm({message:"去微信完成活动",confirmButtonText:"复制链接",title:""}).then((function(){try{a.default.prototype.$copyText(c).then((function(){s.a.success("复制成功")}),(function(){s.a.fail("请更换浏览器复制")}))}catch(e){s.a.fail("请更换浏览器复制")}})).catch((function(){}))})).catch((function(e){s.a.fail(e.message)}))}}},"876e":function(e,t,i){},"89eb":function(e,t,i){"use strict";i.r(t),i("e7e5");var n=i("d399"),s=i("db72"),a=i("2f62"),r=i("3ce7"),o={data:function(){return{username:"",password:"",faceRegistered:0,errorMessage:{password:""}}},computed:{btnSubmitDisable:function(){return!this.username},btnDisable:function(){return!(this.username&&this.password)}},methods:Object(s.a)(Object(s.a)({},Object(a.c)(["userLogin"])),{},{onSubmitInfo:function(){var e,t=this;e=/^1\d{10}$/.test(this.username)?"mobile":/^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(this.username)?"email":"nickname",r.a.getUserIsExisted({query:{type:this.username},params:{identifyType:e}}).then((function(e){e.id?"0"===e.faceRegistered?(t.faceRegistered=e.faceRegistered,Object(n.a)({duration:2e3,message:"初次使用请验证密码"})):t.$router.push({name:"verification",query:{redirect:t.$route.query.redirect||"",loginToken:t.$route.query.loginToken||"",type:"compare",faceRegistered:0,loginField:t.username}}):n.a.fail({duration:2e3,message:"用户不存在"})})).catch((function(e){n.a.fail(e.message)}))},checkName:function(){this.faceRegistered=0},onCheckExisted:function(){var e=this;this.userLogin({username:this.username,password:this.password}).then((function(t){e.$router.push({name:"verification",query:{redirect:e.$route.query.redirect||"",loginToken:e.$route.query.loginToken||"",type:"register",faceRegistered:1}})})).catch((function(e){n.a.fail(e.message)}))}})},c=i("2877"),u=Object(c.a)(o,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"login"},[t("span",{staticClass:"login-title"},[e._v("确认账号")]),t("van-field",{staticClass:"login-input e-input",attrs:{placeholder:"请输入邮箱/手机/用户名"},on:{input:e.checkName},model:{value:e.username,callback:function(t){e.username="string"==typeof t?t.trim():t},expression:"username"}}),e.faceRegistered?t("van-field",{staticClass:"login-input e-input",attrs:{"error-message":e.errorMessage.password,type:"password",placeholder:"请输入密码"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}):e._e(),e.faceRegistered?t("van-button",{staticClass:"primary-btn mb20",attrs:{disabled:e.btnDisable,type:"default"},on:{click:e.onCheckExisted}},[e._v("下一步")]):t("van-button",{staticClass:"primary-btn mb20",attrs:{disabled:e.btnSubmitDisable,type:"default"},on:{click:e.onSubmitInfo}},[e._v("下一步")])],1)}),[],!1,null,null,null);t.default=u.exports},affc:function(e,t,i){"use strict";i.r(t),i("a481"),i("c5f6");var n=i("db72"),s=i("c80c"),a=(i("e7e5"),i("d399")),r=(i("96cf"),i("3b8d")),o=i("d863"),c=i("2f62"),u=i("3ce7"),l={mixins:[o.a],data:function(){return{username:"",password:"",errorMessage:{password:""},faceSetting:0,bodyHeight:520,loginConfig:{},cloudSetting:!1,userTerms:!1,privacyPolicy:!1,agreement:!1,popUpBottom:!1}},computed:{btnDisable:function(){return!(this.username&&this.password)},isWeixinBrowser:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())},canloginConfig:function(){return!this.$route.query||!this.$route.query.forbidWxLogin}},created:function(){var e=this;return Object(r.a)(Object(s.a)().mark((function t(){return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.$store.state.token){t.next=4;break}return a.a.loading({message:e.$t("toast.pleaseWait")}),e.afterLogin(),t.abrupt("return");case 4:return t.next=6,u.a.getSettings({query:{type:"register"}}).catch((function(e){a.a.fail(e.message)}));case 6:e.registerSettings=t.sent,e.getsettingsCloud(),e.getPrivacySetting();case 9:case"end":return t.stop()}}),t)})))()},mounted:function(){this.bodyHeight=document.documentElement.clientHeight-46,this.username=this.$route.params.username||this.$route.query.account||"",a.a.loading({message:this.$t("toast.pleaseWait")}),this.faceLogin(),this.thirdPartyLogin()},methods:Object(n.a)(Object(n.a)({},Object(c.c)(["userLogin"])),{},{getPrivacySetting:function(){var e=this;return Object(r.a)(Object(s.a)().mark((function t(){return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.getSettings({query:{type:"user"}}).then((function(t){t.auth.user_terms_enabled&&(e.userTerms=!0),t.auth.privacy_policy_enabled&&(e.privacyPolicy=!0)})).catch((function(e){a.a.fail(e.message)}));case 2:case"end":return t.stop()}}),t)})))()},lookPrivacyPolicy:function(){window.location.href=window.location.origin+"/mapi_v2/School/getPrivacyPolicy"},lookUserTerms:function(){window.location.href=window.location.origin+"/mapi_v2/School/getUserterms"},getsettingsCloud:function(){var e=this;return Object(r.a)(Object(s.a)().mark((function t(){return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,u.a.settingsCloud().then((function(t){e.cloudSetting=!!t.sms_enabled})).catch((function(e){a.a.fail(e.message)}));case 2:case"end":return t.stop()}}),t)})))()},onSubmit:function(e){var t=this;this.agreement||!1===this.privacyPolicy&&!1===this.userTerms?this.userLogin({username:this.username,password:this.password}).then((function(e){a.a.success({duration:1e3,message:t.$t("toast.signInSuccessfully")}),t.afterLogin()})).catch((function(e){4000147===e.code?t.upgradePassword():a.a.fail(e.message)})):this.popUpBottom=!0},agreeSign:function(){var e=this;this.userLogin({username:this.username,password:this.password}).then((function(t){e.agreement=!0,e.popUpBottom=!1,a.a.success({duration:1e3,message:e.$t("toast.signInSuccessfully")}),e.afterLogin()})).catch((function(t){a.a.fail(t.message),e.popUpBottom=!1}))},jumpRegister:function(){this.registerSettings&&"closed"!==this.registerSettings.mode&&"email"!==this.registerSettings.mode?this.$router.push({name:"register",query:{redirect:this.$route.query.redirect||"/"}}):Object(a.a)(this.$t("toast.contactTheAdministrator"))},faceLogin:function(){var e=this;u.a.settingsFace({}).then((function(t){Number(t.login.enabled)?e.faceSetting=Number(t.login.h5_enabled):e.faceSetting=0})).catch((function(e){a.a.fail(e.message)}))},thirdPartyLogin:function(){var e=this;this.canloginConfig&&u.a.loginConfig({}).then((function(t){a.a.clear(),e.loginConfig=t,Number(t.weixinmob_enabled)&&e.isWeixinBrowser&&e.wxLogin()})).catch((function(e){a.a.fail(e.message),a.a.clear()}))},wxLogin:function(){this.$router.replace({path:"/auth/social",query:{type:"wx",weixinmob_key:this.loginConfig.weixinmob_key,redirect:this.$route.query.redirect||"/",callbackType:this.$route.query.callbackType,activityId:this.$route.query.activityId}})},changeLogin:function(){this.$route.query.redirect?this.$router.push({name:"fastlogin",query:{redirect:this.$route.query.redirect}}):this.$router.push({name:"fastlogin"})}})},d=(i("d39e"),i("2877")),g=Object(d.a)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"login",style:{height:e.bodyHeight+"px"}},[t("span",{staticClass:"login-title"},[e._v(e._s(e.$t("title.loginAccount")))]),t("img",{staticClass:"login-avatarimg",attrs:{src:""}}),t("van-field",{staticClass:"login-input e-input",attrs:{autosize:{maxHeight:24},border:!1,type:"textarea",placeholder:e.$t("placeholder.emailMobileNumberUserName")},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),t("van-field",{staticClass:"login-input e-input",attrs:{border:!1,"error-message":e.errorMessage.password,type:"password",placeholder:e.$t("placeholder.password")},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),t("div",{staticClass:"login-register"},[t("router-link",{staticClass:"login-account",attrs:{to:"/setting/password/reset"}},[e._v("\n      "+e._s(e.$t("btn.forgetPassword"))+" ？  |\n    ")]),t("span",{staticClass:"login-account",on:{click:e.jumpRegister}},[e._v("\n        "+e._s(e.$t("btn.registerNow"))+"  \n    ")])],1),t("div",{staticClass:"w-full btn-login"},[t("van-button",{staticClass:"primary-btn mb20 w-full",attrs:{disabled:e.btnDisable,type:"info"},on:{click:e.onSubmit}},[e._v(e._s(e.$t("btn.login")))])],1),t("div",{staticClass:"login-bottom text-center"},[e.userTerms||e.privacyPolicy?t("div",{staticClass:"login-agree"},[t("van-checkbox",{attrs:{"icon-size":16,"checked-color":"#408ffb"},model:{value:e.agreement,callback:function(t){e.agreement=t},expression:"agreement"}}),e._v("\n      "+e._s(e.$t("tips.iHaveReadAndAgreeToThe"))+"\n      "),e.userTerms?t("i",{on:{click:e.lookUserTerms}},[e._v("《"+e._s(e.$t("btn.userServiceAgreement"))+"》")]):e._e(),e.userTerms&&e.privacyPolicy?t("span",[e._v(e._s(e.$t("tips.and")))]):e._e(),e.privacyPolicy?t("span",[t("i",{on:{click:e.lookPrivacyPolicy}},[e._v("《"+e._s(e.$t("btn.privacyAgreemen"))+"》")])]):e._e()],1):e._e(),t("div",{directives:[{name:"show",rawName:"v-show",value:e.cloudSetting,expression:"cloudSetting"}],staticClass:"login-change",on:{click:e.changeLogin}},[t("img",{staticClass:"login_change-icon",attrs:{src:"static/images/login_change.png"}}),e._v(e._s(e.$t("btn.loginWithMobileNumber"))+"\n    ")])]),t("van-popup",{staticClass:"login-pop",style:{height:"30%"},attrs:{position:"bottom",round:""},model:{value:e.popUpBottom,callback:function(t){e.popUpBottom=t},expression:"popUpBottom"}},[t("div",{staticClass:"login-pop-title"},[e._v(e._s(e.$t("btn.PleaseReadAgreeAndTerms")))]),e.userTerms||e.privacyPolicy?t("div",{staticClass:"login-agree"},[e.userTerms?t("i",{on:{click:e.lookUserTerms}},[e._v("《"+e._s(e.$t("btn.userServiceAgreement"))+"》")]):e._e(),e.privacyPolicy?t("span",[t("i",{on:{click:e.lookPrivacyPolicy}},[e._v("《"+e._s(e.$t("btn.privacyAgreemen"))+"》")])]):e._e()]):e._e(),t("van-button",{staticClass:"primary-btn mb20 login-pop-btn",attrs:{disabled:e.btnDisable,type:"info"},on:{click:e.agreeSign}},[e._v(e._s(e.$t("btn.agreeAndSignin")))])],1)],1)}),[],!1,null,"3230cf6a",null);t.default=g.exports},d39e:function(e,t,i){"use strict";i("876e")},d863:function(e,t,i){"use strict";i("a481");var n=i("db72"),s=i("7067"),a=i("3ce7"),r=i("faa5"),o=i("2f62");t.a={data:function(){return{redirect:""}},computed:Object(n.a)({},Object(o.e)({user:function(e){return e.user}})),created:function(){this.redirect=decodeURIComponent(this.$route.fullPath)},methods:Object(n.a)(Object(n.a)({},Object(o.d)([r.w])),{},{afterLogin:function(){var e=this;this.checkMobileBind().then((function(t){var i=t.is_bind_mobile,n=t.mobile_bind_mode;e[r.w]({is_bind_mobile:i,mobile_bind_mode:n}),i||"closed"===n?setTimeout(e.jumpAction,1e3):e.$router.replace({name:"binding",query:{redirect:e.$route.query.redirect}})})).catch((function(){setTimeout(e.jumpAction,1e3)}))},jumpAction:function(){var e=this.$route.query.redirect?decodeURIComponent(this.$route.query.redirect):"/",t=this.$route.query.skipUrl?decodeURIComponent(this.$route.query.skipUrl):"",i=this.$route.query.callbackType,n=this.$route.query.activityId,a=decodeURIComponent(this.$route.query.callback);if(i)switch(i){case"marketing":Object(s.a)(n,a)}else t?this.$router.replace({path:e,query:{backUrl:t}}):this.$router.replace({path:e})},checkMobileBind:function(){return a.a.mobileBindCheck({query:{userId:this.user.id}})},upgradePassword:function(){this.$router.replace({name:"password_reset",query:{upgradePassword:1}})}})}}}]);