(window.webpackJsonp=window.webpackJsonp||[]).push([["marketingWxpay"],{"1b1f":function(e,t,n){"use strict";var r=n("e60d");n.n(r).a},8567:function(e,t,n){"use strict";n.r(t),n("8e6e"),n("ac6a"),n("456d"),n("e7e5");var r=n("d399"),a=(n("c5f6"),n("96cf"),n("3b8d")),i=n("bd86"),o=n("3ce7"),s=n("2f62");function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){Object(i.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var f={name:"MarketingWXPay",data:function(){return{isLoading:!1,payInfo:null,loginConfig:{}}},computed:u(u({},Object(s.e)({token:function(e){return e.token}})),{},{isWeixinBrowser:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())}}),created:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.token){t.next=3;break}return o.a.loginConfig({}).then((function(t){e.loginConfig=t,Number(t.weixinmob_enabled)&&e.isWeixinBrowser&&e.wxLogin()})),t.abrupt("return");case 3:if(n=e.$route.query.payToken||""){t.next=7;break}return r.a.fail("缺少关键信息"),t.abrupt("return");case 7:return t.next=9,o.a.getMarketingMallPayConfig({data:{token:n}});case 9:if(!1!==(a=t.sent).success){t.next=12;break}return t.abrupt("return");case 12:e.payInfo=a,e.handlePay();case 14:case"end":return t.stop()}}),t)})))()},methods:{handleAmount:function(e){return e/100},handlePay:function(){var e=this;return Object(a.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$route.query.payToken||"",t.next=3,o.a.checkMarketingMallPayConfig({params:{token:n}});case 3:if(!1!==t.sent.success){t.next=6;break}return t.abrupt("return");case 6:WeixinJSBridge.invoke("getBrandWCPayRequest",e.payInfo.config,(function(t){"get_brand_wcpay_request:ok"==t.err_msg?window.location.href=e.payInfo.redirectUrl+"&isNeedCheckOrderStatus=1&sn=".concat(e.payInfo.orderSn):"get_brand_wcpay_request:fail"==t.err_msg||t.err_msg}));case 7:case"end":return t.stop()}}),t)})))()},wxLogin:function(){this.$router.push({path:"/auth/social",query:{type:"wx",weixinmob_key:this.loginConfig.weixinmob_key,redirect:this.$route.query.redirect||this.$route.path,callbackType:this.$route.query.callbackType,activityId:this.$route.query.activityId}})}}},p=(n("1b1f"),n("0c7c")),l=Object(p.a)(f,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isWeixinBrowser&&e.payInfo?n("div",{staticClass:"marketing-wxpay"},[n("div",{staticClass:"marketing-wxpay__title"},[e._v(e._s(e.$t("marketingPay.amountLabel")))]),n("div",{staticClass:"marketing-wxpay__amount"},[n("span",{staticClass:"amount-unit"},[e._v("￥")]),n("span",{staticClass:"amount-number"},[e._v(e._s(e.payInfo.amount/100))])]),n("div",{staticClass:"marketing-wxpay__info"},[n("div",{staticClass:"info-label"},[e._v(e._s(e.$t("marketingPay.orderSnLabel")))]),n("div",{staticClass:"info-desc"},[e._v(e._s(e.payInfo.orderSn))])]),n("div",{staticClass:"marketing-wxpay__info",staticStyle:{border:"none"}},[n("div",{staticClass:"info-label"},[e._v(e._s(e.$t("marketingPay.acceptLabel")))]),n("div",{staticClass:"info-desc"},[e._v(e._s(e.payInfo.siteName))])]),n("div",{staticClass:"pay-btn",on:{click:e.handlePay}},[e._v("\n    "+e._s(e.$t("marketingPay.payNow"))+"\n  ")])]):e._e()}),[],!1,null,"7171b2b5",null);t.default=l.exports},e60d:function(e,t,n){}}]);