(window.webpackJsonp=window.webpackJsonp||[]).push([["password_reset"],{"6e0e":function(e,t,a){"use strict";a.r(t),a("a481"),a("e17f");var r=a("2241"),n=(a("e7e5"),a("d399")),o=(a("6762"),a("2fdb"),a("db72")),s=a("c80c"),c=(a("96cf"),a("3b8d")),i=a("3ce7"),d=a("f13d"),u=a("2f62"),h=(a("8e6c"),a("7185")),l={name:"PasswordReset",components:{EDrag:d.a},data:function(){return{resetInfo:{account:"",accountType:"",dragCaptchaToken:"",encrypt_password:"",smsCode:"",smsToken:"",type:"register"},dragKey:0,errorMessage:{account:"",encrypt_password:""},validated:{account:!1,encrypt_password:!1},count:{showCount:!1,num:120,codeBtnDisable:!1},isEmail:!1,smsEnable:!1}},created:function(){var e=this;return Object(c.a)(Object(s.a)().mark((function t(){return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.getEmailServiceState(),t.next=3,e.getSmsSetting();case 3:case"end":return t.stop()}}),t)})))()},computed:Object(o.a)(Object(o.a)({},Object(u.e)({isLoading:function(e){return e.isLoading}})),{},{btnDisable:function(){return!(this.resetInfo.account&&this.resetInfo.encrypt_password&&this.resetInfo.smsCode||"email"===this.accountType)},accountType:function(){return this.smsEnable?this.isEmail&&this.resetInfo.account.includes("@")?"email":"mobile":"email"},accountPlaceHolder:function(){return this.smsEnable?this.isEmail?this.$t("placeholder.mobileNumberOrEmail"):this.$t("placeholder.mobileNumber"):this.$t("placeholder.email")},upgradePassword:function(){return this.$route.query.upgradePassword}}),methods:{validateAccountOrPsw:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"account",t=this.resetInfo[e],a="account"===e?h.a[this.accountType]:h.a[e];return 0==t.length?(this.errorMessage[e]="",!1):"encrypt_password"===e&&t.length>32?(this.errorMessage[e]=this.$t("toast.enterUpTo32Characters"),!1):void(this.errorMessage[e]=a.validator(t)?"":a.message)},validatedChecker:function(){var e=this.resetInfo.account,t=this.accountType,a=h.a[t];this.validated.account=a.validator(e)},handleSmsSuccess:function(e){this.resetInfo.dragCaptchaToken=e},handleSubmit:function(){var e=this;if(this.$refs.dragComponent.dragToEnd){var t=Object.assign({},this.resetInfo),a=t.encrypt_password,o=t.account,s=window.XXTEA.encryptToBase64(a,window.location.host);if(t.encrypt_password=s,"email"!==this.accountType)i.a.resetPasswordByMobile({query:{mobile:o},data:{smsToken:t.smsToken,smsCode:t.smsCode,encrypt_password:t.encrypt_password}}).then((function(t){r.a.alert({message:e.$t("toast.oasswordResetSuccessful"),confirmButtonText:e.$t("btn.confirm")}).then((function(){e.$router.replace({name:"login",params:{username:o}})}))})).catch((function(e){n.a.fail(e.message)}));else{var c=this.resetInfo.dragCaptchaToken;i.a.resetPasswordByEmail({query:{email:o},data:{dragCaptchaToken:c}}).then((function(t){r.a.alert({message:e.$t("toast.verificationLinkHasBeenSentTo")+o,confirmButtonText:e.$t("btn.confirm")}).then((function(){e.$router.replace({name:"login",params:{username:o}})}))})).catch((function(t){switch(t.code){case 4030301:case 4030302:e.dragKey++,e.resetInfo.dragCaptchaToken=""}n.a.fail(t.message)}))}}else Object(n.a)(this.$t("toast.pleaseCompleteThePuzzleVerification"))},clickSmsBtn:function(){this.$refs.dragComponent.dragToEnd?this.handleSendSms():Object(n.a)(this.$t("toast.pleaseCompleteThePuzzleVerification"))},handleSendSms:function(){var e=this,t=this.resetInfo.account,a=this.resetInfo.dragCaptchaToken;i.a.resetPasswordSMS({query:{mobile:t},data:{dragCaptchaToken:a}}).then((function(t){e.resetInfo.smsToken=t.smsToken,e.countDown()})).catch((function(t){switch(t.code){case 4030301:case 4030302:e.dragKey++,e.resetInfo.dragCaptchaToken="",e.resetInfo.smsToken=""}n.a.fail(t.message)}))},countDown:function(){var e=this;this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=120;var t=setInterval((function(){if(e.count.num<=0)return e.count.codeBtnDisable=!1,e.count.showCount=!1,void clearInterval(t);e.count.num--}),1e3)},getEmailServiceState:function(){var e=this;i.a.getEmailServiceState().then((function(t){e.isEmail=t.enabled}))},getSmsSetting:function(){var e=this;return Object(c.a)(Object(s.a)().mark((function t(){var a;return Object(s.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.settingsCloud().catch((function(e){n.a.fail(e.message)}));case 2:a=t.sent,e.smsEnable=!!a.sms_enabled;case 4:case"end":return t.stop()}}),t)})))()}}},f=a("2877"),g=Object(f.a)(l,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"password-reset"},[e.isLoading?t("e-loading"):e._e(),e.upgradePassword?t("div",{staticClass:"alert-danger"},[e._v("检测到您当前密码等级较低，请重新设置密码")]):e._e(),t("span",{staticClass:"register-title"},[e._v(e._s(e.$t("title.retrievePassword")))]),t("e-drag",{key:e.dragKey,ref:"dragComponent",on:{success:e.handleSmsSuccess}}),t("van-field",{attrs:{"error-message":e.errorMessage.account,placeholder:e.accountPlaceHolder},on:{blur:function(t){return e.validateAccountOrPsw("account")},keyup:function(t){return e.validatedChecker()}},model:{value:e.resetInfo.account,callback:function(t){e.$set(e.resetInfo,"account",t)},expression:"resetInfo.account"}}),t("van-field",{directives:[{name:"show",rawName:"v-show",value:"mobile"===e.accountType,expression:"accountType === 'mobile'"}],attrs:{"error-message":e.errorMessage.encrypt_password,type:"password","max-length":"32",placeholder:e.$t("placeholder.setPassword")},on:{blur:function(t){return e.validateAccountOrPsw("encrypt_password")}},model:{value:e.resetInfo.encrypt_password,callback:function(t){e.$set(e.resetInfo,"encrypt_password",t)},expression:"resetInfo.encrypt_password"}}),t("van-field",{directives:[{name:"show",rawName:"v-show",value:"mobile"===e.accountType,expression:"accountType === 'mobile'"}],attrs:{type:"text",center:"",clearable:"","max-length":"6",placeholder:e.$t("placeholder.verificationCode")},model:{value:e.resetInfo.smsCode,callback:function(t){e.$set(e.resetInfo,"smsCode",t)},expression:"resetInfo.smsCode"}},[t("van-button",{attrs:{slot:"button",disabled:e.count.codeBtnDisable||!e.validated.account,size:"small",type:"primary"},on:{click:e.clickSmsBtn},slot:"button"},[e._v("\n      "+e._s(e.$t("btn.sendCode"))+"\n      "),t("span",{directives:[{name:"show",rawName:"v-show",value:e.count.showCount,expression:"count.showCount"}]},[e._v("("+e._s(e.count.num)+")")])])],1),t("van-button",{staticClass:"primary-btn mb20",attrs:{disabled:e.btnDisable,type:"default"},on:{click:e.handleSubmit}},[e._v(e._s(e.$t("btn.confirm")))])],1)}),[],!1,null,null,null);t.default=g.exports},"8e6c":function(e,t,a){"use strict";a("6b54"),a("28a5"),function(e){var t,a;void 0===e.btoa&&(e.btoa=(t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split(""),function(e){var a,r,n,o,s,c,i;for(r=n=0,o=e.length,c=(o-=s=o%3)/3<<2,s>0&&(c+=4),a=new Array(c);r<o;)i=e.charCodeAt(r++)<<16|e.charCodeAt(r++)<<8|e.charCodeAt(r++),a[n++]=t[i>>18]+t[i>>12&63]+t[i>>6&63]+t[63&i];return 1==s?(i=e.charCodeAt(r++),a[n++]="".concat(t[i>>2]+t[(3&i)<<4],"==")):2==s&&(i=e.charCodeAt(r++)<<8|e.charCodeAt(r++),a[n++]="".concat(t[i>>10]+t[i>>4&63]+t[(15&i)<<2],"=")),a.join("")})),void 0===e.atob&&(e.atob=(a=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],function(e){var t,r,n,o,s,c,i,d,u,h;if((i=e.length)%4!=0)return"";if(/[^ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\+\/\=]/.test(e))return"";for(u=i,(d="="==e.charAt(i-2)?1:"="==e.charAt(i-1)?2:0)>0&&(u-=4),u=3*(u>>2)+d,h=new Array(u),s=c=0;s<i&&-1!=(t=a[e.charCodeAt(s++)])&&-1!=(r=a[e.charCodeAt(s++)])&&(h[c++]=String.fromCharCode(t<<2|(48&r)>>4),-1!=(n=a[e.charCodeAt(s++)]))&&(h[c++]=String.fromCharCode((15&r)<<4|(60&n)>>2),-1!=(o=a[e.charCodeAt(s++)]));)h[c++]=String.fromCharCode((3&n)<<6|o);return h.join("")}));var r=2654435769;function n(e,t){var a=e.length,r=a<<2;if(t){var n=e[a-1];if(n<(r-=4)-3||n>r)return null;r=n}for(var o=0;o<a;o++)e[o]=String.fromCharCode(255&e[o],e[o]>>>8&255,e[o]>>>16&255,e[o]>>>24&255);var s=e.join("");return t?s.substring(0,r):s}function o(e,t){var a,r=e.length,n=r>>2;0!=(3&r)&&++n,t?(a=new Array(n+1))[n]=r:a=new Array(n);for(var o=0;o<r;++o)a[o>>2]|=e.charCodeAt(o)<<((3&o)<<3);return a}function s(e){return 4294967295&e}function c(e,t,a,r,n,o){return(a>>>5^t<<2)+(t>>>3^a<<4)^(e^t)+(o[3&r^n]^a)}function i(e){return e.length<4&&(e.length=4),e}function d(e){if(/^[\x00-\x7f]*$/.test(e))return e;for(var t=[],a=e.length,r=0,n=0;r<a;++r,++n){var o=e.charCodeAt(r);if(o<128)t[n]=e.charAt(r);else if(o<2048)t[n]=String.fromCharCode(192|o>>6,128|63&o);else{if(!(o<55296||o>57343)){if(r+1<a){var s=e.charCodeAt(r+1);if(o<56320&&s>=56320&&s<=57343){var c=65536+((1023&o)<<10|1023&s);t[n]=String.fromCharCode(240|c>>18&63,128|c>>12&63,128|c>>6&63,128|63&c),++r;continue}}throw new Error("Malformed string")}t[n]=String.fromCharCode(224|o>>12,128|o>>6&63,128|63&o)}}return t.join("")}function u(e,t){return(void 0===t||null===t||t<0)&&(t=e.length),0===t?"":/^[\x00-\x7f]*$/.test(e)||!/^[\x00-\xff]*$/.test(e)?t===e.length?e:e.substr(0,t):t<65535?function(e,t){for(var a=new Array(t),r=0,n=0,o=e.length;r<t&&n<o;r++){var s=e.charCodeAt(n++);switch(s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a[r]=s;break;case 12:case 13:if(!(n<o))throw new Error("Unfinished UTF-8 octet sequence");a[r]=(31&s)<<6|63&e.charCodeAt(n++);break;case 14:if(!(n+1<o))throw new Error("Unfinished UTF-8 octet sequence");a[r]=(15&s)<<12|(63&e.charCodeAt(n++))<<6|63&e.charCodeAt(n++);break;case 15:if(!(n+2<o))throw new Error("Unfinished UTF-8 octet sequence");var c=((7&s)<<18|(63&e.charCodeAt(n++))<<12|(63&e.charCodeAt(n++))<<6|63&e.charCodeAt(n++))-65536;if(!(c>=0&&c<=1048575))throw new Error("Character outside valid Unicode range: 0x".concat(c.toString(16)));a[r++]=c>>10&1023|55296,a[r]=1023&c|56320;break;default:throw new Error("Bad UTF-8 encoding 0x".concat(s.toString(16)))}}return r<t&&(a.length=r),String.fromCharCode.apply(String,a)}(e,t):function(e,t){for(var a=[],r=new Array(32768),n=0,o=0,s=e.length;n<t&&o<s;n++){var c=e.charCodeAt(o++);switch(c>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r[n]=c;break;case 12:case 13:if(!(o<s))throw new Error("Unfinished UTF-8 octet sequence");r[n]=(31&c)<<6|63&e.charCodeAt(o++);break;case 14:if(!(o+1<s))throw new Error("Unfinished UTF-8 octet sequence");r[n]=(15&c)<<12|(63&e.charCodeAt(o++))<<6|63&e.charCodeAt(o++);break;case 15:if(!(o+2<s))throw new Error("Unfinished UTF-8 octet sequence");var i=((7&c)<<18|(63&e.charCodeAt(o++))<<12|(63&e.charCodeAt(o++))<<6|63&e.charCodeAt(o++))-65536;if(!(i>=0&&i<=1048575))throw new Error("Character outside valid Unicode range: 0x".concat(i.toString(16)));r[n++]=i>>10&1023|55296,r[n]=1023&i|56320;break;default:throw new Error("Bad UTF-8 encoding 0x".concat(c.toString(16)))}if(n>=32766){var d=n+1;r.length=d,a[a.length]=String.fromCharCode.apply(String,r),t-=d,n=-1}}return n>0&&(r.length=n,a[a.length]=String.fromCharCode.apply(String,r)),a.join("")}(e,t)}function h(e,t){return void 0===e||null===e||0===e.length?e:(e=d(e),t=d(t),n(function(e,t){var a,n,o,i,d,u,h=e.length,l=h-1;for(n=e[l],o=0,u=0|Math.floor(6+52/h);u>0;--u){for(i=(o=s(o+r))>>>2&3,d=0;d<l;++d)a=e[d+1],n=e[d]=s(e[d]+c(o,a,n,d,i,t));a=e[0],n=e[l]=s(e[l]+c(o,a,n,l,i,t))}return e}(o(e,!0),i(o(t,!1))),!1))}function l(e,t){return void 0===e||null===e||0===e.length?e:(t=d(t),u(n(function(e,t){var a,n,o,i,d,u=e.length,h=u-1;for(a=e[0],o=s(Math.floor(6+52/u)*r);0!==o;o=s(o-r)){for(i=o>>>2&3,d=h;d>0;--d)n=e[d-1],a=e[d]=s(e[d]-c(o,a,n,d,i,t));n=e[h],a=e[0]=s(e[0]-c(o,a,n,0,i,t))}return e}(o(e,!1),i(o(t,!1))),!0)))}e.XXTEA={utf8Encode:d,utf8Decode:u,encrypt:h,encryptToBase64:function(t,a){return e.btoa(h(t,a))},decrypt:l,decryptFromBase64:function(t,a){return void 0===t||null===t||0===t.length?t:l(e.atob(t),a)}}}(window)},f13d:function(e,t,a){"use strict";var r=a("75fc"),n=(a("e7e5"),a("d399")),o=a("db72"),s=(a("c5f6"),a("3ce7")),c={props:{tips:{type:String,default:"placeholder.dragTheSliderToCompleteThePuzzle"},limitType:{type:String,default:""}},data:function(){return{imgInfo:{url:"",jigsaw:"",token:""},dragState:{left:0,width:0,currentX:0,currentLeft:0,btnWidth:0,maskWidth:0},dragToEnd:!1}},created:function(){this.initDragCaptcha()},mounted:function(){var e=this.$refs.bar,t=this.$refs.dragBtn,a=e.getBoundingClientRect();Object.assign(this.dragState,{left:Number(a.left.toFixed(2)),width:e.clientWidth,btnWidth:t.offsetWidth/2})},methods:{initDragCaptcha:function(){var e=this,t={};this.limitType&&(t={limitType:this.limitType}),s.a.dragCaptcha({data:t}).then((function(t){e.imgInfo=Object(o.a)({},t),Object.assign(e.dragState,{currentLeft:0,maskWidth:0}),e.dragToEnd=!1})).catch((function(e){n.a.fail(e.message)}))},handletTouchEnd:function(){var e=this;if(!this.dragToEnd&&this.dragState.currentLeft){var t=this.getToken();this.dragToEnd=!0,s.a.dragValidate({query:{token:t}}).then((function(a){n.a.success(e.$t("e.verificationSuccess")),e.$emit("success",t)})).catch((function(t){n.a.fail(t.message),e.initDragCaptcha()}))}},handleTouchMove:function(e){if(!this.dragToEnd){e.preventDefault();var t=this.$refs.dragBtn,a=this.dragState,r=e.clientX?e.clientX.toFixed(2):e.targetTouches[0].pageX.toFixed(2)-this.$refs.drag.offsetLeft,n=(r-a.left-a.btnWidth).toFixed(2);n<0&&(n=0),r>a.width+this.$refs.drag.offsetLeft&&(n=a.width-this.$refs.dragImg.width),Object.assign(this.dragState,{currentLeft:n,maskWidth:(Number(n)+t.offsetWidth/2).toFixed(2)})}},calPositionX:function(){var e=this.$refs.dragImgBg,t=(e.naturalWidth/e.width).toFixed(2);return(Number(this.dragState.currentLeft).toFixed(2)*t).toFixed(2)},getToken:function(){var e={token:this.imgInfo.token,captcha:this.calPositionX()};return Object(r.a)(btoa(JSON.stringify(e))).reverse().join("")}}},i=a("2877"),d=Object(i.a)(c,(function(){var e=this,t=e._self._c;return t("div",{ref:"drag",staticClass:"e-drag"},[t("div",{staticClass:"e-drag-section"},[t("div",{staticClass:"e-drag-img"},[t("img",{ref:"dragImgBg",attrs:{src:e.imgInfo.url,alt:""}}),t("img",{ref:"dragImg",staticClass:"e-drag-img__dragable",style:{left:"".concat(e.dragState.currentLeft,"px")},attrs:{src:e.imgInfo.jigsaw,alt:""}})]),t("div",{ref:"bar",staticClass:"e-drag-bar"},[t("span",[e._v(e._s(e.$t(e.tips)))]),t("div",{staticClass:"e-drag-bar__mask",style:{width:"".concat(e.dragState.maskWidth,"px")}}),t("div",{ref:"dragBtn",staticClass:"e-drag-btn",style:{left:"".concat(e.dragState.currentLeft,"px")},on:{touchend:e.handletTouchEnd,touchmove:e.handleTouchMove}},[t("img",{attrs:{src:"static/images/drag.png",alt:""}})])])])])}),[],!1,null,null,null);t.a=d.exports}}]);