(window.webpackJsonp=window.webpackJsonp||[]).push([["homeworkDo"],{"057e":function(e,t,r){"use strict";r("8e6e"),r("ac6a"),r("456d");var n=r("bd86"),i=r("2f62");function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var s={name:"GuidePage",data:function(){return{isFristVisited:!1}},computed:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){Object(n.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({},Object(i.e)({user:function(e){return e.user}})),created:function(){this.setVisited()},methods:{setVisited:function(){var e="".concat(this.user.id,"-task-visited");localStorage.getItem(e),localStorage.getItem(e)||(this.isFristVisited=!0,localStorage.setItem(e,!0))}}},a=r("0c7c"),c=Object(a.a)(s,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"show",rawName:"v-show",value:e.isFristVisited,expression:"isFristVisited"}],staticClass:"guide",on:{click:function(t){e.isFristVisited=!1}}},[r("div",{staticClass:"guide__text"},[e._v("左右切换滑动")]),e._m(0)])}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"guide__gesture"},[t("img",{attrs:{src:"static/images/leftslide.png"}}),t("img",{attrs:{src:"static/images/rightslide.png"}})])}],!1,null,null,null);t.a=c.exports},3841:function(e,t,r){"use strict";r.r(t),r("8e6e"),r("a481"),r("456d"),r("c5f6"),r("ac6a"),r("e7e5");var n=r("d399"),i=(r("e17f"),r("2241")),o=r("bd86"),s=r("3ce7"),a=r("faa5"),c=r("2f62"),u=r("057e"),l=r("f5cc"),h=r("ea9a"),d=r("8ae7"),f=r("c8a5"),m=r("7c97");function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g="",v={name:"HomeworkDo",components:{IbsFooter:r("a8b4").a,itemBank:l.a,guidePage:u.a,OutFocusMask:m.a},mixins:[h.a,d.a,f.a],data:function(){return{info:[],answer:{},lastAnswer:null,cardSeq:0,homework:null,cardShow:!1,localanswerName:null,localtimeName:null,lastUsedTime:null,usedTime:null,isHandHomework:!1,slideIndex:0,forceLeave:!1,interval:null,recordId:null}},computed:p({},Object(c.e)({isLoading:function(e){return e.isLoading},user:function(e){return e.user}})),mounted:function(){this.initReport(),this.getData(),this.saveAnswerInterval()},beforeRouteEnter:function(e,t,r){g="/"===t.fullPath?"/":"",r()},beforeRouteLeave:function(e,t,r){this.interval&&clearInterval(this.interval),0==this.info.length||this.isHandHomework||this.forceLeave||"doing"!=this.homework.status?r():this.submitpaper().then((function(){r()})).catch((function(){r(!1)}))},beforeDestroy:function(){this.clearTime(),i.a.close()},methods:p(p(p({},Object(c.d)({setNavbarTitle:a.x})),Object(c.c)("course",["handHomeworkdo","saveAnswerdo"])),{},{showCard:function(){this.cardShow=!0},initReport:function(){this.initReportData(this.$route.query.courseId,this.$route.query.targetId,"homework")},getData:function(){var e=this,t=this.$route.query.homeworkId,r=this.$route.query.targetId;s.a.getHomeworkInfo({query:{homeworkId:t},data:{targetId:r,targetType:"task"}}).then((function(t){e.recordId=t.id,e.afterGetData(t)})).catch((function(t){var r=n.a.fail(t.message);"4036706"==t.code&&setTimeout((function(){e.toIntro(),r.clear()}),2e3)}))},afterGetData:function(e){this.setNavbarTitle(e.paperName),this.homework=e,this.isDoing()||(this.getLocalData(),this.formatData(e),this.interruption(),this.saveTime())},isDoing:function(){return"doing"!=this.homework.status&&(this.showResult(),!0)},interruption:function(){var e=this;this.$route.params.KeepDoing||this.canDoing(this.homework,this.user.id).then((function(){})).catch((function(t){var r=t.answer;e.submitHomework(r)}))},formatData:function(e){var t=this;e.items.forEach((function(e){if("material"!=e.type){var r=t.sixType(e.type,e,t.lastAnswer);t.$set(t.answer,e.id,r.answer),t.info.push(r.item)}if("material"==e.type){var n=Object.assign({},e,{subs:""});e.subs.forEach((function(r,i){r.parentTitle=n,r.parentType=e.type,r.materialIndex=i+1;var o=t.sixType(r.type,r,t.lastAnswer);t.$set(t.answer,r.id,o.answer),t.info.push(o.item)}))}}))},formatStatus:function(e,t){var r=0;return("single_choice"==e||"choice"==e||"uncertain_choice"==e||"determine"==e)&&this.answer[t].length>0||"essay"==e&&""!=this.answer[t][0]?r=1:"fill"==e?r=Number(this.answer[t].some((function(e){return""!=e}))):r},slideToNumber:function(e){var t=Number(e);this.cardSeq=t,this.cardShow=!1},getLocalData:function(){this.localanswerName="homework-".concat(this.user.id,"-").concat(this.homework.id),this.localuseTime="homework-".concat(this.user.id,"-").concat(this.homework.id,"-usedTime"),this.lastAnswer=JSON.parse(localStorage.getItem(this.localanswerName))},saveTime:function(){var e=this,t=localStorage.getItem(this.localuseTime)||0;this.usedTime=setInterval((function(){localStorage.setItem(e.localuseTime,++t)}),1e3)},clearTime:function(){clearInterval(this.usedTime),this.usedTime=null},submitpaper:function(){var e=this,t=0,r="题目已经做完，确认提交吗?",n=JSON.parse(JSON.stringify(this.answer));return Object.keys(n).forEach((function(e){n[e]=n[e].filter((function(e){return""!==e})),0===n[e].length&&t++})),t>0&&(r="还有".concat(t,"题未做，确认提交吗？")),this.saveAnswerInterval(),new Promise((function(t,o){i.a.confirm({title:"提交",cancelButtonText:"立即提交",confirmButtonText:"检查一下",message:r}).then((function(t){e.cardShow=!0,o(t)})).catch((function(){e.clearTime(),e.submitHomework(n).then((function(e){t()})).catch((function(e){o(e)}))}))}))},submitHomework:function(e){var t=this;e||(e=JSON.parse(JSON.stringify(this.answer)),Object.keys(e).forEach((function(t){e[t]=e[t].filter((function(e){return""!==e}))})));var r={answer:e,homeworkId:this.$route.query.homeworkId,userId:this.user.id,homeworkResultId:this.homework.id,courseId:this.$route.query.courseId};return new Promise((function(e,o){t.handHomeworkdo(r).then((function(r){t.isHandHomework=!0,e(),t.reprtData({eventName:"finish"}),t.showResult()})).catch((function(r){if("4036705"!=r.code)"50095204"!=r.code?(n.a.fail(r.message),o(r)):i.a.confirm({title:"你已提交过答题，当前页面无法重复提交",showCancelButton:!1,confirmButtonText:"退出答题"}).then((function(){return t.exitPage()}));else{var s=n.a.fail(r.message);setTimeout((function(){t.isHandHomework=!0,s.clear(),e(),t.showResult()}),2e3)}}))}))},saveAnswerInterval:function(){var e=this;clearInterval(this.interval),this.interval=setInterval((function(){e.saveAnswerAjax()}),3e4)},saveAnswerAjax:function(){var e=this;this.saveAnswerdo({admission_ticket:this.homework.admission_ticket,answer:JSON.parse(JSON.stringify(this.answer)),resultId:this.homework.id,courseId:this.$route.query.courseId}).catch((function(t){var r=t.code,o=t.message,s=t.traceId;"50095204"!=r?"50095209"!=r?s?i.a.confirm({title:"答题保存失败，请保存截图后，联系技术支持处理",message:"【".concat(o,"】【").concat(s,"】"),confirmButtonText:"退出答题"}).then((function(){return e.exitPage()})):(n.a.fail(err.message),i.a.confirm({title:"网络连接不可用，自动保存失败",showCancelButton:!1,confirmButtonText:"重新保存"}).then((function(){return e.saveAnswerAjax()}))):i.a.confirm({title:"有新答题页面，请在新页面中继续答题",showCancelButton:!1,confirmButtonText:"确定"}).then((function(){return e.exitPage()})):i.a.confirm({title:"你已提交过答题，当前页面无法重复提交",showCancelButton:!1,confirmButtonText:"退出答题"}).then((function(){return e.exitPage()}))}))},exitPage:function(){this.forceLeave=!0,this.$router.push("/course/".concat(this.homework.courseId))},showResult:function(){this.$router.replace({name:"homeworkResult",query:{homeworkId:this.$route.query.homeworkId,homeworkResultId:this.homework.id,taskId:this.$route.query.targetId,backUrl:g,courseId:this.$route.query.courseId}})},toIntro:function(){this.$router.replace({name:"homeworkIntro",query:{courseId:this.$route.query.courseId,taskId:this.$route.query.targetId,backUrl:g}})}})},b=r("0c7c"),k=Object(b.a)(v,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"paper-swiper"},[r("out-focus-mask",{attrs:{type:e.outFocusMaskType,isShow:e.isShowOutFocusMask,reportType:e.reportType},on:{outFocusMask:e.outFocusMask}}),e.isLoading?r("e-loading"):e._e(),e.info.length>0?r("item-bank",{attrs:{current:e.cardSeq,info:e.info,answer:e.answer,"show-score":!1,"slide-index":e.slideIndex,all:e.info.length,"ai-agent-record-id":e.recordId},on:{"update:current":function(t){e.cardSeq=t},"update:answer":function(t){e.answer=t},"update:slideIndex":function(t){e.slideIndex=t},"update:slide-index":function(t){e.slideIndex=t}}}):e._e(),r("guide-page"),r("ibs-footer",{attrs:{mode:"do","show-save-process-btn":!1},on:{showcard:e.showCard,submitPaper:e.submitpaper}}),r("van-popup",{attrs:{position:"bottom"},model:{value:e.cardShow,callback:function(t){e.cardShow=t},expression:"cardShow"}},[e.info.length>0?r("div",{staticClass:"card"},[r("div",{staticClass:"card-title"},[r("div",[r("span",{staticClass:"card-finish"},[e._v(e._s(e.$t("courseLearning.completed")))]),r("span",{staticClass:"card-nofinish"},[e._v(e._s(e.$t("courseLearning.notCompleted")))])]),r("i",{staticClass:"iconfont icon-no",on:{click:function(t){e.cardShow=!1}}})]),r("div",{staticClass:"card-list"},[r("div",{staticClass:"card-homework-item"},[r("div",{staticClass:"card-item-list"},e._l(e.info,(function(t){return r("div",{key:t.id,class:["list-cicle",1==e.formatStatus(t.type,t.id)?"cicle-active":""],on:{click:function(r){return e.slideToNumber(t.seq)}}},[e._v("\n              "+e._s(t.seq)+"\n            ")])})),0)])])]):e._e()])],1)}),[],!1,null,null,null);t.default=k.exports},ea9a:function(e,t,r){"use strict";r("e17f");var n=r("2241");r("456d"),r("ac6a"),t.a={methods:{canDoing:function(e,t){return new Promise((function(r,i){if(e&&"doing"===e.status){var o="homework-".concat(t,"-").concat(e.id),s=JSON.parse(localStorage.getItem(o));s=s?Object.keys(s).forEach((function(e){s[e]=s[e].filter((function(e){return""!==e}))})):{},n.a.confirm({title:"提示",cancelButtonText:"放弃做题",confirmButtonText:"继续做题",message:"您有未完成的作业，是否继续？"}).then((function(){r()})).catch((function(){i({answer:s})}))}}))}}}}}]);