(window.webpackJsonp=window.webpackJsonp||[]).push([["pay"],{"38a4":function(t,e,a){"use strict";a.r(e);var i=a("c80c"),s=(a("a481"),a("e7e5"),a("d399")),c=(a("96cf"),a("3b8d")),r=a("db72"),n=a("3ce7"),o=a("2f62"),h={data:function(){return{detail:{},payWay:"",selected:!0,paySettings:{},inWechat:this.isWeixinBrowser(),targetType:this.$route.query.targetType,timeoutId:-1,isLoading:!0}},computed:Object(r.a)(Object(r.a)({},Object(o.e)(["wechatSwitch"])),{},{validPayWay:function(){return this.paySettings.wxpayEnabled||this.paySettings.alipayEnabled&&!this.inWechat}}),created:function(){var t=this;return Object(c.a)(Object(i.a)().mark((function e(){var a,c,r;return Object(i.a)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isLoading=!0,e.next=3,n.a.getSettings({query:{type:"payment"}}).catch((function(t){s.a.fail(t.message)}));case 3:t.paySettings=e.sent,t.paySettings.alipayEnabled&&!t.inWechat?t.payWay="Alipay_LegacyH5":t.paySettings.wxpayEnabled&&(t.payWay="WechatPay_H5"),a=t.$route.query,c=a.sn,r=a.targetId,n.a.getOrderDetail({query:{sn:c}}).then((function(e){if("success"===e.status&&r){if(t.wechatSwitch)return void t.$router.replace({path:"/pay_success",query:{targetType:t.targetType,targetId:r}});"vip"===t.targetType?t.$router.replace({path:"/".concat(t.targetType),query:{backUrl:"/my/orders"}}):t.$router.replace({path:"/".concat(t.targetType,"/").concat(t.targetId)})}t.detail=Object.assign({},e),t.isLoading=!1})).catch((function(t){s.a.fail(t.message)}));case 7:case"end":return e.stop()}}),e)})))()},beforeRouteLeave:function(t,e,a){clearTimeout(this.timeoutId),a()},methods:{handlePay:function(){var t=this;if(this.validPayWay)if("WechatPay_H5"===this.payWay&&this.inWechat)window.location.href="".concat(window.location.origin,"/pay/center/wxpay_h5?pay_amount=")+"".concat(this.detail.pay_amount,"&title=").concat(this.detail.title,"&sn=").concat(this.detail.sn,"&targetType=").concat(this.targetType,"&targetId=").concat(this.targetId);else{var e=window.location.origin+window.location.pathname+"#/pay_center?targetType=".concat(this.targetType,"&targetId=").concat(this.targetId);n.a.createTrade({data:{gateway:this.payWay,type:"purchase",orderSn:this.detail.sn,app_pay:"Y",success_url:e}}).then((function(e){"WechatPay_H5"!==t.payWay?window.location.href=e.payUrl:t.getTradeInfo(e.tradeSn).then((function(){window.location.href=e.mwebUrl}))})).catch((function(t){s.a.fail(t.message)}))}},isWeixinBrowser:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())},getTradeInfo:function(t){var e=this;return n.a.getTrade({query:{tradesSn:t}}).then((function(a){a.isPaid?window.location.href=a.paidSuccessUrlH5:e.timeoutId=setTimeout((function(){e.getTradeInfo(t)}),2e3)})).catch((function(t){s.a.fail(t.message)}))}}},l=a("2877"),u=Object(l.a)(h,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"payPage"},[t.isLoading?e("e-loading"):t._e(),e("div",{staticClass:"payPage__order"},[e("div",{staticClass:"order__head order--line"},[t._v("\n      支付方式\n    ")]),e("div",{staticClass:"order__infomation"},[e("div",{staticClass:"title"},[t._v(t._s(t.detail.title))]),e("div",{staticClass:"sum"},[e("span",[t._v("待支付")]),e("span",{staticClass:"sum__price"},[t._v("¥ "),e("span",{staticClass:"num"},[t._v(t._s(t._f("toMoney")(t.detail.pay_amount)))])])]),e("div",{staticClass:"payWay"},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.paySettings.alipayEnabled&&!t.inWechat,expression:"paySettings.alipayEnabled && !inWechat"}],class:["payWay__item",{"payWay__item--selected":"Alipay_LegacyH5"===t.payWay}],on:{click:function(e){t.payWay="Alipay_LegacyH5",t.selected=!0}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),e("div",{staticClass:"right"}),e("img",{attrs:{src:"static/images/zfb.png"}})]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.paySettings.wxpayEnabled,expression:"paySettings.wxpayEnabled"}],class:["payWay__item",{"payWay__item--selected":"WechatPay_H5"===t.payWay}],on:{click:function(e){t.payWay="WechatPay_H5",t.selected=!1}}},[e("img",{staticClass:"correct",attrs:{src:"static/images/correct.png"}}),e("div",{staticClass:"right"}),e("img",{attrs:{src:"static/images/wx.png"}})])])])]),e("div",{class:["payPage__payBtn",{disabled:!t.validPayWay}],on:{click:t.handlePay}},[t._v("\n    "+t._s(t.validPayWay?"立即支付":"无可用支付方式")+"\n  ")])],1)}),[],!1,null,null,null);e.default=u.exports},"6ca9":function(t,e,a){"use strict";a.r(e),a("a481"),a("ac6a"),a("456d");var i=a("db72"),s=a("2f62"),c={mixins:[a("2095").a],components:{},data:function(){return{targetType:null,targetId:null,payWay:null}},computed:Object(i.a)({},Object(s.e)(["wechatSwitch"])),watch:{},created:function(){this.getInfoCollection()},methods:{getInfoCollection:function(){var t=this;this.targetType=this.$route.query.targetType,this.targetId=this.$route.query.targetId,this.payWay=this.$route.query.payWay;var e={action:"buy_after",targetType:this.targetType,targetId:this.targetId};this.getInfoCollectionEvent(e).then((function(e){Object.keys(e).length?t.toCollectUserInfo(e.id):t.doDefault()})).catch((function(){t.doDefault()}))},doDefault:function(){"WechatPay_H5"===this.payWay&&this.wechatSwitch?this.toWxNotify():this.toTarget()},toCollectUserInfo:function(t){var e={eventId:t,targetType:this.targetType,targetId:this.targetId,payWay:this.payWay};this.$router.replace({path:"/pay_collectInfo",query:e})},toWxNotify:function(){var t="".concat(window.location.origin,"/#/");"vip"===this.targetType?t+="".concat(this.targetType):t+="".concat(this.targetType,"/").concat(this.targetId),this.$router.replace({path:"/pay_success",query:{paidUrl:t,backUrl:t}})},toTarget:function(){"vip"===this.targetType?this.$router.replace({path:"/".concat(this.targetType),query:{backUrl:"/my/orders"}}):this.$router.replace({path:"/".concat(this.targetType,"/").concat(this.targetId)})}}},r=a("2877"),n=Object(r.a)(c,(function(){var t=this._self._c;return t("div",{},[t("e-loading")],1)}),[],!1,null,null,null);e.default=n.exports},dec6:function(t,e,a){"use strict";a.r(e),a("a481");var i=a("db72"),s=a("2f62"),c={data:function(){return{targetId:this.$route.query.targetId||"",targetType:this.$route.query.targetType||"",paidUrl:this.$route.query.paidUrl}},computed:Object(i.a)({},Object(s.e)(["wechatSwitch","wechatSettings"])),created:function(){this.wechatSwitch||this.$router.replace({path:"/"})},methods:{backToCourse:function(){this.paidUrl?window.location.href=this.paidUrl:"vip"===this.targetType?this.$router.replace({path:"/".concat(this.targetType),query:{backUrl:"/my/orders"}}):this.$router.replace({path:"/".concat(this.targetType,"/").concat(this.targetId)})}}},r=a("2877"),n=Object(r.a)(c,(function(){var t=this._self._c;return t("div",{staticClass:"pay-success-container"},[this._m(0),this.wechatSettings?t("div",{staticClass:"qrcode-img-container"},[t("img",{attrs:{src:this.wechatSettings.official_qrcode,alt:""}})]):this._e(),this._m(1),t("van-button",{staticClass:"btn-back-course",attrs:{type:"primary"},on:{click:this.backToCourse}},[this._v("返回课程")])],1)}),[function(){var t=this._self._c;return t("div",{staticClass:"pay-success-text"},[t("i",{staticClass:"h5-icon h5-icon-check"}),t("span",{staticClass:"text-18 success-text"},[this._v("支付成功！")]),t("div",{staticClass:"mt5 text-14 color-red"},[this._v("\n      为享受更好的教学服务，建议您开启课程通知。\n    ")])])},function(){var t=this._self._c;return t("div",{staticClass:"press-img-container"},[t("img",{attrs:{src:"static/images/wechat_press.png",alt:""}}),t("div",{staticClass:"press-text text-14"},[this._v("请长按二维码开启课程通知")])])}],!1,null,null,null);e.default=n.exports},f2d9:function(t,e,a){"use strict";a.r(e),a("ac6a"),a("456d"),a("a481");var i=a("db72"),s=a("2f62"),c=a("4928"),r=a("2095"),n=a("faa5"),o={mixins:[r.a],components:{infoCollection:c.a},data:function(){return{isLoading:!0}},computed:Object(i.a)({},Object(s.e)(["wechatSwitch"])),watch:{},created:function(){this.targetType=this.$route.query.targetType,this.targetId=this.$route.query.targetId,this.payWay=this.$route.query.payWay,this.getForm()},methods:Object(i.a)(Object(i.a)({},Object(s.d)({setNavbarTitle:n.x})),{},{getForm:function(){var t=this,e=this.$route.query.eventId;this.getInfoCollectionForm(e).then((function(e){t.setNavbarTitle(e.formTitle),t.isLoading=!1})).catch((function(){t.handleSubmit()}))},handleSubmit:function(){"WechatPay_H5"===this.$route.query.payWay&&this.wechatSwitch?this.toWxNotify():this.toTarget()},toTarget:function(){"vip"===this.targetType?this.$router.replace({path:"/".concat(this.targetType),query:{backUrl:"/my/orders"}}):this.$router.replace({path:"/".concat(this.targetType,"/").concat(this.targetId)})},toWxNotify:function(){var t=window.location.origin+window.location.pathname+"#/".concat(this.targetType,"/").concat(this.targetId);this.$router.replace({path:"/pay_success",query:{paidUrl:t}})}})},h=a("2877"),l=Object(h.a)(o,(function(){var t=this._self._c;return t("div",{},[this.isLoading?t("e-loading"):this._e(),Object.keys(this.userInfoCollectForm).length?t("div",[t("info-collection",{attrs:{userInfoCollectForm:this.userInfoCollectForm,formRule:this.userInfoCollectForm.items},on:{submitForm:this.handleSubmit}})],1):this._e()],1)}),[],!1,null,null,null);e.default=l.exports}}]);