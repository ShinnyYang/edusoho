(window.webpackJsonp=window.webpackJsonp||[]).push([["testpaperDo"],{"057e":function(e,t,i){"use strict";var s=i("db72"),a=i("2f62"),n={name:"GuidePage",data:function(){return{isFristVisited:!1}},computed:Object(s.a)({},Object(a.e)({user:function(e){return e.user}})),created:function(){this.setVisited()},methods:{setVisited:function(){var e="".concat(this.user.id,"-task-visited");localStorage.getItem(e),localStorage.getItem(e)||(this.isFristVisited=!0,localStorage.setItem(e,!0))}}},r=i("2877"),c=Object(r.a)(n,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.isFristVisited,expression:"isFristVisited"}],staticClass:"guide",on:{click:function(t){e.isFristVisited=!1}}},[t("div",{staticClass:"guide__text"},[e._v("左右切换滑动")]),e._m(0)])}),[function(){var e=this._self._c;return e("div",{staticClass:"guide__gesture"},[e("img",{attrs:{src:"static/images/leftslide.png"}}),e("img",{attrs:{src:"static/images/rightslide.png"}})])}],!1,null,null,null);t.a=c.exports},"3fc6":function(e,t,i){"use strict";i.r(t),i("7f7f"),i("a481"),i("456d"),i("ac6a"),i("c5f6"),i("e7e5");var s=i("d399"),a=i("db72"),n=(i("e17f"),i("2241")),r=i("c80c"),c=(i("96cf"),i("3b8d")),o=i("3ce7"),u=i("2f62"),l=i("faa5"),m=i("057e"),d=i("f5cc"),h=i("0d25"),f=i("b7cf"),p=i("8ae7"),g=i("c8a5"),v=i("7c97"),w=i("6647"),b="",T={name:"TestpaperDo",components:{IbsFooter:i("a8b4").a,itemBank:d.a,guidePage:m.a,OutFocusMask:v.a},filters:{type:function(e){switch(e){case"single_choice":return w.a.t("courseLearning.singleChoice");case"choice":return w.a.t("courseLearning.choice");case"essay":return w.a.t("courseLearning.essay");case"uncertain_choice":return w.a.t("courseLearning.uncertainChoice");case"determine":return w.a.t("courseLearning.determine");case"fill":return"courseLearning.fill";case"material":return w.a.t("courseLearning.material")}}},mixins:[f.a,p.a,g.a],data:function(){return{cardSeq:0,testpaper:{},testpaperResult:{},info:[],answer:{},cardShow:!1,items:{},time:null,timeMeter:null,timeWarn:!1,isHandExam:!1,localtime:null,localtimeName:null,localanswerName:null,localuseTime:null,lastAnswer:null,lastTime:null,startTime:null,backUrl:"",slideIndex:0,forceLeave:!1,interval:null}},watch:{answer:{handler:function(){window.localStorage.setItem(this.localanswerName,JSON.stringify(this.answer))},deep:!0}},mounted:function(){var e=this;return Object(c.a)(Object(r.a)().mark((function t(){return Object(r.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.initReport(),e.getData(),e.saveAnswerInterval();case 3:case"end":return t.stop()}}),t)})))()},beforeRouteEnter:function(e,t,i){b="/"===t.fullPath?"/":"",i()},beforeRouteLeave:function(e,t,i){this.clearTime(),this.interval&&clearInterval(this.interval),0==this.info.length||this.isHandExam||this.forceLeave||"doing"!=this.testpaperResult.status?i():this.submitPaper().then((function(){i()})).catch((function(){i(!1)}))},beforeDestroy:function(){this.clearTime(),n.a.close()},computed:Object(a.a)({},Object(u.e)({isLoading:function(e){return e.isLoading},user:function(e){return e.user},selectedPlanId:function(e){return e.course.selectedPlanId}})),methods:Object(a.a)(Object(a.a)(Object(a.a)({},Object(u.c)(["setCloudAddress"])),Object(u.c)("course",["handExamdo","saveAnswerdo"])),{},{showCard:function(){this.cardShow=!0},initReport:function(){this.initReportData(this.selectedPlanId,this.$route.query.targetId,"testpaper")},getData:function(){var e=this,t=this.$route.query.testId,i=this.$route.query.targetId,a=this.$route.query.action;o.a.getExamInfo({query:{testId:t},data:{action:a,targetId:i,targetType:"task"}}).then((function(t){e.afterGetData(t)})).catch((function(t){4032207==t.code||4032204==t.code?e.toIntro():(s.a.fail(t.message),e.showResult())}))},afterGetData:function(e){this.$store.commit(l.x,this.$route.query.title),this.items=e.items,this.testpaper=e.testpaper,this.testpaper.courseId=e.courseId,e.testpaperResult.limitedTime=Number(e.testpaperResult.limitedTime),this.testpaperResult=e.testpaperResult,this.isDoing()||(this.localanswerName="".concat(this.user.id,"-").concat(this.testpaperResult.id),this.localtimeName="".concat(this.user.id,"-").concat(this.testpaperResult.id,"-time"),this.lastTime=localStorage.getItem(this.localtimeName),this.lastAnswer=JSON.parse(localStorage.getItem(this.localanswerName)),this.formatData(e),this.interruption(),this.saveTime(),this.timer())},isDoing:function(){return"doing"!=this.testpaperResult.status&&(this.showResult(),!0)},interruption:function(){var e=this;this.$route.params.KeepDoing||this.canDoing(this.testpaperResult,this.user.id).then((function(){})).catch((function(t){var i=t.answer,s=t.endTime;e.submitExam(i,s)}))},formatData:function(e){var t=this,i=e.items;Object.keys(i).forEach((function(e){"material"!=e&&i[e].forEach((function(e){var i=t.sixType(e.type,e,t.lastAnswer);t.$set(t.answer,e.id,i.answer),t.info.push(i.item)})),"material"==e&&i[e].forEach((function(e){var i=Object.assign({},e,{subs:""});e.subs.forEach((function(s,a){s.parentTitle=i,s.parentType=e.type,s.materialIndex=a+1,s.attachments=s.attachments.concat(e.attachments);var n=t.sixType(s.type,s,t.lastAnswer);t.$set(t.answer,s.id,n.answer),t.info.push(n.item)}))}))}))},formatStatus:function(e,t){var i=0;return("single_choice"==e||"choice"==e||"uncertain_choice"==e||"determine"==e)&&this.answer[t].length>0||"essay"==e&&""!=this.answer[t][0]?i=1:"fill"==e?i=Number(this.answer[t].some((function(e){return""!=e}))):i},slideToNumber:function(e){var t=Number(e);this.cardSeq=t,this.cardShow=!1},timer:function(e){var t=this;if("0"!=this.testpaper.examMode){if("1"==this.testpaper.examMode){var i=this.testpaperResult.usedTime,s=localStorage.getItem(this.localuseTime),a=1e3*Math.max(i,s);i>s&&localStorage.setItem(this.localuseTime,i);var r=Object(h.getCountDown)(a,0),c=r.hours,o=r.minutes,u=r.seconds;this.time="".concat(c,":").concat(o,":").concat(u),this.timeMeter=setInterval((function(){a+=1e3;var e=Object(h.getCountDown)(a,0),i=e.hours,s=e.minutes,r=e.seconds;t.time="".concat(i,":").concat(s,":").concat(r),t.testpaper.limitedTime>0&&a===60*t.testpaper.limitedTime*1e3&&n.a.confirm({cancelButtonText:t.$t("courseLearning.handInThePaper"),confirmButtonText:t.$t("courseLearning.continueAnswer"),message:t.$t("courseLearning.examTotalTime",{number:parseInt(s)})}).catch((function(){t.submitExam()}))}),1e3)}}else{var l=60*this.testpaperResult.limitedTime*1e3;if(l<=0)return;if(this.lastTime){var m=Math.ceil((new Date).getTime()-1e3*this.testpaperResult.beginTime);l-=m}var d=0;this.timeMeter=setInterval((function(){var e=Object(h.getCountDown)(l,d++),i=e.hours,s=e.minutes,a=e.seconds;t.time="".concat(i,":").concat(s,":").concat(a),0==i&&0==s&&a<60&&(t.timeWarn=!0),(0==Number(i)&&0==Number(s)&&0==Number(a)||Number(a)<0)&&(t.clearTime(),t.submitExam())}),1e3)}},clearTime:function(){clearInterval(this.timeMeter),this.timeMeter=null,clearInterval(this.localtime),this.localtime=null},submitPaper:function(){var e=this,t=0,i=this.$t("courseLearning.sureSubmit"),s=JSON.parse(JSON.stringify(this.answer));return Object.keys(s).forEach((function(e){s[e]=s[e].filter((function(e){return""!==e})),0===s[e].length&&t++})),t>0&&(i=this.$t("courseLearning.notSureSubmit",{number:t})),this.saveAnswerInterval(),new Promise((function(t,a){n.a.confirm({title:e.$t("courseLearning.handInThePaper"),cancelButtonText:e.$t("courseLearning.confirmSubmission"),confirmButtonText:e.$t("courseLearning.check"),message:i,className:"backDialog"}).then((function(t){document.getElementsByClassName("backDialog")[0].remove(),e.cardShow=!0,a(t)})).catch((function(){document.getElementsByClassName("backDialog")[0].remove(),e.clearTime(),e.submitExam(s).then((function(e){t()})).catch((function(e){a(e)}))}))}))},submitExam:function(e,t){var i=this;e||(e=JSON.parse(JSON.stringify(this.answer)),Object.keys(e).forEach((function(t){e[t]=e[t].filter((function(e){return""!==e}))}))),t=t||(new Date).getTime();var a={answer:e,resultId:this.testpaperResult.id,userId:this.user.id,endTime:t,beginTime:Number(this.testpaperResult.beginTime),courseId:this.$route.query.courseId};return new Promise((function(e,t){i.handExamdo(a).then((function(t){i.isHandExam=!0,e(),i.showResult()})).catch((function(e){50095204!=e.code?(t(e),s.a.fail(e.message),i.isHandExam=!0,i.showResult()):n.a.confirm({title:"你已提交过答题，当前页面无法重复提交",showCancelButton:!1,confirmButtonText:"退出答题"}).then((function(){return i.exitPage()}))})).finally((function(){localStorage.removeItem(i.localuseTime)}))}))},saveAnswerInterval:function(){var e=this;clearInterval(this.interval),this.interval=setInterval((function(){e.saveAnswerAjax()}),3e4)},saveAnswerAjax:function(){var e=this,t=localStorage.getItem(this.localuseTime)||0;this.saveAnswerdo({admission_ticket:this.testpaperResult.admission_ticket,answer:JSON.parse(JSON.stringify(this.answer)),resultId:this.testpaperResult.id,used_time:t,courseId:this.$route.query.courseId}).catch((function(t){var i=t.code,a=t.message,r=t.traceId;50095204!==i?50095209!==i?r?n.a.confirm({title:"答题保存失败，请保存截图后，联系技术支持处理",message:"【".concat(a,"】【").concat(r,"】"),confirmButtonText:"退出答题"}).then((function(){return e.exitPage()})):(s.a.fail(err.message),n.a.confirm({title:"网络连接不可用，自动保存失败",showCancelButton:!1,confirmButtonText:"重新保存"}).then((function(){return e.saveAnswerAjax()}))):n.a.confirm({title:"有新答题页面，请在新页面中继续答题",showCancelButton:!1,confirmButtonText:"确定"}).then((function(){return e.exitPage()})):n.a.confirm({title:"你已提交过答题，当前页面无法重复提交",showCancelButton:!1,confirmButtonText:"退出答题"}).then((function(){return e.exitPage()}))}))},exitPage:function(){this.forceLeave=!0,this.$router.push("/course/".concat(this.testpaper.courseId))},saveTime:function(){var e=this;this.localuseTime="".concat(this.user.id,"-").concat(this.testpaperResult.id,"-usedTime"),this.localtime=setInterval((function(){var t=localStorage.getItem(e.localuseTime)||0;localStorage.setItem(e.localuseTime,Number(t)+1),localStorage.setItem(e.localtimeName,(new Date).getTime())}),1e3)},showResult:function(){this.$router.replace({name:"testpaperResult",query:{resultId:this.testpaperResult.id,testId:this.$route.query.testId,targetId:this.$route.query.targetId,backUrl:b}})},toIntro:function(){this.$router.replace({name:"testpaperIntro",query:{testId:this.$route.query.testId,targetId:this.$route.query.targetId}})}})},I=i("2877"),x=Object(I.a)(T,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"paper-swiper"},[t("out-focus-mask",{attrs:{type:e.outFocusMaskType,isShow:e.isShowOutFocusMask,reportType:e.reportType},on:{outFocusMask:e.outFocusMask}}),e.isLoading?t("e-loading"):e._e(),e.info.length>0?t("item-bank",{attrs:{current:e.cardSeq,info:e.info,answer:e.answer,"slide-index":e.slideIndex,all:e.info.length,"exercise-info":e.testpaperResult},on:{"update:current":function(t){e.cardSeq=t},"update:answer":function(t){e.answer=t},"update:slideIndex":function(t){e.slideIndex=t},"update:slide-index":function(t){e.slideIndex=t}}}):e._e(),t("guide-page"),t("ibs-footer",{attrs:{mode:"do","show-save-process-btn":!1},on:{showcard:e.showCard,submitPaper:e.submitPaper}}),t("van-popup",{attrs:{position:"bottom"},model:{value:e.cardShow,callback:function(t){e.cardShow=t},expression:"cardShow"}},[e.info.length>0?t("div",{staticClass:"card"},[t("div",{staticClass:"card-title"},[t("div",[t("span",{staticClass:"card-finish"},[e._v(e._s(e.$t("courseLearning.completed")))]),t("span",{staticClass:"card-nofinish"},[e._v(e._s(e.$t("courseLearning.notCompleted")))])]),t("i",{staticClass:"iconfont icon-no",on:{click:function(t){e.cardShow=!1}}})]),t("div",{staticClass:"card-list"},e._l(e.items,(function(i,s){return t("div",{key:s,staticClass:"card-item"},[t("div",{staticClass:"card-item-title"},[e._v(e._s(e._f("type")(s)))]),"material"!=s?t("div",{staticClass:"card-item-list"},e._l(e.items[s],(function(i){return t("div",{key:i.id,class:["list-cicle",1==e.formatStatus(i.type,i.id)?"cicle-active":""],on:{click:function(t){return e.slideToNumber(i.seq)}}},[e._v("\n              "+e._s(i.seq)+"\n            ")])})),0):e._e(),"material"==s?t("div",{staticClass:"card-item-list"},[e._l(e.items[s],(function(i){return e._l(i.subs,(function(i){return t("div",{key:i.id,class:["list-cicle",1==e.formatStatus(i.type,i.id)?"cicle-active":""],on:{click:function(t){return e.slideToNumber(i.seq)}}},[e._v("\n                "+e._s(i.seq)+"\n              ")])}))}))],2):e._e()])})),0)]):e._e()]),t("div",{class:["time",e.timeWarn?"warn":""]},[e._v("\n    "+e._s(e.time)+"\n  ")])],1)}),[],!1,null,null,null);t.default=x.exports},b7cf:function(e,t,i){"use strict";i("c5f6"),i("e17f");var s=i("2241");i("456d"),i("ac6a"),t.a={methods:{canDoing:function(e,t){return new Promise((function(i,a){if(e&&"doing"===e.status){var n="".concat(t,"-").concat(e.id),r=JSON.parse(localStorage.getItem(n));r=r?Object.keys(r).forEach((function(e){r[e]=r[e].filter((function(e){return""!==e}))})):{},s.a.confirm({title:"提示",cancelButtonText:"放弃考试",confirmButtonText:"继续考试",message:"您有未完成的考试，是否继续？"}).then((function(){if(Number(e.limitedTime)>0){var t=Math.ceil(((new Date).getTime()-1e3*e.beginTime)/1e3/60);if(Number(t)>Number(e.limitedTime)){var s=Number(1e3*e.beginTime)+Number(60*e.limitedTime*1e3);return void a({answer:r,endTime:s})}}i()})).catch((function(){a({answer:r,endTime:null})}))}}))}}}}}]);