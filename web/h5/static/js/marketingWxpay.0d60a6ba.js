(window.webpackJsonp=window.webpackJsonp||[]).push([["marketingWxpay"],{"18db":function(e,t,n){"use strict";var r=n("6b52");n.n(r).a},"6b52":function(e,t,n){},8567:function(e,t,n){"use strict";n.r(t),n("8e6e"),n("ac6a"),n("456d"),n("a481"),n("e17f");var r=n("2241"),a=(n("e7e5"),n("d399")),i=(n("c5f6"),n("96cf"),n("3b8d")),o=n("bd86"),s=n("3ce7"),c=n("2f62");function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){Object(o.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var l={name:"MarketingWXPay",data:function(){return{isLoading:!1,payInfo:null,loginConfig:{}}},computed:f(f({},Object(c.e)({token:function(e){return e.token}})),{},{isWeixinBrowser:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())}}),created:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){var n,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.token){t.next=3;break}return s.a.loginConfig({}).then((function(t){e.loginConfig=t,Number(t.weixinmob_enabled)&&e.isWeixinBrowser&&e.wxLogin()})),t.abrupt("return");case 3:if(n=e.$route.query.payToken||""){t.next=7;break}return a.a.fail("缺少关键信息"),t.abrupt("return");case 7:return t.next=9,s.a.getMarketingMallPayConfig({data:{token:n}});case 9:if(!1!==(i=t.sent).success){t.next=13;break}return r.a.alert({confirmButtonText:"我知道了",confirmButtonColor:"#165DFF",message:"支付方式未配置，请联系机构处理。"}),t.abrupt("return");case 13:e.payInfo=i,e.handlePay();case 15:case"end":return t.stop()}}),t)})))()},methods:{handleAmount:function(e){return e/100},handlePay:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.$route.query.payToken||"",t.next=3,s.a.checkMarketingMallPayConfig({params:{token:n}});case 3:!1===t.sent.success&&r.a.alert({confirmButtonText:"我知道了",confirmButtonColor:"#165DFF",message:"支付方式未配置，请联系机构处理。"}),WeixinJSBridge.invoke("getBrandWCPayRequest",e.payInfo.config,(function(t){"get_brand_wcpay_request:ok"==t.err_msg?window.location.href=e.payInfo.redirectUrl+"&isNeedCheckOrderStatus=1&sn=".concat(e.payInfo.orderSn):"get_brand_wcpay_request:fail"==t.err_msg||t.err_msg}));case 6:case"end":return t.stop()}}),t)})))()},wxLogin:function(){this.$router.replace({path:"/auth/social",query:{type:"wx",weixinmob_key:this.loginConfig.weixinmob_key,redirect:this.$route.path,callbackType:1,activityId:this.$route.query.activityId}})}}},p=(n("18db"),n("0c7c")),y=Object(p.a)(l,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.isWeixinBrowser&&e.payInfo?n("div",{staticClass:"marketing-wxpay"},[n("div",{staticClass:"marketing-wxpay__title"},[e._v(e._s(e.$t("marketingPay.amountLabel")))]),n("div",{staticClass:"marketing-wxpay__amount"},[n("span",{staticClass:"amount-unit"},[e._v("￥")]),n("span",{staticClass:"amount-number"},[e._v(e._s(e.payInfo.amount/100))])]),n("div",{staticClass:"marketing-wxpay__info"},[n("div",{staticClass:"info-label"},[e._v(e._s(e.$t("marketingPay.orderSnLabel")))]),n("div",{staticClass:"info-desc"},[e._v(e._s(e.payInfo.orderSn))])]),n("div",{staticClass:"marketing-wxpay__info",staticStyle:{border:"none"}},[n("div",{staticClass:"info-label"},[e._v(e._s(e.$t("marketingPay.acceptLabel")))]),n("div",{staticClass:"info-desc"},[e._v(e._s(e.payInfo.siteName))])]),n("div",{staticClass:"pay-btn",on:{click:e.handlePay}},[e._v("\n    "+e._s(e.$t("marketingPay.payNow"))+"\n  ")])]):e._e()}),[],!1,null,"504a8cbe",null);t.default=y.exports}}]);