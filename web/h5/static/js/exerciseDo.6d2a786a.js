(window.webpackJsonp=window.webpackJsonp||[]).push([["exerciseDo"],{"057e":function(e,t,s){"use strict";var i=s("db72"),n=s("2f62"),r={name:"GuidePage",data:function(){return{isFristVisited:!1}},computed:Object(i.a)({},Object(n.e)({user:function(e){return e.user}})),created:function(){this.setVisited()},methods:{setVisited:function(){var e="".concat(this.user.id,"-task-visited");localStorage.getItem(e),localStorage.getItem(e)||(this.isFristVisited=!0,localStorage.setItem(e,!0))}}},a=s("2877"),c=Object(a.a)(r,(function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"show",rawName:"v-show",value:e.isFristVisited,expression:"isFristVisited"}],staticClass:"guide",on:{click:function(t){e.isFristVisited=!1}}},[t("div",{staticClass:"guide__text"},[e._v("左右切换滑动")]),e._m(0)])}),[function(){var e=this._self._c;return e("div",{staticClass:"guide__gesture"},[e("img",{attrs:{src:"static/images/leftslide.png"}}),e("img",{attrs:{src:"static/images/rightslide.png"}})])}],!1,null,null,null);t.a=c.exports},"391c":function(e,t,s){"use strict";s("e17f");var i=s("2241");s("456d"),s("ac6a"),t.a={methods:{canDoing:function(e,t){return new Promise((function(s,n){if(e&&"doing"===e.status){var r="exercise-".concat(t,"-").concat(e.id),a=JSON.parse(localStorage.getItem(r));a=a?Object.keys(a).forEach((function(e){a[e]=a[e].filter((function(e){return""!==e}))})):{},i.a.confirm({title:"提示",cancelButtonText:"放弃做题",confirmButtonText:"继续做题",message:"您有未完成的练习，是否继续？"}).then((function(){s()})).catch((function(){n({answer:a})}))}}))}}}},"98a2":function(e,t,s){"use strict";s("fd45")},ea75:function(e,t,s){"use strict";s.r(t),s("a481"),s("456d"),s("c5f6"),s("ac6a"),s("e7e5");var i=s("d399"),n=(s("e17f"),s("2241")),r=s("db72"),a=s("3ce7"),c=s("faa5"),o=s("2f62"),u=s("057e"),d=s("f5cc"),l=s("391c"),h=s("8ae7"),f=s("c8a5"),m=s("7c97"),v="",g={name:"ExerciseDo",components:{IbsFooter:s("a8b4").a,itemBank:d.a,guidePage:u.a,OutFocusMask:m.a},mixins:[l.a,h.a,f.a],data:function(){return{info:[],answer:{},lastAnswer:null,cardSeq:0,exercise:null,cardShow:!1,localanswerName:null,localtimeName:null,lastUsedTime:null,usedTime:null,isHandExercise:!1,slideIndex:0,forceLeave:!1,interval:null,exerciseMode:this.$route.query.exerciseMode,exerciseInfo:null,isLeave:!1,mode:"exercise",revieweNumLast:!1}},computed:Object(r.a)({},Object(o.e)({isLoading:function(e){return e.isLoading},user:function(e){return e.user}})),mounted:function(){this.getData(),this.initReport(),"0"===this.exerciseMode&&this.saveAnswerInterval()},beforeRouteEnter:function(e,t,s){document.getElementById("app").style.background="#F5F5F7",v="/"===t.fullPath?"/":"",s()},beforeRouteLeave:function(e,t,s){document.getElementById("app").style.background="",this.interval&&clearInterval(this.interval),0==this.info.length||this.isHandExercise||this.forceLeave||"doing"!=this.exercise.status||this.isLeave||this.submitpaper()?s():s(!1)},beforeDestroy:function(){this.clearTime(),n.a.close()},methods:Object(r.a)(Object(r.a)(Object(r.a)({},Object(o.d)({setNavbarTitle:c.x})),Object(o.c)("course",["handExercisedo","saveAnswerdo"])),{},{showCard:function(){this.cardShow=!0},getData:function(){var e=this,t=this.$route.query.exerciseId,s=this.$route.query.targetId;a.a.getExerciseInfo({query:{exerciseId:t},data:{targetId:s,targetType:"task",exerciseMode:this.exerciseMode}}).then((function(t){e.exerciseMode=t.exerciseMode,e.exerciseInfo=t,e.afterGetData(t)})).catch((function(t){var s=i.a.fail(t.message);"4036706"==t.code&&setTimeout((function(){e.toIntro(),s.clear()}),2e3)}))},initReport:function(){this.initReportData(this.$route.query.courseId,this.$route.query.targetId,"exercise")},afterGetData:function(e){this.setNavbarTitle(e.paperName),this.exercise=e,this.isDoing()||(this.getLocalData(),this.formatData(e),this.interruption(),this.saveTime())},isDoing:function(){return"doing"!=this.exercise.status&&(this.showResult(),!0)},interruption:function(){var e=this;this.$route.params.KeepDoing||this.canDoing(this.exercise,this.user.id).then((function(){})).catch((function(t){var s=t.answer;e.submitExercise(s)}))},formatData:function(e){var t=this;e.items.forEach((function(e){if("material"!=e.type){var s=t.sixType(e.type,e,t.lastAnswer);t.$set(t.answer,e.id,s.answer),t.info.push(s.item)}if("material"==e.type){var i=Object.assign({},e,{subs:""});e.subs.forEach((function(s,n){s.parentTitle=i,s.parentType=e.type,s.materialIndex=n+1;var r=t.sixType(s.type,s,t.lastAnswer);t.$set(t.answer,s.id,r.answer),t.info.push(r.item)}))}}))},formatStatus:function(e,t){var s=0;return("single_choice"==e||"choice"==e||"uncertain_choice"==e||"determine"==e)&&this.answer[t].length>0||"essay"==e&&""!=this.answer[t][0]?s=1:"fill"==e?s=Number(this.answer[t].some((function(e){return""!=e}))):s},slideToNumber:function(e){var t=Number(e);this.cardSeq=t,this.cardShow=!1},getLocalData:function(){this.localanswerName="exercise-".concat(this.user.id,"-").concat(this.exercise.id),this.localuseTime="exercise-".concat(this.user.id,"-").concat(this.exercise.id,"-usedTime"),this.lastAnswer=JSON.parse(localStorage.getItem(this.localanswerName))},saveTime:function(){var e=this,t=localStorage.getItem(this.localuseTime)||0;this.usedTime=setInterval((function(){localStorage.setItem(e.localuseTime,++t)}),1e3)},clearTime:function(){clearInterval(this.usedTime),this.usedTime=null},submitpaper:function(){var e=this,t=0,s=this.$t("courseLearning.sureSubmit"),i=JSON.parse(JSON.stringify(this.answer));Object.keys(i).forEach((function(e){i[e]=i[e].filter((function(e){return""!==e})),0===i[e].length&&t++})),t>0&&(s=this.$t("courseLearning.notSureSubmit",{number:t}));var r=this.revieweNumLast?this.$t("courseLearning.viewResult2"):this.$t("courseLearning.check"),a=this.revieweNumLast?this.$t("courseLearning.returnList"):this.$t("courseLearning.submitNow");this.saveAnswerInterval(),n.a.confirm({title:this.revieweNumLast?"":this.$t("courseLearning.submit2"),cancelButtonText:a,confirmButtonText:r,message:this.revieweNumLast?this.$t("courseLearning.doYouToResults"):s,className:"backDialog"}).then((function(){return document.getElementsByClassName("backDialog")[0].remove(),e.revieweNumLast?e.goResults():(e.cardShow=!0,!1)})).catch((function(){if(document.getElementsByClassName("backDialog")[0].remove(),e.clearTime(),e.revieweNumLast)return e.toCourseList();"1"===e.exerciseMode?e.endCueentAnswer():e.submitExercise(i).then((function(e){return!0})).catch((function(){return!1}))}))},submitExercise:function(e){var t=this;e||(e=JSON.parse(JSON.stringify(this.answer)),Object.keys(e).forEach((function(t){e[t]=e[t].filter((function(e){return""!==e}))})));var s={answer:e,exerciseId:this.$route.query.exerciseId,userId:this.user.id,exerciseResultId:this.exercise.id,courseId:this.$route.query.courseId};return new Promise((function(e,r){t.handExercisedo(s).then((function(s){t.isHandExercise=!0,e(),t.reprtData({eventName:"finish"}),t.showResult()})).catch((function(s){if("4036705"!=s.code)"50095204"!=s.code?(i.a.fail(s.message),r(s)):n.a.confirm({title:"你已提交过答题，当前页面无法重复提交",showCancelButton:!1,confirmButtonText:"退出答题"}).then((function(){return t.exitPage()}));else{var a=i.a.fail(s.message);setTimeout((function(){t.isHandExercise=!0,a.clear(),e(),t.showResult()}),2e3)}}))}))},saveAnswerInterval:function(){var e=this;clearInterval(this.interval),this.interval=setInterval((function(){e.saveAnswerAjax()}),3e4)},saveAnswerAjax:function(){var e=this;this.saveAnswerdo({admission_ticket:this.exercise.admission_ticket,answer:JSON.parse(JSON.stringify(this.answer)),resultId:this.exercise.id,courseId:this.$route.query.courseId}).catch((function(t){var s=t.code,r=t.message,a=t.traceId;50095204!==s?50095209!==s?a?n.a.confirm({title:"答题保存失败，请保存截图后，联系技术支持处理",message:"【".concat(r,"】【").concat(a,"】"),confirmButtonText:"退出答题"}).then((function(){return e.exitPage()})):(i.a.fail(err.message),n.a.confirm({title:"网络连接不可用，自动保存失败",showCancelButton:!1,confirmButtonText:"重新保存"}).then((function(){return e.saveAnswerAjax()}))):n.a.confirm({title:"有新答题页面，请在新页面中继续答题",showCancelButton:!1,confirmButtonText:"确定"}).then((function(){return e.exitPage()})):n.a.confirm({title:"你已提交过答题，当前页面无法重复提交",showCancelButton:!1,confirmButtonText:"退出答题"}).then((function(){return e.exitPage()}))}))},exitPage:function(){this.forceLeave=!0,this.$router.push("/course/".concat(this.exercise.courseId))},showResult:function(){this.$router.replace({name:"exerciseResult",query:{exerciseId:this.$route.query.exerciseId,exerciseResultId:this.exercise.id,taskId:this.$route.query.targetId,backUrl:v,courseId:this.$route.query.courseId}})},toIntro:function(){this.$router.replace({name:"exerciseIntro",query:{courseId:this.$route.query.courseId,taskId:this.$route.query.targetId,backUrl:v}})},endAnswer:function(){var e=this;n.a.confirm({title:"是否结束本次答题",confirmButtonText:"是",cancelButtonText:"否"}).then((function(){return e.endCueentAnswer()})).catch((function(){}))},toCourseList:function(){this.isLeave=!0,this.$router.replace({path:"/course/".concat(this.$route.query.courseId)})},endCueentAnswer:function(){var e=this;a.a.finishAnswer({query:{id:this.exerciseInfo.id}}).then((function(t){e.isLeave=!0,e.showResult()})).catch((function(e){i.a.fail(e.message)}))},goResults:function(){this.isLeave=!0,this.showResult()},reviewedCount:function(){this.revieweNumLast=!0}})},w=(s("98a2"),s("2877")),x=Object(w.a)(g,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"paper-swiper"},[t("out-focus-mask",{attrs:{type:e.outFocusMaskType,isShow:e.isShowOutFocusMask,reportType:e.reportType},on:{outFocusMask:e.outFocusMask}}),e.isLoading?t("e-loading"):e._e(),e.info.length>0?t("item-bank",{attrs:{current:e.cardSeq,info:e.info,answer:e.answer,"show-score":!1,"slide-index":e.slideIndex,all:e.info.length,exerciseInfo:e.exerciseInfo,type:e.$route.query.type,assessment_id:e.exerciseInfo.testId,exerciseMode:e.exerciseMode,admission_ticket:e.exerciseInfo.admission_ticket,"ai-agent-record-id":e.exerciseInfo.id,mode:e.mode},on:{"update:current":function(t){e.cardSeq=t},"update:answer":function(t){e.answer=t},"update:slideIndex":function(t){e.slideIndex=t},"update:slide-index":function(t){e.slideIndex=t},getData:e.getData,goResults:e.goResults,reviewedCount:e.reviewedCount}}):e._e(),t("guide-page"),"0"===this.exerciseMode?t("ibs-footer",{attrs:{mode:"do","show-save-process-btn":!1},on:{showcard:e.showCard,submitPaper:e.submitpaper}}):e._e(),t("van-popup",{style:{height:"100%"},attrs:{position:"bottom"},model:{value:e.cardShow,callback:function(t){e.cardShow=t},expression:"cardShow"}},[e.info.length>0?t("div",{staticClass:"card"},[t("div",{staticClass:"card-title"},[t("div",[t("span",{staticClass:"card-finish"},[e._v(e._s(e.$t("courseLearning.completed")))]),t("span",{staticClass:"card-nofinish"},[e._v(e._s(e.$t("courseLearning.notCompleted")))])]),t("i",{staticClass:"iconfont icon-no",on:{click:function(t){e.cardShow=!1}}})]),t("div",{staticClass:"card-list"},[t("div",{staticClass:"card-homework-item"},[t("div",{staticClass:"card-item-list"},e._l(e.info,(function(s){return t("div",{key:s.id,class:["list-cicle",1==e.formatStatus(s.type,s.id)?"cicle-active":""],on:{click:function(t){return e.slideToNumber(s.seq)}}},[e._v("\n              "+e._s(s.seq)+"\n            ")])})),0)])])]):e._e(),"1"===e.exerciseMode?t("van-button",{staticClass:"end-answer__btn",attrs:{type:"primary"},on:{click:e.endAnswer}},[e._v(e._s(e.$t("courseLearning.endAnswer")))]):e._e(),"1"===e.exerciseMode&&e.revieweNumLast?t("van-button",{staticClass:"end-answer__btn",attrs:{type:"primary"},on:{click:e.goResults}},[e._v(e._s(e.$t("courseLearning.viewResult2")))]):e._e()],1)],1)}),[],!1,null,"20daffab",null);t.default=x.exports},fd45:function(e,t,s){}}]);