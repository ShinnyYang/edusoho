(window.webpackJsonp=window.webpackJsonp||[]).push([["testpaperResult"],{"444d":function(t,e,s){},"7c97":function(t,e,s){"use strict";var i={props:{type:{type:String,default:""},isShow:{type:Boolean,default:!1},reportType:{type:String,default:""}},methods:{onKeepLearning:function(t){this.$emit("outFocusMask",t)}}},r=s("0c7c"),a=Object(r.a)(i,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.isShow?s("div",{staticClass:"out-focus-mask"},[s("div",{staticClass:"report-go-back",on:{click:function(e){return t.$router.go(-1)}}},[s("van-icon",{attrs:{name:"arrow-left",size:"25",color:"#43bc60"}})],1),"kick_previous"===t.type?[s("div",{staticClass:"content"},[t._m(0),s("van-button",{attrs:{color:"#43bc60",size:"small"},on:{click:function(e){return t.onKeepLearning("kick_previous")}}},[t._v("\n        继续学习\n      ")])],1)]:t._e(),"reject_current"===t.type?[t._m(1)]:t._e()],2):t._e()}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"tips"},[e("p",{staticClass:"kick-each-other"},[this._v("请勿同时多开任务学习")]),e("p",{staticClass:"kick-each-other"},[this._v("不要一心多用哦！")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"content"},[e("div",{staticClass:"tips"},[e("p",{staticClass:"kick-each-other"},[this._v("请勿同时多开任务学习")]),e("p",{staticClass:"kick-each-other"},[this._v("不要一心多用哦！")])])])}],!1,null,null,null);e.a=a.exports},a730:function(t,e,s){"use strict";s.r(e),s("8e6e"),s("456d"),s("e17f");var i=s("2241"),r=(s("e7e5"),s("d399")),a=(s("a481"),s("96cf"),s("3b8d")),n=(s("c5f6"),s("ac6a"),s("bd86")),o=s("3ce7"),u=s("2f62"),c=s("faa5"),l=s("b7cf"),h=s("c8a5"),p=s("0d25");function d(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function m(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?d(Object(s),!0).forEach((function(e){Object(n.a)(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):d(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}var v={name:"TestpaperResult",components:{OutFocusMask:s("7c97").a},mixins:[l.a,h.a],data:function(){return{enable_facein:"",isReadOver:!1,resultId:null,again:0,result:{},calHeight:null,subjectList:{},question_type_seq:[],targetId:null,hasRemainderDoTimes:null,redoInterval:null,remainTime:null,timeMeter:null,testpaperTitle:null,canDoAgain:"",obj:{single_choice:"courseLearning.singleChoice",choice:"courseLearning.choice",essay:"courseLearning.essay",uncertain_choice:"courseLearning.uncertainChoice",determine:"courseLearning.determine",fill:"courseLearning.fill",material:"courseLearning.material"},color:{right:"green",none:"brown",wrong:"orange",partRight:"orange",noAnswer:"gray"},resultShow:!1}},computed:m(m({},Object(u.e)({isLoading:function(t){return t.isLoading},user:function(t){return t.user},selectedPlanId:function(t){return t.course.selectedPlanId}})),{},{usedTime:function(){var t=parseInt(this.result.usedTime)||0,e=Math.floor(t/60)||0;return{minutes:e,second:t-60*e}}}),watch:{hasRemainderDoTimes:function(){this.calSubjectHeight()}},mounted:function(){this.initReport(),this.getTestpaperResult()},beforeRouteEnter:function(t,e,s){document.getElementById("app").style.background="#f6f6f6",s()},beforeRouteLeave:function(t,e,s){document.getElementById("app").style.background="",s()},beforeDestroy:function(){this.clearTime()},methods:m(m(m({},Object(u.d)({setNavbarTitle:c.x})),Object(u.c)("course",["handExamdo"])),{},{getRightAnswerData:function(t){var e=0,s=0;return(this.subjectList[t]||[]).forEach((function(t){"right"===t.status&&e++,s+=Number(t.score)})),{totalNumber:e,totalScore:s}},getTestpaperResult:function(){var t=this;return Object(a.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,o.a.testpaperResult({query:{resultId:t.$route.query.resultId}}).then((function(e){t.result=e.testpaperResult,t.question_type_seq=e.testpaper.metas.question_type_seq,t.isReadOver="finished"===t.result.status,t.resultShow=e.resultShow,t.getSubjectList(e.items),t.calSubjectHeight(),t.reprtData({eventName:"doing"}),t.canDoing(t.result,t.user.id).then((function(){t.startTestpaper("KeepDoing")})).catch((function(e){var s=e.answer,i=e.endTime;t.submitExam(s,i)}))}));case 2:t.getInfo();case 3:case"end":return e.stop()}}),e)})))()},initReport:function(){this.initReportData(this.selectedPlanId,this.$route.query.targetId,"testpaper")},judgeTime:function(){var t=this,e=this.redoInterval;if(0!=e){var s=60*parseInt(e)*1e3,i=(new Date).getTime(),r=1e3*parseInt(this.result.checkedTime)+s;this.again=i>=r,this.again||(r=Math.floor((r-i)/1e3),this.timeMeter=setInterval((function(){t.remainTime=Object(p.formatTimeByNumber)(r--),t.sumTime<=0&&(t.again=!0,t.clearTime())}),1e3))}else this.again=!0},getSubjectList:function(t){var e=this,s=function(s){var i=[];t[s].forEach((function(t){"material"===s?t.subs.forEach((function(t){e.getStatus(t,i)})):e.getStatus(t,i)})),e.subjectList[s]=i};for(var i in t)s(i)},calSubjectHeight:function(){var t=this;this.$nextTick((function(){var e=t.$refs.data.offsetHeight+t.$refs.tag.offsetHeight+46,s=document.documentElement.clientHeight-e-(t.$refs.footer.offsetHeight||0);t.calHeight="".concat(s,"px")}))},getStatus:function(t,e){var s={};s.seq=t.seq,s.score=t.testResult.score,t.testResult?s.status=t.testResult.status:s.status="noAnswer",e.push(s)},submitExam:function(t,e){var s=this;e=e||(new Date).getTime();var i={answer:t,resultId:this.result.id,userId:this.user.id,beginTime:Number(this.result.beginTime),endTime:e};this.handExamdo(i).then((function(t){s.$router.replace({name:"testpaperResult",query:{resultId:s.$route.query.resultId,testId:s.$route.query.testId,targetId:s.$route.query.targetId}})})).catch((function(t){r.a.fail(t.message)}))},clearTime:function(){clearInterval(this.timeMeter),this.timeMeter=null},startTestpaper:function(){1===this.enable_facein?i.a.alert({title:"",confirmButtonText:"知道了",message:"本场考试已开启云监考，暂不支持在移动端答题，请前往PC端进行答题。"}).then((function(){})):this.goDoTestpaper()},goDoTestpaper:function(){this.$router.push({name:"testpaperIntro",query:{testId:this.result.testId,targetId:this.reportData.taskId}})},getInfo:function(){var t=this;this.testId=this.$route.query.testId,this.targetId=this.$route.query.targetId,o.a.testpaperIntro({params:{targetId:this.targetId,targetType:"task"},query:{testId:this.testId}}).then((function(e){var s=e.task.activity.testpaperInfo.canDoAgain;t.testpaperTitle=e.task.title,t.setNavbarTitle(e.task.title),t.redoInterval=Number(e.task.activity.testpaperInfo.redoInterval),t.enable_facein=e.task.enable_facein,t.canDoAgain=s,t.hasRemainderDoTimes="1"===t.canDoAgain,t.judgeTime()}))},viewAnalysis:function(){this.$router.push({name:"testpaperAnalysis",query:{resultId:this.$route.query.resultId,title:this.testpaperTitle,targetId:this.$route.query.targetId}})}})},f=(s("ef85"),s("0c7c")),g=Object(f.a)(v,(function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"testResults"},[s("out-focus-mask",{attrs:{type:t.outFocusMaskType,isShow:t.isShowOutFocusMask,reportType:t.reportType},on:{outFocusMask:t.outFocusMask}}),t.isLoading?s("e-loading"):t._e(),s("div",{staticClass:"testpaper-result-status"},["passed"===t.result.passedStatus?s("img",{attrs:{src:"static/images/testpaper/passed-bg.png"}}):s("img",{attrs:{src:"static/images/testpaper/unpassed-bg.png"}}),s("div",{staticClass:"trs-content"},[t.isReadOver?[s("div",{staticClass:"result-score"},[s("span",{staticClass:"data-number"},[t._v(t._s(t.result.score))]),s("span",{staticClass:"data-unit"},[t._v(t._s(t.$t("courseLearning.branch")))])]),s("div",{staticClass:"result-score-tips"},[t._v("\n          "+t._s("passed"===t.result.passedStatus?t.$t("courseLearning.passedTips"):t.$t("courseLearning.unpassedTips"))+"\n        ")])]:s("div",{staticClass:"text-center"},[s("img",{staticStyle:{width:"44px"},attrs:{src:"static/images/testpaper/reviewing-icon.png"}}),s("div",{staticStyle:{"margin-top":"4px"}},[t._v(t._s(t.$t("courseLearning.reviewing")))])])],2)]),t.result?s("div",{ref:"data",staticClass:"testpaper-result-data"},[t.isReadOver?s("div",{staticClass:"testpaper-result-data__item"},[s("div",{staticClass:"trd-header"},[t._v(t._s(t.$t("courseLearning.correctRate")))]),s("div",[s("span",{staticClass:"data-number"},[t._v(t._s(t.result.rightRate))]),s("span",{staticClass:"data-unit"},[t._v("%")])])]):t._e(),t.result.limitedTime>0?s("div",{staticClass:"testpaper-result-data__item"},[s("div",{staticClass:"trd-header"},[t._v(t._s(t.$t("courseLearning.examinationDuration")))]),s("div",[s("span",{staticClass:"data-number"},[t._v(t._s(t.result.limitedTime))]),s("span",{staticClass:"data-unit"},[t._v(t._s(t.$t("courseLearning.minutes")))])])]):t._e(),s("div",{staticClass:"testpaper-result-data__item"},[s("div",{staticClass:"trd-header"},[t._v(t._s(t.$t("courseLearning.examTotalTips")))]),s("div",[s("span",{staticClass:"data-number"},[t._v(t._s(t.usedTime.minutes))]),s("span",{staticClass:"data-unit"},[t._v(t._s(t.$t("courseLearning.branch")))]),s("span",{staticClass:"ml-4 data-number"},[t._v(t._s(t.usedTime.second))]),s("span",{staticClass:"data-unit"},[t._v(t._s(t.$t("courseLearning.second")))])])])]):t._e(),t.result.teacherSay?s("div",{staticClass:"teacher-say"},[t._v("\n    "+t._s(t.$t("courseLearning.teacherSay"))+"："+t._s(t.result.teacherSay)+"\n  ")]):t._e(),s("div",{staticClass:"testpaper-result"},[s("div",{staticClass:"testpaper-result__header"},[s("div",[t._v(t._s(t.$t("courseLearning.qustionType")))]),s("div",[t._v(t._s(t.$t("courseLearning.corretAnswer")))]),s("div",[t._v(t._s(t.$t("courseLearning.fullScoreOfTestPaper")))])]),s("div",{staticClass:"testpaper-result__content"},t._l(t.question_type_seq,(function(e){return s("div",{key:e,staticClass:"trc-item"},[s("div",{staticClass:"question-type"},[t._v(t._s(t.$t(t.obj[e])))]),s("div",{staticClass:"question-answer"},[s("span",{staticClass:"right-number"},[t._v(t._s(t.getRightAnswerData(e).totalNumber))]),t._v("/"+t._s(t.subjectList[e].length)+"\n        ")]),s("div",{staticClass:"question-total"},[t._v(t._s(t.getRightAnswerData(e).totalScore))])])})),0)]),s("div",{ref:"footer",staticClass:"result-footer"},[t.resultShow?s("van-button",{staticClass:"result-footer__btn",style:{marginRight:t.isReadOver&&t.hasRemainderDoTimes?"2vw":0},attrs:{type:"primary"},on:{click:function(e){return t.viewAnalysis()}}},[t._v(t._s(t.$t("courseLearning.viewParsed")))]):t._e(),t.again&&t.isReadOver&&t.hasRemainderDoTimes?s("van-button",{staticClass:"result-footer__btn",attrs:{type:"primary"},on:{click:function(e){return t.startTestpaper()}}},[t._v(t._s(t.$t("courseLearning.takeTheTestAgain")))]):t._e(),!t.again&&t.isReadOver&&t.hasRemainderDoTimes?s("van-button",{staticClass:"result-footer__btn",attrs:{type:"primary",disabled:""}},[s("div",[t._v(t._s(t.remainTime))]),t._v("\n      "+t._s(t.$t("courseLearning.takeTheTestAgain"))+"\n    ")]):t._e()],1)],1)}),[],!1,null,null,null);e.default=g.exports},b7cf:function(t,e,s){"use strict";s("c5f6"),s("e17f");var i=s("2241");s("456d"),s("ac6a"),e.a={methods:{canDoing:function(t,e){return new Promise((function(s,r){if(t&&"doing"===t.status){var a="".concat(e,"-").concat(t.id),n=JSON.parse(localStorage.getItem(a));n=n?Object.keys(n).forEach((function(t){n[t]=n[t].filter((function(t){return""!==t}))})):{},i.a.confirm({title:"提示",cancelButtonText:"放弃考试",confirmButtonText:"继续考试",message:"您有未完成的考试，是否继续？"}).then((function(){if(Number(t.limitedTime)>0){var e=Math.ceil(((new Date).getTime()-1e3*t.beginTime)/1e3/60);if(Number(e)>Number(t.limitedTime)){var i=Number(1e3*t.beginTime)+Number(60*t.limitedTime*1e3);return void r({answer:n,endTime:i})}}s()})).catch((function(){r({answer:n,endTime:null})}))}}))}}}},c8a5:function(t,e,s){"use strict";s("6762"),s("2fdb");var i=s("3ce7"),r=s("faa5");e.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0,isShowOutFocusMask:!1,outFocusMaskType:"",sign:"",record:{},absorbed:0,learnedTime:0}},beforeRouteLeave:function(t,e,s){this.sign.length>0&&localStorage.setItem("flowSign",this.sign),s()},beforeDestroy:function(){this.clearReportIntervalTime(),window.removeEventListener("beforeunload",this.onbeforeunloadFlowSign),this.toggleReportMaskHidden("remove")},methods:{initReportData:function(t,e,s){var i=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];this.clearReportIntervalTime(),this.reportData={courseId:t,taskId:e},this.reportType=s,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,i&&this.initReportEvent(),this.onbeforeunload()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(t,e){var s=this,r={courseId:t,taskId:e};return new Promise((function(t,e){i.a.getCourseData({query:r}).then((function(e){s.reportFinishCondition=e.activity.finishCondition,t(e)})).catch((function(t){e(t)}))}))},reprtData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{eventName:"doing",ContinuousReport:!1,watchTime:null};if(null!==this.reportData.courseId&&null!==this.reportData.taskId&&(!this.isFinish||t.ContinuousReport))if(""===this.sign){var e={client:"h5"},s=localStorage.getItem("flowSign");s&&(e.lastSign=s,localStorage.removeItem("flowSign")),this.start(t,e)}else this.reportTaskEvent(t)},start:function(t,e){var s=this;i.a.reportTaskEvent({query:{courseId:this.reportData.courseId,taskId:this.reportData.taskId,eventName:"start"},data:e}).then((function(e){if(s.handleReportResult(e),e.learnControl.allowLearn)s.sign=e.record.flowSign,s.record=e.record,s.reportTaskEvent(t);else{var i=e.learnControl.denyReason;s.reportJudge(i)}}))},reportTaskEvent:function(t){var e=this;if(0!==this.sign.length){var s={client:"h5",sign:this.sign,duration:this.learnTime,status:this.absorbed};if(t.reActive&&(s.reActive=t.reActive),this.sourceType&&"video"===this.sourceType){var r=parseInt(this.nowWatchTime-this.lastWatchTime);this.lastWatchTime=this.nowWatchTime;var a={watchData:{duration:r}};s=Object.assign(s,a)}this.learnTime=0,i.a.reportTaskEvent({query:{courseId:this.reportData.courseId,taskId:this.reportData.taskId,eventName:t.eventName},data:s}).then((function(t){if(e.handleReportResult(t),e.record=t.record,e.absorbed=0,e.sign=t.record.flowSign,!t.learnControl.allowLearn){var s=t.learnControl.denyReason;e.reportJudge(s)}})).catch((function(t){e.clearReportIntervalTime()}))}},handleReportResult:function(t){this.reportResult=t,this.learnedTime=t.learnedTime,t.taskResult&&"finish"===t.taskResult.status?(this.isFinish=!0,this.$store.commit(r.B,"finish"),this.$store.commit("course/".concat(r.F),t.completionRate)):this.$store.commit(r.B,"start")},intervalReportLearnTime:function(){var t=this;this.reportLearnTime=setInterval((function(){t.checkoutTime(),t.learnTime++}),1e3)},intervalReportData:function(){var t=this,e=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){t.reprtData({eventName:"doing",ContinuousReport:!0})}),e)},checkoutTime:function(){this.reportFinishCondition&&["time","watchTime"].includes(this.reportFinishCondition.type)&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData({eventName:"finish",ContinuousReport:!0})},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null},reportJudge:function(t){"kick_previous"===t?this.kickEachOther("kick_previous"):"reject_current"===t&&(this.clearReportIntervalTime(),this.kickEachOther("reject_current"))},outFocusMask:function(t){this.absorbed=1,this.isShowOutFocusMask=!1,!this.player||"video"!==this.reportType&&"audio"!==this.reportType||this.player.play(),this.toggleReportMaskHidden("remove"),this.reprtData({eventName:"doing",ContinuousReport:!0,reActive:1})},kickEachOther:function(t){if(this.absorbed=1,"testpaper"!==this.reportType&&"live"!==this.reportType&&"homework"!==this.reportType||"kick_previous"!==t){if(this.isShowOutFocusMask=!0,this.outFocusMaskType=t,"video"===this.reportType||"audio"===this.reportType){if(this.player&&this.player.destory&&"reject_current"===t)return void this.player.destory();this.player&&this.player.pause&&this.player.pause()}this.toggleReportMaskHidden("add")}},ineffectiveLearning:function(t){this.isShowOutFocusMask||(this.absorbed=0,this.isShowOutFocusMask=!0,this.outFocusMaskType=t,this.player&&"video"===this.reportType&&this.player.pause(),this.reprtData({eventName:"doing",ContinuousReport:!0}))},toggleReportMaskHidden:function(t){"video"!==this.reportType&&"audio"!==this.reportType&&("add"===t?document.getElementsByTagName("body")[0].classList.add("report-mask-hidden"):"remove"===t&&document.getElementsByTagName("body")[0].classList.remove("report-mask-hidden"))},initVisibilitychange:function(){document.addEventListener("visibilitychange",this.visibilityState)},visibilityState:function(){"video"===this.reportType&&("hidden"===document.visibilityState?this.ineffectiveLearning("ineffective_learning"):"visible"===document.visibilityState&&this.player.pause())},onbeforeunload:function(){window.addEventListener("beforeunload",this.onbeforeunloadFlowSign)},onbeforeunloadFlowSign:function(){this.sign.length>0&&localStorage.setItem("flowSign",this.sign)}}}},ef85:function(t,e,s){"use strict";var i=s("444d");s.n(i).a}}]);