(window.webpackJsonp=window.webpackJsonp||[]).push([["marketingWxpay"],{"180e":function(e,t,r){"use strict";var n=r("3aa8");r.n(n).a},"3aa8":function(e,t,r){},8567:function(e,t,r){"use strict";r.r(t),r("8e6e"),r("ac6a"),r("456d"),r("e17f");var n=r("2241"),a=(r("e7e5"),r("d399")),i=(r("c5f6"),r("96cf"),r("3b8d")),o=r("bd86"),s=r("3ce7"),c=r("2f62");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(Object(r),!0).forEach((function(t){Object(o.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l={name:"MarketingWXPay",data:function(){return{isLoading:!1,payInfo:null,loginConfig:{},isPay:!1}},computed:f(f({},Object(c.e)({token:function(e){return e.token}})),{},{isWeixinBrowser:function(){return/micromessenger/.test(navigator.userAgent.toLowerCase())}}),created:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){var r,i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(document.title=e.$t("title.confirmPayment"),e.token){t.next=4;break}return s.a.loginConfig({}).then((function(t){e.loginConfig=t,Number(t.weixinmob_enabled)&&e.isWeixinBrowser&&e.wxLogin()})),t.abrupt("return");case 4:if(r=e.$route.query.payToken||""){t.next=8;break}return a.a.fail("缺少关键信息"),t.abrupt("return");case 8:return t.next=10,s.a.getMarketingMallPayConfig({data:{token:r}});case 10:if(!1!==(i=t.sent).success){t.next=14;break}return n.a.alert({confirmButtonText:"我知道了",confirmButtonColor:"#165DFF",message:i.message}),t.abrupt("return");case 14:e.payInfo=i,e.handlePay(),window.addEventListener("unload",(function(){return e.closeOrder()}));case 17:case"end":return t.stop()}}),t)})))()},methods:{closeOrder:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){var r,n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isPay){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,s.a.closeMarketingMallOrder({orderSn:e.payInfo.orderSn});case 4:for(r=0;r<=1e4;r++)for(n=0;n<=1e4;n++);case 5:case"end":return t.stop()}}),t)})))()},handleAmount:function(e){return e/100},handlePay:function(){var e=this;return Object(i.a)(regeneratorRuntime.mark((function t(){var r,a;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$route.query.payToken||"",t.next=3,s.a.checkMarketingMallPayConfig({params:{token:r}});case 3:if(!1!==(a=t.sent).success){t.next=7;break}return n.a.alert({confirmButtonText:"我知道了",confirmButtonColor:"#165DFF",message:a.message}),t.abrupt("return");case 7:WeixinJSBridge.invoke("getBrandWCPayRequest",e.payInfo.config,(function(t){"get_brand_wcpay_request:ok"==t.err_msg?(e.isPay=!0,window.location.href=e.payInfo.redirectUrl+"&isNeedCheckOrderStatus=1&sn=".concat(e.payInfo.orderSn)):"get_brand_wcpay_request:fail"==t.err_msg||t.err_msg}));case 8:case"end":return t.stop()}}),t)})))()},wxLogin:function(){this.$router.push({path:"/auth/social",query:{type:"wx",weixinmob_key:this.loginConfig.weixinmob_key,redirect:this.$route.query.redirect||this.$route.path,callbackType:this.$route.query.callbackType,activityId:this.$route.query.activityId}})}}},p=(r("180e"),r("0c7c")),d=Object(p.a)(l,(function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isWeixinBrowser&&e.payInfo?r("div",{staticClass:"marketing-wxpay"},[r("div",{staticClass:"marketing-wxpay__title"},[e._v(e._s(e.$t("marketingPay.amountLabel")))]),r("div",{staticClass:"marketing-wxpay__amount"},[r("span",{staticClass:"amount-unit"},[e._v("￥")]),r("span",{staticClass:"amount-number"},[e._v(e._s((e.payInfo.amount/100).toFixed(2)))])]),r("div",{staticClass:"marketing-wxpay__info"},[r("div",{staticClass:"info-label"},[e._v(e._s(e.$t("marketingPay.orderSnLabel")))]),r("div",{staticClass:"info-desc"},[e._v(e._s(e.payInfo.orderSn))])]),r("div",{staticClass:"marketing-wxpay__info",staticStyle:{border:"none"}},[r("div",{staticClass:"info-label"},[e._v(e._s(e.$t("marketingPay.acceptLabel")))]),r("div",{staticClass:"info-desc"},[e._v(e._s(e.payInfo.siteName))])]),r("div",{staticClass:"pay-btn",on:{click:e.handlePay}},[e._v("\n    "+e._s(e.$t("marketingPay.payNow"))+"\n  ")])]):e._e()}),[],!1,null,"de80c028",null);t.default=d.exports}}]);