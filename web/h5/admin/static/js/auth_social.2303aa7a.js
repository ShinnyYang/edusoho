(window.webpackJsonp=window.webpackJsonp||[]).push([["auth_social"],{"386d":function(e,t,o){"use strict";var r=o("cb7c"),n=o("83a1"),i=o("5f1b");o("214f")("search",1,(function(e,t,o,c){return[function(o){var r=e(this),n=void 0==o?void 0:o[t];return void 0!==n?n.call(o,r):new RegExp(o)[t](String(r))},function(e){var t=c(o,e,this);if(t.done)return t.value;var a=r(e),s=String(this),u=a.lastIndex;n(u,0)||(a.lastIndex=0);var d=i(a,s);return n(a.lastIndex,u)||(a.lastIndex=u),null===d?-1:d.index}]}))},4917:function(e,t,o){"use strict";var r=o("cb7c"),n=o("9def"),i=o("0390"),c=o("5f1b");o("214f")("match",1,(function(e,t,o,a){return[function(o){var r=e(this),n=void 0==o?void 0:o[t];return void 0!==n?n.call(o,r):new RegExp(o)[t](String(r))},function(e){var t=a(o,e,this);if(t.done)return t.value;var s=r(e),u=String(this);if(!s.global)return c(s,u);var d=s.unicode;s.lastIndex=0;for(var l,h=[],f=0;null!==(l=c(s,u));){var p=String(l[0]);h[f]=p,""===p&&(s.lastIndex=i(u,n(s.lastIndex),d)),f++}return 0===f?null:h}]}))},7067:function(e,t,o){"use strict";o("e17f");var r=o("2241"),n=(o("e7e5"),o("d399")),i=o("a026"),c=o("3ce7"),a=/micromessenger/.test(navigator.userAgent.toLowerCase());t.a=function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||o&&!t)n.a.fail("缺少分享参数");else{var s={domainUri:location.origin,itemUri:"",source:"h5"};c.a.marketingActivities({query:{activityId:e},data:s}).then((function(e){var c=-1!==e.url.indexOf("?")?"&":"?",s=o?"".concat(t).concat(c,"ticket=").concat(e.ticket):e.url;a?window.location.href=s:r.a.confirm({message:"去微信完成活动",confirmButtonText:"复制链接",title:""}).then((function(){try{i.default.prototype.$copyText(s).then((function(){n.a.success("复制成功")}),(function(){n.a.fail("请更换浏览器复制")}))}catch(e){n.a.fail("请更换浏览器复制")}})).catch((function(){}))})).catch((function(e){n.a.fail(e.message)}))}}},"83a1":function(e,t){e.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},8820:function(e,t,o){"use strict";o.r(t),o("4917");var r=o("3ce7"),n={data:function(){return{code:"",popupShow:!1,closeOnClickOverlay:!1,btnDisable:!0,isErrorCode:!1,errorText:"",courseId:"",courseTitle:""}},watch:{code:function(e,t){var o=e.length-t.length;if(Math.abs(o)>8){var r=this.spliceCode(e);this.code=r||e,this.isErrorCode=!1,this.btnDisable=!1,this.errorText=""}}},methods:{spliceCode:function(e){var t=/[a-z0-9A-Z]{8}/;return!!e.match(t)&&e.match(t)[0]},checkCodeChange:function(e){if(e.length>7)return/^[a-z0-9A-Z]{8}$/.test(e)?(this.isErrorCode=!1,this.btnDisable=!1,void(this.errorText="")):(this.isErrorCode=!0,void(this.errorText="8位数字、英文字母组成"));this.isErrorCode=!1,this.btnDisable=!0,this.errorText=""},codeCovert:function(e){var t=this;r.a.couponCheck({query:{code:e}}).then((function(o){if(console.log(o,"couponCheck res"),!1===o.success||o.error)return t.isErrorCode=!0,void(t.errorText=o.error.message);r.a.exchangeCoupon({query:{code:e}}).then((function(e){console.log("exchangeCoupon",e),t.courseId=e.products[0].course.id,t.courseTitle=e.products[0].course.displayedTitle,t.popupShow=!0})).catch((function(e){t.isErrorCode=!0,t.errorText=e.message}))}))},toStudy:function(){var e=this.courseId;if(e){var t=encodeURIComponent("/my/orders");this.$router.push({path:"/course/".concat(e,"?backUrl=").concat(t)})}}}},i=o("2877"),c=Object(i.a)(n,(function(){var e=this,t=e._self._c;return t("div",{staticClass:"coupon-covert-container"},[t("h2",{staticClass:"title"},[e._v(e._s(e.$t("title.coupon")))]),t("van-field",{class:[{"error-code":e.isErrorCode},"e-input","coupon-input"],attrs:{placeholder:e.$t("placeholder.voucherCode"),clearable:""},on:{input:function(t){return e.checkCodeChange(e.code)}},model:{value:e.code,callback:function(t){e.code="string"==typeof t?t.trim():t},expression:"code"}}),e.isErrorCode?t("span",{staticClass:"error-code text-14"},[e._v(e._s(e.errorText))]):e._e(),t("van-button",{staticClass:"covert-submit",attrs:{disabled:e.btnDisable||e.isErrorCode,type:"info"},on:{click:function(t){return e.codeCovert(e.code)}}},[e._v(e._s(e.$t("btn.confirm")))]),t("van-popup",{staticClass:"coupon-covert-popup",attrs:{"close-on-click-overlay":e.closeOnClickOverlay},model:{value:e.popupShow,callback:function(t){e.popupShow=t},expression:"popupShow"}},[t("div",{staticClass:"modal-content"},[e._v("\n      兑换成功\n      "),t("div",[e._v("恭喜您获得"+e._s(e.courseTitle)+"课程")])]),t("div",{staticClass:"color-primary mt10 text-15",on:{click:e.toStudy}},[e._v("去学习")])])],1)}),[],!1,null,null,null);t.default=c.exports},a262:function(e,t,o){"use strict";var r=o("7067");t.a={methods:{activityHandle:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];Object(r.a)(e,t,o)}}}},d863:function(e,t,o){"use strict";o("a481");var r=o("db72"),n=o("7067"),i=o("3ce7"),c=o("faa5"),a=o("2f62");t.a={data:function(){return{redirect:""}},computed:Object(r.a)({},Object(a.e)({user:function(e){return e.user}})),created:function(){this.redirect=decodeURIComponent(this.$route.fullPath)},methods:Object(r.a)(Object(r.a)({},Object(a.d)([c.w])),{},{afterLogin:function(){var e=this;this.checkMobileBind().then((function(t){var o=t.is_bind_mobile,r=t.mobile_bind_mode;e[c.w]({is_bind_mobile:o,mobile_bind_mode:r}),o||"closed"===r?setTimeout(e.jumpAction,1e3):e.$router.replace({name:"binding",query:{redirect:e.$route.query.redirect}})})).catch((function(){setTimeout(e.jumpAction,1e3)}))},jumpAction:function(){var e=this.$route.query.redirect?decodeURIComponent(this.$route.query.redirect):"/",t=this.$route.query.skipUrl?decodeURIComponent(this.$route.query.skipUrl):"",o=this.$route.query.callbackType,r=this.$route.query.activityId,i=decodeURIComponent(this.$route.query.callback);if(o)switch(o){case"marketing":Object(n.a)(r,i)}else t?this.$router.replace({path:e,query:{backUrl:t}}):this.$router.replace({path:e})},checkMobileBind:function(){return i.a.mobileBindCheck({query:{userId:this.user.id}})},upgradePassword:function(){this.$router.replace({name:"password_reset",query:{upgradePassword:1}})}})}},e289:function(e,t,o){"use strict";o.r(t);var r=o("db72"),n=o("c80c"),i=(o("386d"),o("4917"),o("e7e5"),o("d399")),c=(o("a481"),o("96cf"),o("3b8d")),a=o("a262"),s=o("d863"),u=o("faa5"),d=o("3ce7"),l=o("2f62"),h={name:"SocialWx",mixins:[a.a,s.a],created:function(){var e=this;return Object(c.a)(Object(n.a)().mark((function t(){var o,r;return Object(n.a)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.$store.state.token){t.next=9;break}if(1!=localStorage.getItem("first_direct")){t.next=5;break}return e.$router.replace({path:e.$route.query.redirect||"/"}),t.abrupt("return");case 5:return i.a.loading({message:"请稍后"}),e.afterLogin(),localStorage.setItem("first_direct",1),t.abrupt("return");case 9:if(o=localStorage.getItem("socialBinded_wx")?JSON.parse(localStorage.getItem("socialBinded_wx")):e.socialBinded.wx,e.setSocialStatus({key:"wx",status:o}),r=location.search.match(/\?code.*&/g)){t.next=16;break}return localStorage.setItem("first_direct",0),e.wxLogin(),t.abrupt("return");case 16:return i.a.loading({message:"正在登录"}),r=r[0].slice(6,-1),t.next=20,d.a.login({params:{code:r,type:"weixinmob"}}).then((function(t){e.userLogin(t),i.a.clear(),i.a.success({duration:2e3,message:"登录成功"});var o=e.socialBinded.wx?-2:-7;e.$route.query.callbackType&&(o+=1),localStorage.setItem("socialBinded_wx",!0),e.$router.go(o)})).catch((function(t){if(4030115===t.code)return i.a.fail({duration:2e3,message:t.message}),void e.redirectLogin();localStorage.setItem("socialBinded_wx",!1),window.location.href="/login/bind/weixinmob?os=h5&_target_path="+encodeURIComponent(location.pathname+location.hash)}));case 20:case"end":return t.stop()}}),t)})))()},computed:Object(r.a)({},Object(l.e)(["socialBinded"])),methods:Object(r.a)(Object(r.a)({},Object(l.d)({setSocialStatus:u.z,userLogin:u.H})),{},{wxLogin:function(){i.a.loading({message:"请稍后"});var e=encodeURIComponent(location.origin+location.pathname+location.hash);window.location.href="https://open.weixin.qq.com/connect/oauth2/authorize?appid="+this.$route.query.weixinmob_key+"&redirect_uri="+e+"&response_type=code&scope=snsapi_base&state=123&connect_redirect=1#wechat_redirect"},redirectLogin:function(){var e=this;setTimeout((function(){e.$router.replace({name:"login",query:{forbidWxLogin:!0}})}),2e3)}})},f=o("2877"),p=Object(f.a)(h,(function(){return(0,this._self._c)("div")}),[],!1,null,null,null);t.default=p.exports}}]);