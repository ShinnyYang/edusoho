(window.webpackJsonp=window.webpackJsonp||[]).push([["homeworkResult"],{"7c97":function(t,e,s){"use strict";var i={props:{type:{type:String,default:""},isShow:{type:Boolean,default:!1},reportType:{type:String,default:""}},methods:{onKeepLearning:function(t){this.$emit("outFocusMask",t)}}},r=s("2877"),o=Object(r.a)(i,(function(){var t=this,e=t._self._c;return t.isShow?e("div",{staticClass:"out-focus-mask"},[e("div",{staticClass:"report-go-back",on:{click:function(e){return t.$router.go(-1)}}},[e("van-icon",{attrs:{name:"arrow-left",size:"25",color:"#43bc60"}})],1),"kick_previous"===t.type?[e("div",{staticClass:"content"},[t._m(0),e("van-button",{attrs:{color:"#43bc60",size:"small"},on:{click:function(e){return t.onKeepLearning("kick_previous")}}},[t._v("\n        继续学习\n      ")])],1)]:t._e(),"reject_current"===t.type?[t._m(1)]:t._e()],2):t._e()}),[function(){var t=this._self._c;return t("div",{staticClass:"tips"},[t("p",{staticClass:"kick-each-other"},[this._v("请勿同时多开任务学习")]),t("p",{staticClass:"kick-each-other"},[this._v("不要一心多用哦！")])])},function(){var t=this._self._c;return t("div",{staticClass:"content"},[t("div",{staticClass:"tips"},[t("p",{staticClass:"kick-each-other"},[this._v("请勿同时多开任务学习")]),t("p",{staticClass:"kick-each-other"},[this._v("不要一心多用哦！")])])])}],!1,null,null,null);e.a=o.exports},a556:function(t,e,s){"use strict";s.d(e,"a",(function(){return o})),s("e7e5");var i=s("d399"),r=s("6647"),o=function(t){switch(t){case"course":Object(i.a)(r.a.t("goods.courseClosedToast"));break;case"classroom":Object(i.a)(r.a.t("goods.classroomClosedToast"));break;case"exercise":Object(i.a)(r.a.t("goods.exerciseClosedToast"))}}},c8a5:function(t,e,s){"use strict";s("6762"),s("2fdb");var i=s("3ce7"),r=s("faa5");s("a556"),e.a={data:function(){return{reportIntervalTime:null,reportLearnTime:null,reportFinishCondition:null,reportData:{courseId:null,taskId:null},reportResult:null,isFinish:!1,reportType:null,learnTime:0,isShowOutFocusMask:!1,outFocusMaskType:"",sign:"",record:{},absorbed:0,learnedTime:0,playKey:""}},beforeRouteLeave:function(t,e,s){this.sign.length>0&&localStorage.setItem("flowSign",this.sign),s()},beforeDestroy:function(){this.clearReportIntervalTime(),window.removeEventListener("beforeunload",this.onbeforeunloadFlowSign),this.toggleReportMaskHidden("remove")},methods:{initReportData:function(t,e,s,i){var r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];this.clearReportIntervalTime(),this.reportData={courseId:t,taskId:e},this.reportType=s,this.playKey=i,this.isFinish=!1,this.reportIntervalTime=null,this.reportLearnTime=null,this.reportResult=null,this.learnTime=0,this.reportFinishCondition=null,r&&this.initReportEvent(),this.onbeforeunload()},initReportEvent:function(){this.reprtData(),this.intervalReportData(),this.intervalReportLearnTime()},getCourseData:function(t,e){var s=this,r={courseId:t,taskId:e};return new Promise((function(t,e){i.a.getCourseData({query:r}).then((function(e){s.reportFinishCondition=e.activity.finishCondition,t(e)})).catch((function(t){e(t)}))}))},reprtData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{eventName:"doing",ContinuousReport:!1,watchTime:null};if(null!==this.reportData.courseId&&null!==this.reportData.taskId&&(!this.isFinish||t.ContinuousReport))if(""===this.sign){var e={client:"h5"},s=localStorage.getItem("flowSign");s&&(e.lastSign=s,localStorage.removeItem("flowSign")),this.start(t,e)}else this.reportTaskEvent(t)},start:function(t,e){var s=this;i.a.reportTaskEvent({query:{courseId:this.reportData.courseId,taskId:this.reportData.taskId,eventName:"start"},data:e}).then((function(e){if(s.handleReportResult(e),e.learnControl.allowLearn)s.sign=e.record.flowSign,s.record=e.record,s.reportTaskEvent(t);else{var i=e.learnControl.denyReason;s.reportJudge(i)}}))},reportTaskEvent:function(t){var e=this;if(0!==this.sign.length){var s={client:"h5",sign:this.sign,duration:this.learnTime,status:this.absorbed,lastLearnTime:parseInt(localStorage.getItem(this.playKey))};if(t.reActive&&(s.reActive=t.reActive),this.sourceType&&"video"===this.sourceType){var r=parseInt(this.nowWatchTime-this.lastWatchTime);this.lastWatchTime=this.nowWatchTime;var o={watchData:{duration:r}};s=Object.assign(s,o)}this.learnTime=0,i.a.reportTaskEvent({query:{courseId:this.reportData.courseId,taskId:this.reportData.taskId,eventName:t.eventName},data:s}).then((function(t){if(e.handleReportResult(t),e.record=t.record,e.absorbed=0,e.sign=t.record.flowSign,!t.learnControl.allowLearn){var s=t.learnControl.denyReason;e.reportJudge(s)}})).catch((function(t){e.clearReportIntervalTime()}))}},handleReportResult:function(t){this.reportResult=t,this.learnedTime=t.learnedTime,t.taskResult&&"finish"===t.taskResult.status?(this.isFinish=!0,this.$store.commit(r.B,"finish"),this.$store.commit("course/".concat(r.F),t.completionRate)):this.$store.commit(r.B,"start")},intervalReportLearnTime:function(){var t=this;this.reportLearnTime=setInterval((function(){t.checkoutTime(),t.learnTime++}),1e3)},intervalReportData:function(){var t=this,e=60*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:1)*1e3;this.reportIntervalTime=setInterval((function(){t.reprtData({eventName:"doing",ContinuousReport:!0})}),e)},checkoutTime:function(){this.reportFinishCondition&&["time","watchTime"].includes(this.reportFinishCondition.type)&&parseInt(this.learnTime/60,10)>=parseInt(this.reportFinishCondition.data,10)&&this.reprtData({eventName:"finish",ContinuousReport:!0})},clearReportIntervalTime:function(){clearInterval(this.reportIntervalTime),clearInterval(this.reportLearnTime),this.reportIntervalTime=null,this.reportLearnTime=null},reportJudge:function(t){"kick_previous"===t?this.kickEachOther("kick_previous"):"reject_current"===t&&(this.clearReportIntervalTime(),this.kickEachOther("reject_current"))},outFocusMask:function(t){this.absorbed=1,this.isShowOutFocusMask=!1,!this.player||"video"!==this.reportType&&"audio"!==this.reportType||this.player.play(),this.toggleReportMaskHidden("remove"),this.reprtData({eventName:"doing",ContinuousReport:!0,reActive:1})},kickEachOther:function(t){if(this.absorbed=1,"testpaper"!==this.reportType&&"live"!==this.reportType&&"homework"!==this.reportType||"kick_previous"!==t){if(this.isShowOutFocusMask=!0,this.outFocusMaskType=t,"video"===this.reportType||"audio"===this.reportType){if(this.player&&this.player.destory&&"reject_current"===t)return void this.player.destory();this.player&&this.player.pause&&this.player.pause()}this.toggleReportMaskHidden("add")}},ineffectiveLearning:function(t){this.isShowOutFocusMask||(this.absorbed=0,this.isShowOutFocusMask=!0,this.outFocusMaskType=t,this.player&&"video"===this.reportType&&this.player.pause(),this.reprtData({eventName:"doing",ContinuousReport:!0}))},toggleReportMaskHidden:function(t){"video"!==this.reportType&&"audio"!==this.reportType&&("add"===t?document.getElementsByTagName("body")[0].classList.add("report-mask-hidden"):"remove"===t&&document.getElementsByTagName("body")[0].classList.remove("report-mask-hidden"))},initVisibilitychange:function(){document.addEventListener("visibilitychange",this.visibilityState)},visibilityState:function(){"video"===this.reportType&&("hidden"===document.visibilityState?this.ineffectiveLearning("ineffective_learning"):"visible"===document.visibilityState&&this.player.pause())},onbeforeunload:function(){window.addEventListener("beforeunload",this.onbeforeunloadFlowSign)},onbeforeunloadFlowSign:function(){this.sign.length>0&&localStorage.setItem("flowSign",this.sign)}}}},cae6:function(t,e,s){"use strict";s.r(e),s("e7e5");var i=s("d399"),r=(s("a481"),s("ac6a"),s("db72")),o=s("3ce7"),a=s("2f62"),n=s("faa5"),u=s("ea9a"),c=s("c8a5"),l={name:"HomeworkResult",components:{OutFocusMask:s("7c97").a},mixins:[u.a,c.a],data:function(){return{result:null,calHeight:null,items:null,title:null,color:{right:"green",none:"brown",wrong:"orange",partRight:"orange",noAnswer:"gray"}}},computed:Object(r.a)(Object(r.a)({},Object(a.e)({isLoading:function(t){return t.isLoading},user:function(t){return t.user}})),{},{usedTime:function(){var t=parseInt(this.result.usedTime)||0;return t<60?1:Math.round(t/60)},isReadOver:function(){return!(!this.result||"finished"!==this.result.status)}}),mounted:function(){this.initReport(),this.gethomeworkResult()},beforeRouteEnter:function(t,e,s){document.getElementById("app").style.background="#f6f6f6",s()},beforeRouteLeave:function(t,e,s){document.getElementById("app").style.background="",s()},methods:Object(r.a)(Object(r.a)({},Object(a.d)({setNavbarTitle:n.x})),{},{gethomeworkResult:function(){var t=this;o.a.homeworkResult({query:{homeworkId:this.$route.query.homeworkId,homeworkResultId:this.$route.query.homeworkResultId}}).then((function(e){t.result=e,t.setNavbarTitle(e.paperName),t.title=e.paperName,t.interruption(),t.formatData(e),t.calSubjectHeight()}))},initReport:function(){this.initReportData(this.$route.query.courseId,this.$route.query.taskId,"homework")},interruption:function(){var t=this;this.canDoing(this.result,this.user.id).then((function(){t.startHomework()})).catch((function(e){var s=e.answer;t.submitHomework(s)}))},formatData:function(t){var e=this,s=[];t.items.forEach((function(t){"material"!=t.type&&(t.status=e.getStatus(t),s.push(t)),"material"==t.type&&t.subs.forEach((function(t){t.status=e.getStatus(t),s.push(t)}))})),this.items=s},getStatus:function(t){return t.testResult&&t.testResult.status?t.testResult.status:"noAnswer"},startHomework:function(){this.$router.replace({name:"homeworkDo",query:{targetId:this.$route.query.taskId,homeworkId:this.$route.query.homeworkId,courseId:this.$route.query.courseId},params:{KeepDoing:!0}})},submitHomework:function(t){var e=this,s={answer:t,homeworkId:this.$route.query.homeworkId,userId:this.user.id,homeworkResultId:this.$route.query.homeworkResultId,courseId:this.courseId};this.handHomeworkdo(s).then((function(t){e.reprtData({eventName:"finish"}),e.$router.replace({name:"homeworkResult",query:{homeworkId:e.$route.query.homeworkId,homeworkResultId:e.$route.query.homeworkResultId,courseId:e.$route.query.courseId,taskId:e.$route.query.taskId}})})).catch((function(t){i.a.fail(t.message)}))},calSubjectHeight:function(){var t=this;this.$nextTick((function(){var e=t.$refs.data.offsetHeight+t.$refs.tag.offsetHeight+46,s=document.documentElement.clientHeight-e-(t.$refs.footer.offsetHeight||0);t.calHeight="".concat(s,"px")}))},viewAnalysis:function(){this.$router.push({name:"homeworkAnalysis",query:{homeworkId:this.$route.query.homeworkId,homeworkResultId:this.$route.query.homeworkResultId,title:this.title,targetId:this.$route.query.taskId,courseId:this.$route.query.courseId}})}})},h=s("2877"),d=Object(h.a)(l,(function(){var t=this,e=t._self._c;return e("div",{staticClass:"testResults"},[e("out-focus-mask",{attrs:{type:t.outFocusMaskType,isShow:t.isShowOutFocusMask,reportType:t.reportType},on:{outFocusMask:t.outFocusMask}}),t.isLoading?e("e-loading"):t._e(),t.result?e("div",{ref:"data",staticClass:"result-data"},[e("div",{staticClass:"result-data__item"},[t._v("\n      "+t._s(t.$t("courseLearning.correctRate"))+"\n      "),t.isReadOver?e("div",{staticClass:"result-data__bottom data-number-green data-medium"},[e("span",{staticClass:"data-number"},[t._v(t._s(t.result.rightRate))]),t._v("%\n      ")]):e("div",{staticClass:"result-data__bottom data-text-blue"},[t._v(t._s(t.$t("courseLearning.toBeReviewed")))])]),e("div",{staticClass:"result-data__item"},[t._v("\n      "+t._s(t.$t("courseLearning.timeSpentOnTheQuestion"))+"\n      "),e("div",{staticClass:"result-data__bottom data-number-gray data-medium"},[e("span",{staticClass:"data-number"},[t._v(t._s(t.usedTime))]),t._v(t._s(t.$t("courseLearning.minutes"))+"\n      ")])])]):t._e(),e("div",{ref:"tag",staticClass:"result-tag"},[e("div",{staticClass:"result-tag-item clearfix"},[e("div",{staticClass:"result-tag-item__circle circle-green"}),t._v("\n      "+t._s(t.$t("courseLearning.right"))+"\n    ")]),e("div",{staticClass:"result-tag-item clearfix"},[e("div",{staticClass:"result-tag-item__circle circle-orange"}),t._v("\n      "+t._s(t.$t("courseLearning.wrong"))+"\n    ")]),e("div",{staticClass:"result-tag-item clearfix"},[e("div",{staticClass:"result-tag-item__circle circle-gray"}),t._v("\n      "+t._s(t.$t("courseLearning.unanswered"))+"\n    ")]),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.isReadOver,expression:"!isReadOver"}],staticClass:"result-tag-item clearfix"},[e("div",{staticClass:"result-tag-item__circle circle-brown"}),t._v("\n      "+t._s(t.$t("courseLearning.toBeReviewed"))+"\n    ")])]),e("div",{staticClass:"result-subject",style:{height:t.calHeight}},[e("div",{staticClass:"result-paner"},[e("ul",{staticClass:"result-list"},t._l(t.items,(function(s,i){return e("li",{key:i,class:["result-list__item homework-number","circle-".concat(t.color[s.status])]},[t._v("\n          "+t._s(s.seq)+"\n        ")])})),0)]),e("div",{ref:"footer",staticClass:"result-footer"},[e("van-button",{staticClass:"result-footer__btn",style:{marginRight:t.isReadOver?"2vw":0},attrs:{type:"primary"},on:{click:t.viewAnalysis}},[t._v(t._s(t.$t("courseLearning.viewParsed"))+"\n      ")]),t.isReadOver?e("van-button",{staticClass:"result-footer__btn",attrs:{type:"primary"},on:{click:function(e){return t.startHomework()}}},[t._v(t._s(t.$t("courseLearning.doItAgain"))+"\n      ")]):t._e()],1)])],1)}),[],!1,null,null,null);e.default=d.exports},ea9a:function(t,e,s){"use strict";s("e17f");var i=s("2241");s("456d"),s("ac6a"),e.a={methods:{canDoing:function(t,e){return new Promise((function(s,r){if(t&&"doing"===t.status){var o="homework-".concat(e,"-").concat(t.id),a=JSON.parse(localStorage.getItem(o));a=a?Object.keys(a).forEach((function(t){a[t]=a[t].filter((function(t){return""!==t}))})):{},i.a.confirm({title:"提示",cancelButtonText:"放弃做题",confirmButtonText:"继续做题",message:"您有未完成的作业，是否继续？"}).then((function(){s()})).catch((function(){r({answer:a})}))}}))}}}}}]);