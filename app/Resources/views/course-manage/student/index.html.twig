{% extends 'course-manage/layout.html.twig' %}

{% block title %}{{ 'course.members_manage'|trans }} - {{ course.title }} - {{ parent() }}{% endblock %}
{% do script(['app/js/course-manage/students/index.js', 'vue3/js/course-manage/students/index.js']) %}
{% set course_side_nav = 'students' %}
{% block main_heading_class %}course-main-header{% endblock %}
{% block main_heading %}
  {% include 'course-manage/panel-header/course-publish-header.html.twig' with {code: course_side_nav, btnGroup:1} %}
{% endblock %}

{% block main_body %}
  <div id="student-table-container" role="course-manage-student-index">
    {{ web_macro.flash_messages() }}
    {% include 'course-manage/student/panel-nav.html.twig' with {'panelNav': 'manage'} %}

    <form class="form-inline well well-sm" action="{{ path('course_set_manage_course_students', {courseSetId: courseSet.id, courseId: course.id}) }}" method="get" novalidate>
      <div class="form-group col-md-7">
        <input class="form-control" type="text" style="width:45%" placeholder="{{ 'course.members_manage.official_student.input_placeholder'|trans }}" name="keyword" value="{{ app.request.get('keyword') }}">
        <button type="submit" class="cd-btn cd-btn-primary">{{ 'course.members_manage.official_student.search'|trans }}</button>
      </div>
      <div class="clearfix"></div>
    </form>
    {% if students|length > 0 %}
      {% if courseSet.parentId == 0 %}
        <div class="flex items-center mb16">
          {% if isEnableAddAndRemove %}
            <button id="batch-remove" type="button" class="cd-btn cd-btn-default mr8"
                    data-url="{{ path('course_set_manage_course_students_remove_students', {courseSetId: course.courseSetId, courseId: course.id}) }}">
              {{ 'course.members_manage.official_student.batch_remove'|trans }}
            </button>
          {% endif %}

          <div class="cd-dropdown cd-dropdown-right" data-toggle="cd-dropdown">
            <button type="button" class="cd-btn cd-btn-default dropdown-toggle">
              {{ 'course.members_manage.official_student.batch_upload_deadline'|trans }}
              <i class="cd-icon cd-icon-arrow-down cd-text-sm"></i>
            </button>
            <ul class="dropdown-menu" role="menu">
              <li>
                <a id="batch-update-expiry-day"
                   class="clearfix"
                   href="javascript:;"
                   data-url="{{ path('course_set_manage_course_students_deadline_batch', {courseSetId: course.courseSetId, courseId: course.id}) }}">
                  {{ 'course.members_manage.official_student.batch_upload_deadline'|trans }}
                </a>
              </li>
              <li>
                <a id="all-update-expiry-day"
                   class="clearfix"
                   href="javascript:;"
                   data-url="{{ path('course_set_manage_course_students_deadline_batch', {courseSetId: course.courseSetId, courseId: course.id}) }}">
                  {{ 'course.members_manage.official_student.all_update_deadline'|trans }}
                </a>
              </li>
            </ul>
          </div>
        </div>
      {% endif %}
    {% endif %}
    <table class="table table-striped" id="course-student-list">
      <thead>
      <tr>
        <th><input type="checkbox" autocomplete="off" data-role="batch-select"></th>
        <th width="7%">{{ 'course.members_manage.official_student.seq'|trans }}</th>
        <th width="24%">{{ 'site.default.student'|trans }}</th>
        <th width="15%">{{ 'user.fields.mobile_simple_label'|trans }}</th>
        <th width="17%">{{ 'course.members_manage.official_student.progress'|trans }}</th>
        <th width="12%">{{ 'join.time'|trans }}</th>
        <th width="12%">{{ 'course.expiry_date'|trans }}</th>
        <th width="11%">{{ 'course.members_manage.official_student.operation'|trans }}</th>
      </tr>
      </thead>
      <tbody>
      {% for student in students if student %}
        {% set user = users[student.userId]|default(null) %}
        {% set userProfile = userProfiles[student.userId]|default(null) %}
        {% include 'course-manage/student/tr-v2.html.twig' %}
      {% else %}
        <tr class="empty">
          <td colspan="20">{{ 'course.members_manage.official_student.empty'|trans }}</td>
        </tr>
      {% endfor %}

      </tbody>
    </table>
    <nav class="text-center">
      {{ web_macro.advanced_paginator(paginator) }}
    </nav>
  </div>
{% endblock %}

{% block main %}
  <div style="margin-left: 200px; padding: 20px 32px 0 32px;">
    {{ web_macro.flash_messages() }}
    <div id="student-list-app"
         data-course-id="{{ course.id }}"
         data-course-set-id="{{ course.courseSetId }}"
         data-course-status="{{ course.status }}"
         data-is-normal-course="{{ courseSet.parentId == 0 }}"
         data-enable-add-and-remove="{{ isEnableAddAndRemove }}"
         data-enable-export="{{ enableExport }}"
    ></div>
  </div>

  <div id="export-modal" class="hide">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
          <h4 class="modal-title" data-success="{{ 'file.download.finish'|trans }}">{{ 'file.download.start'|trans }}</h4>
        </div>
        <div class="modal-body">
          <div class="progress progress-striped active">
            <div id="progress-bar" class="progress-bar progress-bar-success" style="width: 0"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
