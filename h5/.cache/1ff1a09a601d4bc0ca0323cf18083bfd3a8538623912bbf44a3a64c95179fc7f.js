{"source":"webpackJsonp([10],{\"162o\":function(e,i,o){(function(e){var t=void 0!==e&&e||\"undefined\"!=typeof self&&self||window,n=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}i.setTimeout=function(){return new s(n.call(setTimeout,t,arguments),clearTimeout)},i.setInterval=function(){return new s(n.call(setInterval,t,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(t,this._id)},i.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},i.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},i._unrefActive=i.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},o(\"mypn\"),i.setImmediate=\"undefined\"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,i.clearImmediate=\"undefined\"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(i,o(\"DuR2\"))},\"L/LV\":function(e,t,n){\"use strict\";var i=n(\"SgDA\");t.a={methods:{validateMobileOrPsw:function(e){var t=0<arguments.length&&void 0!==e?e:\"mobile\",n=this.userinfo[t],s=i.a[t];0===n.length&&(this.errorMessage[t]=\"\"),this.errorMessage[t]=s.validator(n)?\"\":s.message},validatedChecker:function(){var e=this.userinfo.mobile,t=i.a.mobile;this.validated.mobile=t.validator(e)}}}},cLXl:function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var s=n(\"Xxa5\"),i=n.n(s),o=(n(\"eqfM\"),n(\"/QYm\")),a=n(\"exGp\"),c=n.n(a),r=n(\"Dd8w\"),u=n.n(r),l=n(\"FVyg\"),d=(n(\"SgDA\"),n(\"KFVb\"),n(\"gyMJ\")),m=n(\"NyOD\"),f=n(\"1JqO\"),v=n(\"L/LV\"),p=n(\"NYxO\"),h={name:\"coupon-fast\",mixins:[m.a,f.a,v.a],components:{EDrag:l.a},data:function(){return{isShow:!1,userinfo:{mobile:\"\",dragCaptchaToken:void 0,smsCode:\"\",smsToken:\"\",type:\"receive_coupon\"},dragEnable:!1,dragKey:0,errorMessage:{mobile:\"\"},validated:{mobile:!1},count:{showCount:!1,num:60,codeBtnDisable:!1}}},computed:{btnDisable:function(){return!(this.userinfo.mobile&&this.userinfo.smsCode)},cansentCode:function(){return!(this.count.codeBtnDisable||!this.validated.mobile)}},methods:u()({},Object(p.mapActions)([\"addUser\",\"setMobile\",\"sendSmsSend\",\"fastLogin\"]),{handleSendSms:function(){var t=this;this.sendSmsSend(this.userinfo).then(function(e){t.userinfo.smsToken=e.smsToken,t.countDown(),t.dragEnable=!1,t.userinfo.dragCaptchaToken=\"\"}).catch(function(e){switch(e.code){case 4030301:case 4030302:t.dragKey++,t.userinfo.dragCaptchaToken=\"\",t.userinfo.smsToken=\"\",o.a.fail(e.message);break;case 4030303:t.dragEnable?o.a.fail(e.message):t.dragEnable=!0;break;default:o.a.fail(e.message)}})},handleSubmit:function(){var t=this;if(!this.btnDisable){var n={mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode};this.fastLogin({mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode,loginType:\"sms\",client:\"h5\"}).then(function(e){t.$emit(\"lReceiveCoupon\",n)}).catch(function(e){o.a.fail(e.message)})}},countDown:function(){var e=this;this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=60;var t=setInterval(function(){if(e.count.num<=0)return e.count.codeBtnDisable=!1,e.count.showCount=!1,void clearInterval(t);e.count.num--},1e3)},handleSmsSuccess:function(e){this.userinfo.dragCaptchaToken=e,this.handleSendSms()},clickSmsBtn:function(){!this.count.codeBtnDisable&&this.validated.mobile&&(this.dragEnable?this.$refs.dragComponent.dragToEnd?this.$refs.dragComponent.initDragCaptcha():Object(o.a)(\"请先完成拼图验证\"):this.handleSendSms())}})},g={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"div\",{staticClass:\"coupon-receive-login\"},[n(\"div\",{staticClass:\"receive-login-input\"},[n(\"van-field\",{attrs:{type:\"number\",placeholder:\"请输入手机号码\",clearable:\"\",\"error-message\":t.errorMessage.mobile},on:{blur:function(e){return t.validateMobileOrPsw(\"mobile\")},keyup:function(e){return t.validatedChecker()}},model:{value:t.userinfo.mobile,callback:function(e){t.$set(t.userinfo,\"mobile\",e)},expression:\"userinfo.mobile\"}})],1),t._v(\" \"),t.dragEnable?n(\"div\",{staticClass:\"mobile-drag\"},[n(\"div\",{staticClass:\"mobile-drag-content\"},[t.dragEnable?n(\"e-drag\",{key:t.dragKey,ref:\"dragComponent\",attrs:{limitType:\"receive_coupon\"},on:{success:t.handleSmsSuccess}}):t._e()],1)]):t._e(),t._v(\" \"),n(\"div\",{staticClass:\"receive-login-input\"},[n(\"van-field\",{attrs:{type:\"number\",placeholder:\"请输入验证码\",clearable:\"\",maxLength:\"6\",\"error-message\":\"\"},model:{value:t.userinfo.smsCode,callback:function(e){t.$set(t.userinfo,\"smsCode\",e)},expression:\"userinfo.smsCode\"}},[n(\"div\",{class:[\"code-btn\",t.cansentCode?\"\":\"code-btn--disabled\"],attrs:{slot:\"button\"},on:{click:t.clickSmsBtn},slot:\"button\"},[n(\"span\",{directives:[{name:\"show\",rawName:\"v-show\",value:!t.count.showCount,expression:\"!count.showCount\"}]},[t._v(\"发送验证码\")]),t._v(\" \"),n(\"span\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.count.showCount,expression:\"count.showCount\"}]},[t._v(t._s(t.count.num)+\" s\")])])])],1),t._v(\" \"),n(\"div\",{class:[\"receive-login__btn\",t.btnDisable?\"disabled__btn\":\"\"],on:{click:function(e){return t.handleSubmit()}}},[t._v(\"立即领取\")]),t._v(\" \"),t._m(0)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"receive-login__text\"},[t(\"span\",{staticClass:\"receive-login-tools\"},[this._v(\"新用户领取将为您自动注册\")])])}]},_=n(\"VU/8\")(h,g,!1,null,null,null).exports,b=n(\"OPcZ\"),C=n(\"w/qc\"),T=n(\"162o\"),y={name:\"getcoupon\",components:{fastLogin:_},mixins:[b.a,C.a],data:function(){return{coupons:null,login:!1,cloudSetting:!1,hasReceive:!1,ReceiveFail:!1,failmessage:\"\",loginMethods:!1}},created:function(){this.getCouponInfo()},computed:u()({},Object(p.mapState)({user:function(e){return e.user},isLoading:function(e){return e.isLoading}})),filters:{couponType:function(e){return\"discount\"==e?\"折\":\"元\"}},methods:{getCouponInfo:function(){var n=this;return c()(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.$route.params.token,e.next=3,d.a.getCouponInfo({query:{batchToken:t}}).then(function(e){n.coupons=e,n.canUseCoupon(e)&&n.isLogin()}).catch(function(e){o.a.fail(e.message)});case 3:case\"end\":return e.stop()}},e,n)}))()},getsettingsCloud:function(){var t=this;return c()(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.a.settingsCloud().then(function(e){1==e.sms_enabled?t.cloudSetting=!0:(t.cloudSetting=!1,t.toLogin())}).catch(function(e){o.a.fail(e.message)});case 2:case\"end\":return e.stop()}},e,t)}))()},isLogin:function(){if(this.$store.state.token){this.login=!0;var e={batchToken:this.$route.params.token};this.newReceiveCoupon(e)}else this.getsettingsCloud()},toLogin:function(){this.$router.push({name:\"login\",query:{redirect:this.$route.fullPath}})},couponType:function(e){if(e.target)switch(e.targetType){case\"course\":return\"课程/\"+e.target.title;case\"classroom\":return\"班级/\"+e.target.title;case\"vip\":return\"会员/\"+e.target.name;default:return\"\"}else switch(e.targetType){case\"course\":return\"全部课程\";case\"classroom\":return\"全部班级\";case\"all\":return\"全部商品\";case\"vip\":return\"全部会员\";default:return\"\"}},newReceiveCoupon:function(e,t){var n=this;d.a.pluginsReceiveCoupon({data:e}).then(function(e){\"success\"==e.code?(n.hasReceive=!0,t&&(o.a.success(\"领取成功，正在跳转到详情页...\"),Object(T.setTimeout)(function(){n.useCoupon()},3e3))):\"failed\"==e.code&&(n.ReceiveFail=!0,n.failmessage=\"领取失败，\"+e.message)}).catch(function(e){o.a.fail(e.message)})},useCoupon:function(){this.hasreceiveCoupon(this.coupons)},lReceiveCoupon:function(e,t){var n=u()({batchToken:this.$route.params.token},e);this.loginMethods=!0,this.newReceiveCoupon(n,!0)},canUseCoupon:function(e){var t=!0;if(e.deadline){var n=new Date,s=new Date(Date.parse(e.deadline));n.getTime()>s.getTime()+864e5&&(this.failmessage=\"优惠券已过期\",t=!(this.ReceiveFail=!0))}else 0==e.unreceivedNum&&(this.failmessage=\"优惠券已领完\",t=!(this.ReceiveFail=!0));return t}}},k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.coupons?n(\"div\",{staticClass:\"coupon-receive\"},[t.isLoading?n(\"e-loading\"):t._e(),t._v(\" \"),n(\"div\",{staticClass:\"coupon-receive-title text-overflow\"},[t._v(\"\\n        \"+t._s(t.coupons.name)+\"\\n    \")]),t._v(\" \"),n(\"div\",{staticClass:\"coupon-receive-ticket\"},[n(\"div\",{staticClass:\"ticket-discount\"},[n(\"span\",{staticClass:\"rate\"},[t._v(t._s(parseFloat(t.coupons.rate)))]),t._v(t._s(t._f(\"couponType\")(t.coupons.type))+\"\\n            \"),n(\"span\",[t._v(\"优惠券\")])]),t._v(\" \"),n(\"div\",{staticClass:\"ticket-expire text-overflow\"},[\"day\"===t.coupons.deadlineMode?n(\"span\",[t._v(\"领取后\"+t._s(t.coupons.fixedDay)+\"天内有效\")]):t._e(),t._v(\" \"),\"time\"===t.coupons.deadlineMode?n(\"span\",[t._v(t._s(t.timeExpire(t.coupons.createdTime,t.coupons.deadline)))]):t._e()]),t._v(\" \"),n(\"div\",{staticClass:\"ticket-range text-overflow\"},[t._v(\"适用于：\"+t._s(t.couponType(t.coupons)))])]),t._v(\" \"),t.login&&t.hasReceive&&!t.loginMethods?n(\"div\",{staticClass:\"receive-status\"},[n(\"img\",{staticClass:\"status-icon\",attrs:{src:\"static/images/coupon-yes.png\"}}),t._v(\" \"),n(\"div\",{staticClass:\"status-text\"},[t._v(\"领取成功，优惠券已放入\")]),t._v(\" \"),n(\"div\",{staticClass:\"status-user\"},[t._v(t._s(t.user.nickname)+\"账户\")]),t._v(\" \"),n(\"div\",{staticClass:\"status__btn\",on:{click:function(e){return t.useCoupon()}}},[t._v(\"立即使用\")])]):t._e(),t._v(\" \"),t.ReceiveFail?n(\"div\",{staticClass:\"receive-status\"},[n(\"img\",{staticClass:\"status-icon\",attrs:{src:\"static/images/coupon-no.png\"}}),t._v(\" \"),n(\"div\",{staticClass:\"status-text\"},[t._v(t._s(t.failmessage))])]):t._e(),t._v(\" \"),!t.login&&t.cloudSetting?n(\"fast-login\",{on:{lReceiveCoupon:t.lReceiveCoupon}}):t._e()],1):t._e()},staticRenderFns:[]},w=n(\"VU/8\")(y,k,!1,null,null,null);t.default=w.exports},mypn:function(e,t,n){(function(e,v){!function(n,s){\"use strict\";if(!n.setImmediate){var i,o,t,a,c=1,r={},u=!1,l=n.document,e=Object.getPrototypeOf&&Object.getPrototypeOf(n);e=e&&e.setTimeout?e:n,i=\"[object process]\"==={}.toString.call(n.process)?function(e){v.nextTick(function(){m(e)})}:function(){if(n.postMessage&&!n.importScripts){var e=!0,t=n.onmessage;return n.onmessage=function(){e=!1},n.postMessage(\"\",\"*\"),n.onmessage=t,e}}()?(a=\"setImmediate$\"+Math.random()+\"$\",n.addEventListener?n.addEventListener(\"message\",f,!1):n.attachEvent(\"onmessage\",f),function(e){n.postMessage(a+e,\"*\")}):n.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){m(e.data)},function(e){t.port2.postMessage(e)}):l&&\"onreadystatechange\"in l.createElement(\"script\")?(o=l.documentElement,function(e){var t=l.createElement(\"script\");t.onreadystatechange=function(){m(e),t.onreadystatechange=null,o.removeChild(t),t=null},o.appendChild(t)}):function(e){setTimeout(m,0,e)},e.setImmediate=function(e){\"function\"!=typeof e&&(e=new Function(\"\"+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var s={callback:e,args:t};return r[c]=s,i(c),c++},e.clearImmediate=d}function d(e){delete r[e]}function m(e){if(u)setTimeout(m,0,e);else{var t=r[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(s,n)}}(t)}finally{d(e),u=!1}}}}function f(e){e.source===n&&\"string\"==typeof e.data&&0===e.data.indexOf(a)&&m(+e.data.slice(a.length))}}(\"undefined\"==typeof self?void 0===e?this:e:self)}).call(t,n(\"DuR2\"),n(\"W2nU\"))}});"}