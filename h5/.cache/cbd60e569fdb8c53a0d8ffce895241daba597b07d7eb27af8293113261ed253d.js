{"source":"webpackJsonp([10],{\"162o\":function(e,i,o){(function(e){var t=void 0!==e&&e||\"undefined\"!=typeof self&&self||window,n=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}i.setTimeout=function(){return new s(n.call(setTimeout,t,arguments),clearTimeout)},i.setInterval=function(){return new s(n.call(setInterval,t,arguments),clearInterval)},i.clearTimeout=i.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(t,this._id)},i.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},i.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},i._unrefActive=i.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},o(\"mypn\"),i.setImmediate=\"undefined\"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,i.clearImmediate=\"undefined\"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(i,o(\"DuR2\"))},\"L/LV\":function(e,t,n){\"use strict\";var i=n(\"SgDA\");t.a={methods:{validateMobileOrPsw:function(e){var t=0<arguments.length&&void 0!==e?e:\"mobile\",n=this.userinfo[t],s=i.a[t];0===n.length&&(this.errorMessage[t]=\"\"),this.errorMessage[t]=s.validator(n)?\"\":s.message},validatedChecker:function(){var e=this.userinfo.mobile;11<this.userinfo.mobile.length&&(this.userinfo.mobile=this.userinfo.mobile.substring(0,11));var t=i.a.mobile;this.validated.mobile=t.validator(e)}}}},cLXl:function(e,t,n){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});n(\"eqfM\");var s=n(\"/QYm\"),i=n(\"Dd8w\"),o=n.n(i),a=n(\"NYxO\"),c=n(\"gyMJ\"),r=function(e,t){for(var n=e.split(\".\"),s=t.split(\".\"),i=n.length,o=s.length,a=Math.min(i,o),c=0;c<a;c+=1){if(n[c]>s[c])return!0;if(n[c]<s[c])return!1}return o<i},u=n(\"Xxa5\"),l=n.n(u),d=n(\"exGp\"),m=n.n(d),v=n(\"FVyg\"),f=(n(\"SgDA\"),n(\"KFVb\"),n(\"NyOD\")),p=n(\"1JqO\"),h=n(\"L/LV\"),g={name:\"coupon-fast\",mixins:[f.a,p.a,h.a],components:{EDrag:v.a},data:function(){return{isShow:!1,userinfo:{mobile:\"\",dragCaptchaToken:void 0,smsCode:\"\",smsToken:\"\",type:\"sms_login\"},dragEnable:!1,dragKey:0,errorMessage:{mobile:\"\"},validated:{mobile:!1},count:{showCount:!1,num:60,codeBtnDisable:!1}}},computed:{btnDisable:function(){return!(this.userinfo.mobile&&this.userinfo.smsCode)},cansentCode:function(){return!(this.count.codeBtnDisable||!this.validated.mobile)}},methods:o()({},Object(a.mapActions)([\"addUser\",\"setMobile\",\"sendSmsSend\",\"fastLogin\"]),{handleSendSms:function(){var t=this;this.sendSmsSend(this.userinfo).then(function(e){t.userinfo.smsToken=e.smsToken,t.countDown(),t.dragEnable=!1,t.userinfo.dragCaptchaToken=\"\"}).catch(function(e){switch(e.code){case 4030301:case 4030302:t.dragKey++,t.userinfo.dragCaptchaToken=\"\",t.userinfo.smsToken=\"\",s.a.fail(e.message);break;case 4030303:t.dragEnable?s.a.fail(e.message):t.dragEnable=!0;break;default:s.a.fail(e.message)}})},handleSubmit:function(){var t=this;if(!this.btnDisable){var n={mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode};this.fastLogin({mobile:this.userinfo.mobile,smsToken:this.userinfo.smsToken,smsCode:this.userinfo.smsCode,loginType:\"sms\",client:\"h5\"}).then(function(e){t.$emit(\"lReceiveCoupon\",n)}).catch(function(e){s.a.fail(e.message)})}},countDown:function(){var e=this;this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=60;var t=setInterval(function(){if(e.count.num<=0)return e.count.codeBtnDisable=!1,e.count.showCount=!1,void clearInterval(t);e.count.num--},1e3)},handleSmsSuccess:function(e){this.userinfo.dragCaptchaToken=e,this.handleSendSms()},clickSmsBtn:function(){!this.count.codeBtnDisable&&this.validated.mobile&&(this.dragEnable?this.$refs.dragComponent.dragToEnd?this.$refs.dragComponent.initDragCaptcha():Object(s.a)(\"请先完成拼图验证\"):this.handleSendSms())}})},_={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"div\",{staticClass:\"coupon-receive-login\"},[n(\"div\",{staticClass:\"receive-login-input\"},[n(\"van-field\",{attrs:{type:\"number\",placeholder:\"请输入手机号码\",clearable:\"\",\"error-message\":t.errorMessage.mobile},on:{blur:function(e){return t.validateMobileOrPsw(\"mobile\")},keyup:function(e){return t.validatedChecker()}},model:{value:t.userinfo.mobile,callback:function(e){t.$set(t.userinfo,\"mobile\",e)},expression:\"userinfo.mobile\"}})],1),t._v(\" \"),t.dragEnable?n(\"div\",{staticClass:\"mobile-drag\"},[n(\"div\",{staticClass:\"mobile-drag-content\"},[t.dragEnable?n(\"e-drag\",{key:t.dragKey,ref:\"dragComponent\",attrs:{limitType:\"receive_coupon\"},on:{success:t.handleSmsSuccess}}):t._e()],1)]):t._e(),t._v(\" \"),n(\"div\",{staticClass:\"receive-login-input\"},[n(\"van-field\",{attrs:{type:\"text\",placeholder:\"请输入验证码\",clearable:\"\",maxLength:\"6\",\"error-message\":\"\"},model:{value:t.userinfo.smsCode,callback:function(e){t.$set(t.userinfo,\"smsCode\",e)},expression:\"userinfo.smsCode\"}},[n(\"div\",{class:[\"code-btn\",t.cansentCode?\"\":\"code-btn--disabled\"],attrs:{slot:\"button\"},on:{click:t.clickSmsBtn},slot:\"button\"},[n(\"span\",{directives:[{name:\"show\",rawName:\"v-show\",value:!t.count.showCount,expression:\"!count.showCount\"}]},[t._v(\"发送验证码\")]),t._v(\" \"),n(\"span\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.count.showCount,expression:\"count.showCount\"}]},[t._v(t._s(t.count.num)+\" s\")])])])],1),t._v(\" \"),n(\"div\",{class:[\"receive-login__btn\",t.btnDisable?\"disabled__btn\":\"\"],on:{click:function(e){return t.handleSubmit()}}},[t._v(\"立即领取\")]),t._v(\" \"),t._m(0)])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t(\"div\",{staticClass:\"receive-login__text\"},[t(\"span\",{staticClass:\"receive-login-tools\"},[this._v(\"新用户领取将为您自动注册\")])])}]},C=n(\"VU/8\")(g,_,!1,null,null,null).exports,b=n(\"OPcZ\"),y=n(\"w/qc\"),T=n(\"162o\"),w={name:\"fast-receive\",components:{fastLogin:C},mixins:[b.a,y.a],data:function(){return{coupons:null,currentUserCoupon:null,login:!1,cantuse:!1,hasReceive:!1,receiveFail:!1,failmessage:\"\",successmessage:\"\",loginMethods:!1}},created:function(){this.getCouponInfo()},computed:o()({},Object(a.mapState)({user:function(e){return e.user},isLoading:function(e){return e.isLoading},settings:function(e){return e.settings}})),filters:{couponType:function(e){return\"discount\"==e?\"折\":\"元\"}},methods:{getCouponInfo:function(){var n=this;return m()(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.$route.params.token,e.next=3,c.a.getCouponInfo({query:{batchToken:t}}).then(function(e){n.coupons=e,n.canUseCoupon(e)||n.isLogin()}).catch(function(e){s.a.fail(e.message)});case 3:case\"end\":return e.stop()}},e,n)}))()},isLogin:function(){if(this.$store.state.token){this.login=!0;var e={token:this.$route.params.token};this.newReceiveCoupon(e)}else;},couponType:function(e){if(e.target)switch(e.targetType){case\"course\":return\"课程/\"+e.target.title;case\"classroom\":return\"班级/\"+e.target.title;case\"vip\":return\"会员/\"+e.target.name;default:return\"\"}else switch(e.targetType){case\"course\":return\"全部课程\";case\"classroom\":return\"全部班级\";case\"all\":return\"全部商品\";case\"vip\":return\"全部会员\";default:return\"\"}},newReceiveCoupon:function(e,t){var n=this;c.a.pluginsReceiveCoupon({data:e}).then(function(e){if(t)return s.a.success(\"领取成功，正在跳转到详情页...\"),void Object(T.setTimeout)(function(){n.useCoupon()},3e3);n.currentUserCoupon=e,n.successmessage=\"领取成功，优惠券已放入\",n.hasReceive=!0}).catch(function(e){t?\"5004507\"==e.code?(s.a.success(\"您已领取过该优惠券，正在跳转到详情页...\"),Object(T.setTimeout)(function(){n.useCoupon()},3e3)):s.a.fail(\"领取失败，\"+e.message):\"5004507\"==e.code?(n.successmessage=\"您已领取过，优惠券已放入\",n.hasReceive=!0):(n.receiveFail=!0,n.failmessage=\"领取失败，\"+e.message)})},useCoupon:function(){if(null!=this.currentUserCoupon&&this.currentUserCoupon.deadline){var e=new Date,t=new Date(Date.parse(this.currentUserCoupon.deadline));if(e.getTime()>t.getTime()+864e5)return void s.a.fail(\"优惠券已过期\")}this.hasreceiveCoupon(this.coupons)},lReceiveCoupon:function(e,t){var n={token:this.$route.params.token};this.loginMethods=!0,this.newReceiveCoupon(n,!0)},canUseCoupon:function(e){var t=!1;if(null!=e.currentUserCoupon)return this.currentUserCoupon=e.currentUserCoupon,this.successmessage=\"您已领取过该批次优惠券，优惠券已放入\",t=this.hasReceive=!0,this.cantuse=!t,t;if(0==Number(e.unreceivedNum))return this.failmessage=\"优惠券已领完\",t=this.receiveFail=!0,this.cantuse=!t,t;if(e.deadline){var n=new Date,s=new Date(Date.parse(e.deadline));if(n.getTime()>s.getTime()+864e5)return this.failmessage=\"优惠券已过期\",t=this.receiveFail=!0,this.cantuse=!t,t}return this.cantuse=!t,t}}},k={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.coupons?n(\"div\",{staticClass:\"coupon-receive\"},[t.isLoading?n(\"e-loading\"):t._e(),t._v(\" \"),n(\"div\",{staticClass:\"coupon-receive-title text-overflow\"},[t._v(\"\\n        \"+t._s(t.settings.name)+\"\\n    \")]),t._v(\" \"),n(\"div\",{staticClass:\"coupon-receive-ticket\"},[n(\"div\",{staticClass:\"ticket-discount\"},[n(\"span\",{staticClass:\"rate\"},[t._v(t._s(parseFloat(t.coupons.rate)))]),t._v(t._s(t._f(\"couponType\")(t.coupons.type))+\"\\n            \"),n(\"span\",[t._v(\"优惠券\")])]),t._v(\" \"),n(\"div\",{staticClass:\"ticket-expire text-overflow\"},[\"day\"===t.coupons.deadlineMode?n(\"span\",[null!=t.currentUserCoupon?n(\"span\",[t._v(\"\\n                   优惠券有效至：\"+t._s(t.receiveTimeExpire(t.currentUserCoupon.deadline))+\"\\n                \")]):t._e(),t._v(\" \"),null==t.currentUserCoupon?n(\"span\",[t._v(\"\\n                   领取后\"+t._s(t.coupons.fixedDay)+\"天内有效\\n                \")]):t._e()]):t._e(),t._v(\" \"),\"time\"===t.coupons.deadlineMode?n(\"span\",[n(\"span\",{directives:[{name:\"show\",rawName:\"v-show\",value:!t.hasReceive,expression:\"!hasReceive\"}]},[t._v(\"领券截止日期：\")]),t._v(\" \"),n(\"span\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.hasReceive,expression:\"hasReceive\"}]},[t._v(\"优惠券有效至：\")]),t._v(\"\\n                \"+t._s(t.receiveTimeExpire(t.coupons.deadline))+\"\\n            \")]):t._e()]),t._v(\" \"),n(\"div\",{staticClass:\"ticket-range text-overflow\"},[t._v(\"适用于：\"+t._s(t.couponType(t.coupons)))])]),t._v(\" \"),t.hasReceive&&!t.loginMethods?n(\"div\",{staticClass:\"receive-status\"},[n(\"img\",{staticClass:\"status-icon\",attrs:{src:\"static/images/coupon-yes.png\"}}),t._v(\" \"),n(\"div\",{staticClass:\"status-text\"},[t._v(t._s(t.successmessage))]),t._v(\" \"),n(\"div\",{staticClass:\"status-user\"},[t._v(t._s(t.user.nickname)+\"账户\")]),t._v(\" \"),n(\"div\",{staticClass:\"status__btn\",on:{click:function(e){return t.useCoupon()}}},[t._v(\"立即使用\")])]):t._e(),t._v(\" \"),t.receiveFail&&!t.loginMethods?n(\"div\",{staticClass:\"receive-status\"},[n(\"img\",{staticClass:\"status-icon\",attrs:{src:\"static/images/coupon-no.png\"}}),t._v(\" \"),n(\"div\",{staticClass:\"status-text\"},[t._v(t._s(t.failmessage))])]):t._e(),t._v(\" \"),!t.login&&t.cantuse?n(\"fast-login\",{on:{lReceiveCoupon:t.lReceiveCoupon}}):t._e()],1):t._e()},staticRenderFns:[]},x=n(\"VU/8\")(w,k,!1,null,null,null).exports,S=n(\"fZjL\"),M=n.n(S),R={name:\"pass-receive\",mixins:[b.a,y.a],data:function(){return{item:{},message:\"\",isReceive:!0}},computed:{couponStatus:function(){return M()(this.item).length?\"coupon-receive-success\":\"\"}},created:function(){var t=this,e=this.$route.params.token;this.$store.state.token?e&&c.a.receiveCoupon({data:{token:e}}).then(function(e){t.item=e,t.message=\"恭喜您成功领取了一张优惠券！\"}).catch(function(e){t.message=\"优惠券领取失败！\",s.a.fail(e.message)}):this.$router.push({name:\"login\",query:{redirect:this.$route.fullPath}})}},D={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n(\"div\",{staticClass:\"coupon-receive-page\"},[n(\"div\",{class:[\"coupon-card-bg\",\"clearfix\",t.couponStatus]},[n(\"div\",{staticClass:\"coupon-info\"},[t._v(t._s(t.message))]),t._v(\" \"),Object.keys(t.item).length?n(\"div\",{staticClass:\"e-coupon__body\"},[n(\"div\",{staticClass:\"e-coupon__header clearfix\"},[n(\"span\",{staticClass:\"e-coupon__price\",domProps:{innerHTML:t._s(t.priceHtml(t.item))}}),t._v(\" \"),n(\"div\",{staticClass:\"e-coupon__name\"},[n(\"div\",{staticClass:\"text-overflow text-14 coupon-name\"},[t._v(t._s(t.item.name))]),t._v(\" \"),t.item.deadlineMode&&\"time\"!==t.item.deadlineMode?t._e():n(\"span\",{staticClass:\"text-10\"},[t._v(t._s(t.timeExpire(t.item.createdTime,t.item.deadline)))]),t._v(\" \"),\"day\"!==t.item.deadlineMode||t.item.currentUserCoupon?t._e():n(\"span\",{staticClass:\"text-10\"},[t._v(\"领取后\"+t._s(t.item.fixedDay)+\"天内有效\")]),t._v(\" \"),\"day\"===t.item.deadlineMode&&t.item.currentUserCoupon?n(\"span\",{staticClass:\"text-10\"},[t._v(t._s(t.timeExpire(t.item.createdTime,t.item.currentUserCoupon.deadline)))]):t._e()]),t._v(\" \"),n(\"span\",{staticClass:\"coupon-button\",on:{click:function(e){return t.couponHandle(t.item,t.isReceive)}}},[t._v(\"去使用\")])]),t._v(\" \"),n(\"div\",{staticClass:\"e-coupon__middle\"}),t._v(\" \"),n(\"div\",{staticClass:\"e-coupon__bottom text-overflow\"},[t._v(\"\\n        可用范围：\"+t._s(t.scopeFilter(t.item))+\"\\n      \")])]):t._e()])])},staticRenderFns:[]},I={components:{fastReceive:x,passReceive:n(\"VU/8\")(R,D,!1,null,null,null).exports},data:function(){return{sitePlugins:!1,cloudSetting:0}},created:function(){this.getsettingsCloud()},computed:o()({},Object(a.mapState)({isLoading:function(e){return e.isLoading}})),methods:{getsitePlugins:function(){var t=this;c.a.sitePlugins({query:{pluginName:\"coupon\"}}).then(function(e){e&&(t.sitePlugins=r(\"2.2.9\",e.version),t.getsettingsCloud())}).catch(function(e){s.a.fail(e.message)})},getsettingsCloud:function(){var t=this;c.a.settingsCloud().then(function(e){e.sms_enabled?t.cloudSetting=1:t.cloudSetting=2}).catch(function(e){s.a.fail(e.message)})}}},E={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n(\"div\",{staticClass:\"receive-all\"},[e.isLoading?n(\"e-loading\"):e._e(),e._v(\" \"),1==e.cloudSetting?n(\"fast-receive\"):e._e(),e._v(\" \"),2==e.cloudSetting?n(\"pass-receive\"):e._e()],1)},staticRenderFns:[]},U=n(\"VU/8\")(I,E,!1,null,null,null);t.default=U.exports},mypn:function(e,t,n){(function(e,f){!function(n,s){\"use strict\";if(!n.setImmediate){var i,o,t,a,c=1,r={},u=!1,l=n.document,e=Object.getPrototypeOf&&Object.getPrototypeOf(n);e=e&&e.setTimeout?e:n,i=\"[object process]\"==={}.toString.call(n.process)?function(e){f.nextTick(function(){m(e)})}:function(){if(n.postMessage&&!n.importScripts){var e=!0,t=n.onmessage;return n.onmessage=function(){e=!1},n.postMessage(\"\",\"*\"),n.onmessage=t,e}}()?(a=\"setImmediate$\"+Math.random()+\"$\",n.addEventListener?n.addEventListener(\"message\",v,!1):n.attachEvent(\"onmessage\",v),function(e){n.postMessage(a+e,\"*\")}):n.MessageChannel?((t=new MessageChannel).port1.onmessage=function(e){m(e.data)},function(e){t.port2.postMessage(e)}):l&&\"onreadystatechange\"in l.createElement(\"script\")?(o=l.documentElement,function(e){var t=l.createElement(\"script\");t.onreadystatechange=function(){m(e),t.onreadystatechange=null,o.removeChild(t),t=null},o.appendChild(t)}):function(e){setTimeout(m,0,e)},e.setImmediate=function(e){\"function\"!=typeof e&&(e=new Function(\"\"+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var s={callback:e,args:t};return r[c]=s,i(c),c++},e.clearImmediate=d}function d(e){delete r[e]}function m(e){if(u)setTimeout(m,0,e);else{var t=r[e];if(t){u=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(s,n)}}(t)}finally{d(e),u=!1}}}}function v(e){e.source===n&&\"string\"==typeof e.data&&0===e.data.indexOf(a)&&m(+e.data.slice(a.length))}}(\"undefined\"==typeof self?void 0===e?this:e:self)}).call(t,n(\"DuR2\"),n(\"W2nU\"))}});"}