{"source":"webpackJsonp([5],{\"qtn/\":function(e,t,s){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});s(\"eqfM\");var r=s(\"/QYm\"),n=s(\"woOf\"),o=s.n(n),a=s(\"Dd8w\"),i=s.n(a),c=s(\"NyOD\"),d=s(\"1JqO\"),l=s(\"FVyg\"),u=s(\"NYxO\"),m=(s(\"KFVb\"),s(\"SgDA\")),g={binding:\"绑定手机\",register:\"注册账号\"},h={binding:\"绑定\",register:\"注册\"},f={binding:\"请输入密码\",register:\"请设置密码（5-20位字符）\"},p={components:{EDrag:l.a},mixins:[c.a,d.a],data:function(){return{registerInfo:{mobile:\"\",dragCaptchaToken:void 0,encrypt_password:\"\",smsCode:\"\",smsToken:\"\",type:\"register\"},dragEnable:!1,dragKey:0,errorMessage:{mobile:\"\",encrypt_password:\"\"},validated:{mobile:!1,encrypt_password:!1},count:{showCount:!1,num:120,codeBtnDisable:!1},pathName:this.$route.name,registerType:g,btnType:h,placeHolder:f}},computed:i()({},Object(u.mapState)({isLoading:function(e){return e.isLoading}}),{btnDisable:function(){return!(this.registerInfo.mobile&&this.registerInfo.encrypt_password&&this.registerInfo.smsCode)}}),methods:i()({},Object(u.mapActions)([\"addUser\",\"setMobile\",\"sendSmsCenter\",\"userLogin\"]),{validateMobileOrPsw:function(e){var t=0<arguments.length&&void 0!==e?e:\"mobile\",s=this.registerInfo[t],n=m.a[t];if(0==s.length)return this.errorMessage[t]=\"\",!1;this.errorMessage[t]=n.validator(s)?\"\":n.message},validatedChecker:function(){var e=this.registerInfo.mobile,t=m.a.mobile;this.validated.mobile=t.validator(e)},handleSmsSuccess:function(e){this.registerInfo.dragCaptchaToken=e,this.handleSendSms()},handleSubmit:function(){var t=this,e=o()({},this.registerInfo),s=e.encrypt_password,n=e.mobile,a=window.XXTEA.encryptToBase64(s,window.location.host);e.encrypt_password=a,\"binding\"!==this.pathName?this.addUser(e).then(function(e){r.a.success({duration:2e3,message:\"注册成功\"}),t.afterLogin()}).then(function(){t.userLogin({password:s,username:n})}).catch(function(e){r.a.fail(e.message)}):this.setMobile({query:{mobile:n},data:{password:s,smsCode:e.smsCode,smsToken:e.smsToken}}).then(function(e){r.a.success({duration:2e3,message:\"绑定成功\"}),t.afterLogin()}).catch(function(e){r.a.fail(e.message)})},clickSmsBtn:function(){this.dragEnable?this.$refs.dragComponent.dragToEnd?this.$refs.dragComponent.initDragCaptcha():Object(r.a)(\"请先完成拼图验证\"):this.handleSendSms()},handleSendSms:function(){var t=this;this.sendSmsCenter(this.registerInfo).then(function(e){t.registerInfo.smsToken=e.smsToken,t.countDown(),t.dragEnable=!1}).catch(function(e){switch(e.code){case 4030301:case 4030302:t.dragKey++,t.registerInfo.dragCaptchaToken=\"\",t.registerInfo.smsToken=\"\",r.a.fail(e.message);break;case 4030303:t.dragEnable?r.a.fail(e.message):t.dragEnable=!0;break;default:r.a.fail(e.message)}})},countDown:function(){var e=this;this.count.showCount=!0,this.count.codeBtnDisable=!0,this.count.num=120;var t=setInterval(function(){if(e.count.num<=0)return e.count.codeBtnDisable=!1,e.count.showCount=!1,void clearInterval(t);e.count.num--},1e3)}})},b={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s(\"div\",{staticClass:\"register\"},[t.isLoading?s(\"e-loading\"):t._e(),t._v(\" \"),s(\"span\",{staticClass:\"register-title\"},[t._v(t._s(t.registerType[t.pathName]))]),t._v(\" \"),s(\"van-field\",{attrs:{placeholder:\"请输入手机号\",maxLength:\"11\",\"error-message\":t.errorMessage.mobile},on:{blur:function(e){return t.validateMobileOrPsw(\"mobile\")},keyup:function(e){return t.validatedChecker()}},model:{value:t.registerInfo.mobile,callback:function(e){t.$set(t.registerInfo,\"mobile\",e)},expression:\"registerInfo.mobile\"}}),t._v(\" \"),s(\"van-field\",{attrs:{type:\"password\",maxLength:\"20\",\"error-message\":t.errorMessage.encrypt_password,placeholder:t.placeHolder[t.pathName]},on:{blur:function(e){return t.validateMobileOrPsw(\"encrypt_password\")}},model:{value:t.registerInfo.encrypt_password,callback:function(e){t.$set(t.registerInfo,\"encrypt_password\",e)},expression:\"registerInfo.encrypt_password\"}}),t._v(\" \"),t.dragEnable?s(\"e-drag\",{key:t.dragKey,ref:\"dragComponent\",on:{success:t.handleSmsSuccess}}):t._e(),t._v(\" \"),s(\"van-field\",{attrs:{type:\"text\",center:\"\",clearable:\"\",maxLength:\"6\",placeholder:\"请输入验证码\"},model:{value:t.registerInfo.smsCode,callback:function(e){t.$set(t.registerInfo,\"smsCode\",e)},expression:\"registerInfo.smsCode\"}},[s(\"van-button\",{attrs:{slot:\"button\",size:\"small\",type:\"primary\",disabled:t.count.codeBtnDisable||!t.validated.mobile},on:{click:t.clickSmsBtn},slot:\"button\"},[t._v(\"\\n        发送验证码\\n        \"),s(\"span\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.count.showCount,expression:\"count.showCount\"}]},[t._v(\"(\"+t._s(t.count.num)+\")\")])])],1),t._v(\" \"),s(\"van-button\",{staticClass:\"primary-btn mb20\",attrs:{type:\"default\",disabled:t.btnDisable},on:{click:t.handleSubmit}},[t._v(t._s(t.btnType[t.pathName]))])],1)},staticRenderFns:[]},v=s(\"VU/8\")(p,b,!1,null,null,null);t.default=v.exports}});"}