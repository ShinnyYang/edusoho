webpackJsonp([2,3],{P8if:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("Dd8w"),a=s.n(i),r=s("jW8y"),n=s("gMS5"),o=s("NYxO"),c=s("Du/2"),l={components:{Directory:r.a,DetailHead:n.a},computed:a()({},Object(o.mapState)("course",{details:function(t){return t.details}}),Object(o.mapState)({isLoading:function(t){return t.isLoading}})),beforeRouteLeave:function(t,e,s){this.$store.commit("course/"+c.g,{sourceType:"img"}),s()}},u={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"course-detail try"},[this.isLoading?e("e-loading"):this._e(),this._v(" "),e("detail-head",{attrs:{courseSet:this.details.courseSet}}),this._v(" "),e("directory",{attrs:{hiddeTitle:!0,courseItems:this.details.courseItems}})],1)},staticRenderFns:[]},d=s("VU/8")(l,u,!1,null,null,null);e.default=d.exports},f0vb:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=s("fZjL"),a=s.n(i),r=s("Dd8w"),n=s.n(r),o=s("jW8y"),c=s("gMS5"),l=(s("Du/2"),s("NYxO")),u=(s("P8if"),{data:function(){return{items:[],isFree:!1}},watch:{selectedPlanId:{immediate:!0,handler:function(t){var e=this;this.items=this.details.courses.map(function(t,s){return e.$set(t,"active",!1),t.id===e.details.id&&(t.active=!0),t})}}},computed:n()({},Object(l.mapState)("course",{details:function(t){return t.details},selectedPlanId:function(t){return t.selectedPlanId}})),methods:n()({},Object(l.mapActions)("course",["getCourseDetail"]),{handleClick:function(t,e){this.items.map(function(t){return t.active=!1}),t.active=!0,this.getCourseDetail({courseId:t.id})},filterPrice:function(){var t=this.details;return Number(t.isFree)||"0.00"===t.price?(this.isFree=!0,"免费"):(this.isFree=!1,"¥"+t.price)}})}),d={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("e-panel",{attrs:{title:t.details.courseSet.title}},[s("div",{staticClass:"course-detail__plan-price"},[s("span",{class:{isFree:t.isFree}},[t._v(t._s(t.filterPrice()))]),t._v(" "),s("span",[t._v(t._s(t.details.courseSet.studentNum)+"人在学")])])]),t._v(" "),s("ul",{staticClass:"course-detail__plan"},t._l(t.items,function(e,i){return s("li",{class:{active:e.active},on:{click:function(s){t.handleClick(e,i)}}},[t._v(t._s(e.title))])}))],1)},staticRenderFns:[]},h=s("VU/8")(u,d,!1,null,null,null).exports,p={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("e-panel",{attrs:{title:"教师介绍"}},[t._l(t.teacherInfo,function(e){return[s("div",{staticClass:"teacher-content"},[s("img",{staticClass:"teacher-avatar-img",attrs:{src:e.avatar.large}}),t._v(" "),s("div",{staticClass:"teacher-cell"},[s("span",{staticClass:"dark font-family-PFM"},[t._v(t._s(e.nickname))]),t._v(" "),s("span",{staticClass:"text-content"},[t._v(t._s(e.title||"暂无简介"))])])])]})],2)},staticRenderFns:[]},v=s("VU/8")({name:"teacher",props:["teacherInfo"]},p,!1,null,null,null).exports,f=this,m={props:["details"],data:function(){return{active:0,tabs:["课程目录","课程简介"]}},computed:n()({progress:function(){return Number(this.details.publishedTaskNum)?100*(this.details.learnedNum/this.details.publishedTaskNum).toFixed(2)+"%":"0%"}},Object(l.mapState)("course",{selectedPlanId:function(t){return t.selectedPlanId}})),watch:{selectedPlanId:function(t,e){t!==e&&(f.active=0),console.log(f.active,"active")}},components:{Directory:o.a,DetailHead:c.a,DetailPlan:h,Teacher:v},methods:{onTabClick:function(){console.log("click")}}},_={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"join-after"},[s("detail-head",{attrs:{courseSet:t.details.courseSet}}),t._v(" "),s("van-tabs",{staticClass:"after-tabs",on:{click:t.onTabClick},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.tabs,function(t){return s("van-tab",{key:t,attrs:{title:t}})})),t._v(" "),s("div",{staticClass:"join-after__content"},[t.active?[s("detail-plan"),t._v(" "),s("div",{staticClass:"segmentation"}),t._v(" "),s("e-panel",{attrs:{title:"课程介绍"}},[s("div",{domProps:{innerHTML:t._s(t.details.courseSet.summary)}})]),t._v(" "),s("div",{staticClass:"segmentation"}),t._v(" "),s("teacher",{staticClass:"teacher",attrs:{teacherInfo:t.details.teachers}})]:[s("div",{staticClass:"progress-bar"},[s("div",{staticClass:"progress-bar__content"},[s("div",{staticClass:"progress-bar__rate",style:{width:t.progress}})]),t._v(" "),s("div",{staticClass:"progress-bar__text"},[t._v(t._s(t.progress))])]),t._v(" "),s("directory",{staticClass:"join-after-dirctory",attrs:{hiddeTitle:!0,tryLookable:t.details.tryLookable,courseItems:t.details.courseItems}})]],2)],1)},staticRenderFns:[]},y=s("VU/8")(m,_,!1,null,null,null).exports,b={name:"joinBefore",data:function(){return{teacherInfo:{},tabs:["课程介绍","教师介绍","目录"],active:0,tabsClass:"",tops:{tabsTop:0,teacherTop:0,aboutTop:0}}},components:{Teacher:v,Directory:o.a,DetailHead:c.a,DetailPlan:h},computed:n()({},Object(l.mapState)("course",{details:function(t){return t.details}})),mounted:function(){var t=this,e=this.$refs;window.addEventListener("touchmove",this.handleTouch),window.addEventListener("scroll",this.handleScroll),setTimeout(function(){window.scrollTo(0,0),a()(e).forEach(function(s){t.tops[s+"Top"]=e[s].$el.getBoundingClientRect().top}),console.log(t.tops)},100)},methods:n()({},Object(l.mapActions)("course",["joinCourse"]),{onTabClick:function(t,e){var s=this.$refs[this.transIndex2Tab(t)];window.scrollTo(0,s.$el.offsetTop-44)},transIndex2Tab:function(t){return t?t>1?"directory":"teacher":"about"},handleTouch:function(){var t=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop;this.active=this.activeCurrentTab(t),t>=this.tops.tabsTop?this.tabsClass="van-tabs--fixed":this.tabsClass=""},activeCurrentTab:function(t){var e=this.tops;return(t+=44)<e.teacherTop?0:t>=e.directoryTop?2:1},handleJoin:function(){this.$store.state.token?+this.details.price?this.$router.push({path:"/order/"+this.details.id}):this.joinCourse({id:this.details.id}):this.$router.push({name:"login"})}}),destroyed:function(){window.removeEventListener("touchmove",this.handleScroll)}},k={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"join-before"},[s("detail-head",{attrs:{price:t.details.price,courseSet:t.details.courseSet}}),t._v(" "),s("detail-plan"),t._v(" "),s("div",{staticClass:"segmentation"}),t._v(" "),s("van-tabs",{ref:"tabs",class:t.tabsClass,on:{click:t.onTabClick},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},t._l(t.tabs,function(t){return s("van-tab",{key:t,attrs:{title:t}})})),t._v(" "),s("e-panel",{ref:"about",staticClass:"about",attrs:{title:"课程介绍"}},[s("div",{domProps:{innerHTML:t._s(t.details.courseSet.summary)}})]),t._v(" "),s("div",{staticClass:"segmentation"}),t._v(" "),s("teacher",{ref:"teacher",staticClass:"teacher",attrs:{teacherInfo:t.details.teachers}}),t._v(" "),s("div",{staticClass:"segmentation"}),t._v(" "),s("directory",{ref:"directory",attrs:{courseItems:t.details.courseItems}}),t._v(" "),s("e-footer",{nativeOn:{click:function(e){return t.handleJoin(e)}}},[t._v("\n    "+t._s(t._f("filterJoinStatus")(t.details.access.code)))])],1)},staticRenderFns:[]},g=s("VU/8")(b,k,!1,null,null,null).exports,T=(s("gyMJ"),{components:{joinAfter:y,joinBefore:g},computed:n()({},Object(l.mapState)("course",{selectedPlanIndex:function(t){return t.selectedPlanIndex},joinStatus:function(t){return t.joinStatus},details:function(t){return t.details}}),Object(l.mapState)({isLoading:function(t){return t.isLoading}}),{isEmpty:function(){return 0===a()(this.details).length}}),created:function(){this.getCourseDetail({courseId:this.$route.params.id})},methods:n()({},Object(l.mapActions)("course",["getCourseDetail"]))}),C={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"course-detail"},[t.isLoading?s("e-loading"):t._e(),t._v(" "),t.joinStatus||t.isEmpty?t._e():s("join-before",{attrs:{details:t.details}}),t._v(" "),t.joinStatus&&!t.isEmpty?s("join-after",{attrs:{details:t.details}}):t._e()],1)},staticRenderFns:[]},w=s("VU/8")(T,C,!1,null,null,null);e.default=w.exports},gMS5:function(t,e,s){"use strict";var i=s("//Fk"),a=s.n(i),r=s("Xxa5"),n=s.n(r),o=s("exGp"),c=s.n(o),l=s("Dd8w"),u=s.n(l),d=s("PirY"),h=s.n(d),p=s("NYxO"),v=s("gyMJ"),f={props:{courseSet:{type:Object,default:{}}},computed:u()({},Object(p.mapState)("course",{sourceType:function(t){return t.sourceType},selectedPlanId:function(t){return t.selectedPlanId},taskId:function(t){return t.taskId},details:function(t){return t.details},joinStatus:function(t){return t.joinStatus}})),watch:{taskId:{immediate:!0,handler:function(t,e){["video","audio"].includes(this.sourceType)&&(window.scrollTo(0,0),this.initPlayer())}}},methods:{getParams:function(){return!this.joinStatus&&Number(this.details.tryLookable)?{query:{courseId:this.selectedPlanId,taskId:this.taskId},params:{preview:1}}:{query:{courseId:this.selectedPlanId,taskId:this.taskId}}},initPlayer:function(){var t=this;return c()(n.a.mark(function e(){var s,i,a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.$refs.video&&(t.$refs.video.innerHTML=""),e.next=3,v.a.getMedia(t.getParams());case 3:s=e.sent,i=s.media,a={id:"course-detail__head--video",resId:i.resId,user:{},playlist:i.url,autoplay:!0,poster:"https://img4.mukewang.com/szimg/5b0b60480001b95e06000338.jpg"},t.$store.commit("UPDATE_LOADING_STATUS",!0),t.loadPlayerSDK().then(function(e){t.$store.commit("UPDATE_LOADING_STATUS",!1);new e(a)});case 8:case"end":return e.stop()}},e,t)}))()},loadPlayerSDK:function(){if(!window.VideoPlayerSDK){var t="//service-cdn.qiqiuyun.net/js-sdk/video-player/sdk-v1.js?\n          v="+Date.now()/1e3/60;return new a.a(function(e,s){h()(t,function(t){t&&s(t),e(window.VideoPlayerSDK)})})}return a.a.resolve(window.VideoPlayerSDK)}}},m={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"course-detail__head"},[e("div",{directives:[{name:"show",rawName:"v-show",value:"img"===this.sourceType,expression:"sourceType === 'img'"}],staticClass:"course-detail__head--img"},[e("img",{attrs:{src:this.courseSet.cover.large,alt:""}})]),this._v(" "),e("div",[this._v("test")]),this._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:["video","audio"].includes(this.sourceType),expression:"['video', 'audio'].includes(sourceType)"}],ref:"video",attrs:{id:"course-detail__head--video"}})])},staticRenderFns:[]},_=s("VU/8")(f,m,!1,null,null,null);e.a=_.exports},jW8y:function(t,e,s){"use strict";s("eqfM");var i=s("/QYm"),a=s("Dd8w"),r=s.n(a),n=s("NYxO"),o=s("Du/2"),c={props:{courseItems:{type:Array,default:function(){return[]}},hiddeTitle:{type:Boolean,default:!1}},computed:r()({},Object(n.mapState)("course",{joinStatus:function(t){return t.joinStatus},selectedPlanId:function(t){return t.selectedPlanId},details:function(t){return t.details}})),data:function(){return{directoryArray:[],chapters:[],tasks:[]}},filters:{filterNumber:function(t){return Number(t.seq)?t.number+"-"+t.seq:""+t.number}},watch:{selectedPlanId:{immediate:!0,handler:function(t){var e=this;this.details.courseItems.length&&(this.directoryArray=this.details.courseItems.map(function(t){return e.$set(t,"show",!0),"task"==t.type&&(t.status=e.getCurrentStatus(t.task)),t}),this.getTasks(this.directoryArray))}}},methods:r()({},Object(n.mapMutations)("course",{setSourceType:o.g}),{getTasks:function(t){var e=this,s=[];this.chapters=[],this.tasks=[],t.forEach(function(t){"chapter"!==t.type?s.push(t):(s.length>0?(e.tasks.push([].concat(s)),s=[]):e.chapters.length>0&&e.tasks.push([]),e.chapters.push(t))}),"chapter"!==t[t.length-1].type&&this.tasks.push(s),"chapter"!==t[0].type&&this.chapters.unshift({show:!0})},getCurrentStatus:function(t){return Number(this.details.tryLookable)&&"video"===t.type&&t.activity.mediaStorage?"is-tryLook":Number(t.isFree)?"is-free":""},filterTaskStatus:function(t){return"is-tryLook"===t.status?"试看":"is-free"===t.status?"免费":""},lessonCellClick:function(t){var e=t.task,s=this.details;if(!s.allowAnonymousPreview&&this.$route.push({name:"login"}),!this.joinStatus&&Number(s.tryLookable)&&["is-tryLook","is-free"].includes(t.status))switch(e.type){case"video":case"audio":this.$router.push({name:"course_try"}),this.setSourceType({sourceType:e.type,taskId:e.id});break;case"doc":case"text":case"ppt":this.$router.push({name:"course_web",query:{courseId:this.selectedPlanId,taskId:e.id,type:e.type}});break;default:return Object(i.a)("请先加入课程")}else this.joinStatus?this.showTypeDetail(e):Object(i.a)("请先加入课程")},showTypeDetail:function(t){switch(t.type){case"video":"self"==t.mediaSource?this.setSourceType({sourceType:"video",taskId:t.id}):Object(i.a)("暂不支持此类型");break;case"audio":this.setSourceType({sourceType:"audio",taskId:t.id});break;case"text":case"ppt":case"doc":this.$router.push({name:"course_web",query:{courseId:this.selectedPlanId,taskId:t.id,type:t.type}});break;default:Object(i.a)("暂不支持此类型")}}})},l={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("e-panel",{staticClass:"directory",attrs:{title:"课程目录","hidde-title":t.hiddeTitle}},[0==t.courseItems.length?s("div",{staticClass:"empty"},[t._v("暂无学习任务")]):s("div",{staticClass:"directory-list"},t._l(t.chapters,function(e,i){return s("div",{staticClass:"directory-list__item"},["chapter"===e.type?s("div",{staticClass:"directory-list__item-chapter",on:{click:function(t){e.show=!e.show}}},[s("span",[t._v("第"+t._s(e.number)+"章："+t._s(e.title))]),t._v(" "),s("i",{class:[e.show?"icon-packup":"icon-unfold"]})]):t._e(),t._v(" "),t._l(t.tasks[i],function(i){return s("div",{class:["directory-list__item-unit",{"unit-show":e.show}]},["unit"===i.type?s("div",{staticClass:"lesson-cell__unit"},[t._v("\n          第"+t._s(i.number)+"节："+t._s(i.title)+"\n        ")]):t._e(),t._v(" "),"task"===i.type?s("div",{class:["box",{"show-box":e.show}]},[s("div",{staticClass:"lesson-cell"},[s("span",{staticClass:"lesson-cell__number"},[t._v(t._s(t._f("filterNumber")(i)))]),t._v(" "),s("div",{staticClass:"lesson-cell__content",on:{click:function(e){t.lessonCellClick(i)}}},[s("span",[t._v(t._s(i.title))]),t._v(" "),s("span",[t._v(t._s(t._f("taskType")(i.task.type))+t._s(t._f("filterTask")(i.task)))])]),t._v(" "),s("div",{class:["lesson-cell__status",i.status]},[t._v("\n              "+t._s(t.filterTaskStatus(i))+"\n            ")])])]):t._e()])})],2)}))])},staticRenderFns:[]},u=s("VU/8")(c,l,!1,null,null,null);e.a=u.exports}});